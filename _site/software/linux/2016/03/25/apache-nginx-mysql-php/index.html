
<!doctype html>














<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/assets/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/assets/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/assets/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Apache,Nginx,MySQL,PHP,PHP-Extension,Memcache,Redis," />





  <link rel="alternate" href="/atom.xml" title="Rengui's Notes" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico?v=5.1.1" />
















<meta name="description" content="在Linux环境下的Apache/Nginx+MySQL+PHP源码包安装过程。内容适用于linux操作系统，仅供参考！">
<meta name="keywords" content="Apache, Nginx, MySQL, PHP, PHP-Extension, Memcache, Redis">
<meta property="og:type" content="article">
<meta property="og:title" content="Apache/Nginx-MySQL+PHP">
<meta property="og:url" content="http://localhost:4000/software/linux/2016/03/25/apache-nginx-mysql-php/">
<meta property="og:site_name" content="Rengui's Notes">
<meta property="og:description" content="在Linux环境下的Apache/Nginx+MySQL+PHP源码包安装过程。内容适用于linux操作系统，仅供参考！">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://localhost:4000/assets/images/apache-1.png">
<meta property="og:image" content="http://localhost:4000/assets/images/apache-2.png">
<meta property="og:image" content="http://localhost:4000/assets/images/apache-3.png">
<meta property="og:image" content="http://localhost:4000/assets/images/apache-4.png">
<meta property="og:image" content="http://localhost:4000/assets/images/apache-5.png">
<meta property="og:image" content="http://localhost:4000/assets/images/apache-6.png">
<meta property="og:image" content="http://localhost:4000/assets/images/apache-7.png">
<meta property="og:image" content="http://localhost:4000/assets/images/apache-8.png">
<meta property="og:image" content="http://localhost:4000/assets/images/apache-9.png">
<meta property="og:image" content="http://localhost:4000/assets/images/apache-10.png">
<meta property="og:image" content="http://localhost:4000/assets/images/apache-11.png">
<meta property="og:image" content="http://localhost:4000/assets/images/apache-12.png">
<meta property="og:image" content="http://localhost:4000/assets/images/mysql-1.png">
<meta property="og:image" content="http://localhost:4000/assets/images/mysql-2.png">
<meta property="og:image" content="http://localhost:4000/assets/images/php-1.png">
<meta property="og:image" content="http://localhost:4000/assets/images/php-2.png">
<meta property="og:image" content="http://localhost:4000/assets/images/php-3.png">
<meta property="og:image" content="http://localhost:4000/assets/images/php-4.png">
<meta property="og:image" content="http://localhost:4000/assets/images/php-5.png">
<meta property="og:image" content="http://localhost:4000/assets/images/php-6.png">
<meta property="og:image" content="http://localhost:4000/assets/images/php-7.png">
<meta property="og:image" content="http://localhost:4000/assets/images/php-8.png">
<meta property="og:image" content="http://localhost:4000/assets/images/php-9.png">
<meta property="og:image" content="http://localhost:4000/assets/images/php-10.png">
<meta property="og:image" content="http://localhost:4000/assets/images/php-11.png">
<meta property="og:image" content="http://localhost:4000/assets/images/php-12.png">
<meta property="og:image" content="http://localhost:4000/assets/images/php-13.png">
<meta property="og:image" content="http://localhost:4000/assets/images/php-14.png">
<meta property="og:image" content="http://localhost:4000/assets/images/php-15.png">
<meta property="og:image" content="http://localhost:4000/assets/images/php-16.png">
<meta property="og:image" content="http://localhost:4000/assets/images/php-17.png">
<meta property="og:image" content="http://localhost:4000/assets/images/php-18.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Apache/Nginx-MySQL+PHP">
<meta name="twitter:description" content="在Linux环境下的Apache/Nginx+MySQL+PHP源码包安装过程。内容适用于linux操作系统，仅供参考！">
<meta name="twitter:image" content="http://localhost:4000/assets/images/apache-1.png">


<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://localhost:4000/"/>





  <title>Apache/Nginx-MySQL+PHP | Rengui's Notes</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-123739978-1', 'auto');
  ga('send', 'pageview');
</script>













</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Rengui's Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

<div id="posts" class="posts-expand">
  
  

  

  
  
  

  <article class="post post-type- " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://localhost:4000/software/linux/2016/03/25/apache-nginx-mysql-php/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhao Rengui">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/assets/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rengui's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
          
          
            Apache/Nginx-MySQL+PHP
          
        </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-03-25T00:00:00+08:00">
                2016-03-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/category/#/software" itemprop="url" rel="index">
                    <span itemprop="name">software</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/category/#/linux" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
          

          

          

          
            
                <div class="post-description">
                    在Linux环境下的Apache/Nginx+MySQL+PHP源码包安装过程。内容适用于linux操作系统，仅供参考！
                </div>
            
          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
  
  












  <p>
关于此文档，如果你有任何问题，可以发邮件到我的邮箱，邮箱地址为 zrg1390556487@gmail.com.
</p>

<p>
This is a installation process of "Apache+MySQL+PHP" source packages on linux environment.It's content only  
</p>

<div id="outline-container-orgc26e699" class="outline-2">
<h2 id="orgc26e699"><span class="section-number-2">1</span> 前言(Preface)</h2>
<div class="outline-text-2" id="text-1">
<pre class="example">
建议根据文档顺序依次安装。

</pre>
</div>
</div>
<div id="outline-container-org8142e65" class="outline-2">
<h2 id="org8142e65"><span class="section-number-2">2</span> 安装Apache</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org769e555" class="outline-3">
<h3 id="org769e555"><span class="section-number-3">2.1</span> 解压</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">#tar jxvf httpd-2.4.18.tar.bz2
#cd httpd-2.4.18/
</pre>
</div>
</div>
</div>
<div id="outline-container-org2bf2b9f" class="outline-3">
<h3 id="org2bf2b9f"><span class="section-number-3">2.2</span> 配置</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">#./configure --prefix=/usr/local/apache2 --enable-so --with-included-apr
&#27492;&#26102;&#21487;&#33021;&#20250;&#20986;&#29616;&#22914;&#19979;&#38169;&#35823;&#65292;&#36825;&#26159;&#22240;&#20026;ARP&#21644;ARP-util&#32570;&#22833;&#12290;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/apache-1.png" alt="apache-1.png" align="center" />
</p>
</div>
</div>
</div>
<div id="outline-container-org78ea8dd" class="outline-3">
<h3 id="org78ea8dd"><span class="section-number-3">2.3</span> 安装APR和APR-util</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#21040; http://apr.apache.org/download.cgi &#19979;&#36733;apr&#21644;apr-util
#tar jxvf apr-1.5.2.tar.bz2
#cd apr-1.5.2/
#./configure --prefix=/usr/local/apr
&#27492;&#26102;&#65292;&#21487;&#33021;&#20250;&#20986;&#29616;libtool&#32570;&#22833;&#65292;&#22914;&#19979;&#22270;&#25152;&#31034;&#12290;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/apache-2.png" alt="apache-2.png" align="center" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#35299;&#20915;&#21150;&#27861;&#65306;
 &#23433;&#35013;libtool&#12289;autoconf&#21450;automake&#65306;#zypper in autoconf libtool automake
 &#28982;&#21518;&#25191;&#34892;&#65306;# autoreconf --force --install
       #autoreconf --force --install
       #autoreconf --force --install
       &#20043;&#21518;&#65292;&#25171;&#24320;configure&#25991;&#20214;(&#29616;&#22312;&#20351;&#29992;&#30340;&#29256;&#26412;&#26159;apr-1.5.2&#65292;30212&#34892;)&#65292;&#27880;&#37322;   $RM -f <span style="color: #8b2252;">"$cfgfile"</span>&#65292;&#23601;&#26159;&#22312;&#21069;&#38754;&#28155;&#21152;&#8220;#&#8221;&#12290;
&#37325;&#26032;&#25191;&#34892;./configure --prefix=/usr/local/apr&#65292;&#38382;&#39064;&#35299;&#20915;&#12290;
&#25104;&#21151;&#26631;&#24535;&#65306;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/apache-3.png" alt="apache-3.png" height="600px" align="center" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#32534;&#35793;&#23433;&#35013;apr
#make <span style="color: #228b22;">&amp;&amp;</span> make install &#65292;&#25104;&#21151;&#26631;&#24535;&#65306;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/apache-4.png" alt="apache-4.png" width="800px" align="center" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#25509;&#19979;&#26469;&#65292;&#23433;&#35013;APR-util&#12290;
&#21516;&#26679;&#65292;&#35299;&#21387;&#37197;&#32622;&#65292;&#27880;&#24847;&#20351;&#29992;&#20102;--with-apr&#65306;
#tar apr-util-1.5.4.tar.bz2
#cd apr-util-1.5.4/
# ./configure --with-apr=/usr/local/apr
&#25104;&#21151;&#26631;&#24535;&#65306;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/apache-5.png" alt="apache-5.png" height="450px" align="center" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">#make <span style="color: #228b22;">&amp;&amp;</span> make install &#65292;&#25104;&#21151;&#26631;&#24535;&#65306;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/apache-6.png" alt="apache-6.png" height="450px" align="center" />
</p>
</div>
</div>
</div>
<div id="outline-container-org6f6539d" class="outline-3">
<h3 id="org6f6539d"><span class="section-number-3">2.4</span> 运行安装apache（httpd）</h3>
<div class="outline-text-3" id="text-2-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">#./configure --prefix=/usr/local/apache2 --enable-so
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/apache-7.png" alt="apache-7.png" align="center" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#35299;&#20915;&#21150;&#27861;&#65306;&#21040;https://sourceforge.net/projects/pcre/files/ &#19979;&#36733;pcre&#24182;&#23433;&#35013;&#12290;
#./configure --prefix=/usr/local/pcre
&#25104;&#21151;&#26631;&#24535;&#65306;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/apache-8.png" alt="apache-8.png" height="500px" align="center" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">#make <span style="color: #228b22;">&amp;&amp;</span> make install &#65292;&#25104;&#21151;&#26631;&#24535;&#65306;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/apache-9.png" alt="apache-9.png" width="820px" align="center" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#36827;&#20837;apache&#30446;&#24405;&#65292;&#37325;&#26032;&#36816;&#34892;&#37197;&#32622;&#21629;&#20196;&#65306;
#./configure --prefix=/usr/local/apache2 --enable-so &#65292;&#38382;&#39064;&#35299;&#20915;&#12290;
&#25104;&#21151;&#26631;&#24535;&#65306;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/apache-10.png" alt="apache-10.png" heght="600px" width="480px" align="center" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">#make <span style="color: #228b22;">&amp;&amp;</span> make install &#65292;&#25104;&#21151;&#26631;&#24535;&#65306;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/apache-11.png" alt="apache-11.png" width="650px" align="center" />
</p>
</div>
<pre class="example">
至此，Apache安装成功

</pre>
</div>
</div>
<div id="outline-container-orgd407e62" class="outline-3">
<h3 id="orgd407e62"><span class="section-number-3">2.5</span> 启动Apache</h3>
<div class="outline-text-3" id="text-2-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#22240;&#20026;&#26159;&#28304;&#30721;&#21253;&#23433;&#35013;&#65292;&#25152;&#20197;&#21482;&#33021;&#25191;&#34892;&#19979;&#21015;&#21629;&#20196;&#65306;
# /usr/local/apache2/bin/apachectl start
&#27492;&#26102;&#65292;&#20986;&#29616;&#19979;&#22270;&#38169;&#35823;&#65292;&#36825;&#26159;&#22240;&#20026;ServerName&#37197;&#32622;&#19981;&#27491;&#30830;&#30340;&#21407;&#22240;&#12290;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/apache-12.png" alt="apache-12.png" align="center" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#35299;&#20915;&#65306;# vim httpd.conf
ServerName localhost:80

&#25913;&#23436;&#21518;&#65292;&#37325;&#21551;apache&#65306;# /usr/local/apache2/bin/apachectl restart
&#21487;&#20197;&#26597;&#30475;&#24320;&#21457;&#31471;&#21475;&#21495;&#65306;# netstat -tnlp
</pre>
</div>
</div>
</div>
<div id="outline-container-orga91716c" class="outline-3">
<h3 id="orga91716c"><span class="section-number-3">2.6</span> 设置开机启动</h3>
<div class="outline-text-3" id="text-2-6">
<div class="org-src-container">
<pre class="src src-emacs-lisp"># cp /usr/local/apache2/bin/apachectl /etc/init.d
# chmod 755 /etc/init.d/apachectl
# chkconfig --add apachectl                   &#65307;add&#23545;&#24212;del
# chkconfig --level 35 apachectl on        &#65307;on&#23545;&#24212;off
# chkconfig --list                    &#65307;&#26174;&#31034;&#24320;&#26426;&#21487;&#20197;&#33258;&#21160;&#21551;&#21160;&#30340;&#26381;&#21153;
</pre>
</div>
</div>
</div>
<div id="outline-container-orga84b210" class="outline-3">
<h3 id="orga84b210"><span class="section-number-3">2.7</span> 配置Virtual Host</h3>
<div class="outline-text-3" id="text-2-7">
</div>
<div id="outline-container-orgd7c5c6c" class="outline-4">
<h4 id="orgd7c5c6c"><span class="section-number-4">2.7.1</span> Configure virtual host</h4>
<div class="outline-text-4" id="text-2-7-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org3acca4a">LoadModule vhost_alias_module modules/mod_vhost_alias.so
# Virtual hosts 
Include conf/extra/httpd-vhosts.conf
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org62b1e31">&lt;VirtualHost 127.0.0.1:80&gt;
    #directory
    DocumentRoot <span style="color: #8b2252;">"D:\phpStudy\WWW\ec-shop\gold"</span>
    ServerName local.gold
    #    ServerAlias www.dummy-host.example.com
    #    ErrorLog <span style="color: #8b2252;">"logs/dummy-host.example.com-error.log"</span>
    #    CustomLog <span style="color: #8b2252;">"logs/dummy-host.example.com-access.log"</span> common
    DirectoryIndex index.html index.htm index.php
    &lt;Directory /&gt;
      Options FollowSymLinks
      #&#19981;&#35768;&#21487;&#21035;&#20154;&#20462;&#25913;&#25105;&#20204;&#30340;&#39029;&#38754;
      AllowOverride None
      #&#35774;&#32622;&#35775;&#38382;&#26435;&#38480;
      Order allow,deny
      Allow from all
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;
</pre>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org7f0bc72">127.0.0.1 local.gold
Explain:
      a.About hosts:a computer file to be used to store information on where to find an internet host on a computer network

      b.When the user input a URL in the browser, the system will automatically search for the corresponding IP address 
        from the Hosts file, once found, the system will immediately open the corresponding page, if not found, then the 
        system will be submitted to the DNS domain name resolution server IP address.
</pre>
</div>
</div>
</div>
<div id="outline-container-org1af3f18" class="outline-4">
<h4 id="org1af3f18"><span class="section-number-4">2.7.2</span> Configure multiple ports and multiple sites</h4>
<div class="outline-text-4" id="text-2-7-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org5d2acf3">Add listening port:
  Listen 81
  Listen 82
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orga37dcad">&lt;VirtualHost *:81&gt;
#    ServerAdmin webmaster@dummy-host2.example.com
     DocumentRoot <span style="color: #8b2252;">"d:\wamp\www\wp-job"</span>
     ServerName localhost
#    ErrorLog <span style="color: #8b2252;">"logs/dummy-host2.example.com-error.log"</span>
#    CustomLog <span style="color: #8b2252;">"logs/dummy-host2.example.com-access.log"</span> common
&lt;/VirtualHost&gt;

&lt;VirtualHost *:82&gt;
#    ServerAdmin webmaster@dummy-host2.example.com
     DocumentRoot <span style="color: #8b2252;">"d:\wamp\www\wordpress"</span>
     ServerName localhost
#    ErrorLog <span style="color: #8b2252;">"logs/dummy-host2.example.com-error.log"</span>
#    CustomLog <span style="color: #8b2252;">"logs/dummy-host2.example.com-access.log"</span> common
&lt;/VirtualHost&gt;
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-org092da7f" class="outline-2">
<h2 id="org092da7f"><span class="section-number-2">3</span> 安装Nginx</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgf28b42c" class="outline-3">
<h3 id="orgf28b42c"><span class="section-number-3">3.1</span> Nginx 介绍</h3>
<div class="outline-text-3" id="text-3-1">
<pre class="example">
Nginx是一款免费、开源、高效的 HTTP 服务器，Nginx是以稳定著称，丰富的功能，结构简单，低资源消耗。

</pre>
</div>
</div>
<div id="outline-container-org72bb42a" class="outline-3">
<h3 id="org72bb42a"><span class="section-number-3">3.2</span> 配置yum源</h3>
<div class="outline-text-3" id="text-3-2">
<pre class="example">
[nginx]
name=nginx repo
baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
gpgcheck=0
enabled=1
</pre>
</div>
</div>
<div id="outline-container-org450cebc" class="outline-3">
<h3 id="org450cebc"><span class="section-number-3">3.3</span> 安装(Installing)</h3>
<div class="outline-text-3" id="text-3-3">
<pre class="example">
yum install -y nginx

</pre>

<pre class="example">
//设置nginx开机自启动
systemctl enable nginx.service

</pre>

<pre class="example">
//启动/停止/重新启动nginx
systemctl start/stop/restart nginx.service

</pre>
</div>
</div>
<div id="outline-container-org9dd2df4" class="outline-3">
<h3 id="org9dd2df4"><span class="section-number-3">3.4</span> 打开 HTTP 和 HTTPS 防火墙端口</h3>
<div class="outline-text-3" id="text-3-4">
<pre class="example">
firewall-cmd –permanent –zone=public –add-service=http
firewall-cmd –permanent –zone=public –add-service=https
firewall-cmd –reload

</pre>
</div>
</div>
<div id="outline-container-orgad62202" class="outline-3">
<h3 id="orgad62202"><span class="section-number-3">3.5</span> 配置Nginx</h3>
<div class="outline-text-3" id="text-3-5">
</div>
<div id="outline-container-org7d4a121" class="outline-4">
<h4 id="org7d4a121"><span class="section-number-4">3.5.1</span> /etc/nginx/conf.d/default.conf</h4>
<div class="outline-text-4" id="text-3-5-1">
<pre class="example">
环境要求:能够正常访问网页

</pre>
<div class="org-src-container">
<pre class="src src-emacs_lisp">server {
    listen       80;
    server_name  localhost;

    #charset koi8-r;
    access_log  /var/log/nginx/default.access.log  main;

    location / {
	root   /srv/www;
	index  index.php index.html index.htm;
    }

    error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
	root   /srv/www;
    }

    # proxy the PHP scripts to Apache listening on 127.0.0.1:80
    #
    #location ~ \.php$ {
    #    proxy_pass   http://127.0.0.1;
    #}

    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    location ~ \.php$ {
	root           /srv/www;
	fastcgi_pass   127.0.0.1:9000;
	fastcgi_index  index.php;
	fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
	include        fastcgi_params;
    }

    # deny access to .htaccess files, if Apache's document root
    # concurs with nginx's one
    #
    location ~ /\.ht {
	deny  all;
    }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org15698fe" class="outline-4">
<h4 id="org15698fe"><span class="section-number-4">3.5.2</span> /etc/nginx/conf.d/vhosts/finance.conf</h4>
<div class="outline-text-4" id="text-3-5-2">
<pre class="example">
环境要求：php, ThinkPHP5, pathinfo,  

</pre>
<div class="org-src-container">
<pre class="src src-emacs-lisp">server {
    listen       8080<span style="color: #b22222;">;</span>
    server_name  localhost<span style="color: #b22222;">;</span>

    #charset koi8-r<span style="color: #b22222;">;</span>
    access_log  /var/log/nginx/finance.access.log  main<span style="color: #b22222;">;</span>

    location / {
        root   /srv/www/finance/public<span style="color: #b22222;">;</span>
        index  index.php index.html index.htm<span style="color: #b22222;">;</span>
        if (!-e $request_filename) {
                rewrite  ^(.*)$ /index.php?s=/$1 last<span style="color: #b22222;">;</span>
                break<span style="color: #b22222;">;</span>
        }
    }

    error_page  404              /404.html<span style="color: #b22222;">;</span>

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html<span style="color: #b22222;">;</span>
    location = /50x.html {
        root   /srv/www<span style="color: #b22222;">;</span>
    }

    # proxy the PHP scripts to Apache listening on 127.0.0.1:80
    #
    #location ~ \.php$ {
    #    proxy_pass   http://127.0.0.1<span style="color: #b22222;">;</span>
    #}

    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    location ~ \.php$ {
         root           /srv/www/finance/public<span style="color: #b22222;">;</span>
         fastcgi_pass   127.0.0.1:9000<span style="color: #b22222;">;</span>
         fastcgi_index  index.php<span style="color: #b22222;">;</span>
         fastcgi_param  PHP_VALUE  <span style="color: #8b2252;">"open_basedir=/srv/www/finance/:/tmp/:/proc/"</span><span style="color: #b22222;">;</span>
         fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name<span style="color: #b22222;">;</span>
         include        fastcgi_params<span style="color: #b22222;">;</span>

         set $real_script_name $fastcgi_script_name<span style="color: #b22222;">;</span>
            if ($fastcgi_script_name ~ <span style="color: #8b2252;">"^(.+?\.php)(/.+)$"</span>) {
            set $real_script_name $1<span style="color: #b22222;">;</span>
            set $path_info $2<span style="color: #b22222;">;</span>
         }
         fastcgi_param SCRIPT_FILENAME $document_root$real_script_name<span style="color: #b22222;">;</span>
         fastcgi_param SCRIPT_NAME $real_script_name<span style="color: #b22222;">;</span>
         fastcgi_param PATH_INFO $path_info<span style="color: #b22222;">;</span>
    }

    # deny access to .htaccess files, if Apache's document root
    # concurs with nginx's one
    #
    location ~ /\.ht {
        deny  all<span style="color: #b22222;">;</span>
    }
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf447a9a" class="outline-4">
<h4 id="orgf447a9a"><span class="section-number-4">3.5.3</span> nginx问题解决</h4>
<div class="outline-text-4" id="text-3-5-3">
<pre class="example">
1. 403 Forbidden
问题分析：1）检查文件或目录(/srv/www/)权限问题；2）配置检查：访问文件类型，index index.php index.html index.htm

</pre>

<pre class="example">
2.访问时，出现以下内容：
File not found. 
No input file specified.
问题分析：1）检查路径配置是否正确；2）检查php-fpm配置

</pre>

<pre class="example">
3.

</pre>
</div>
</div>
</div>
<div id="outline-container-orgafe4da4" class="outline-3">
<h3 id="orgafe4da4"><span class="section-number-3">3.6</span> 参考资料</h3>
<div class="outline-text-3" id="text-3-6">
<pre class="example">
http://www.nginx.cn/231.html
https://www.nginx.com/
https://www.nginx.com/resources/wiki/start/topics/tutorials/install/

</pre>
</div>
</div>
</div>
<div id="outline-container-orgf74b9e7" class="outline-2">
<h2 id="orgf74b9e7"><span class="section-number-2">4</span> 安装MySQL</h2>
<div class="outline-text-2" id="text-4">
<pre class="example">
注意：这里下载的是rpm安装包。

</pre>
<div class="org-src-container">
<pre class="src src-emacs-lisp">1.rpm&#23433;&#35013;&#26102;&#65292;&#25253;&#22914;&#19979;&#38169;&#35823;&#65292;&#36825;&#26159;&#22240;&#20026;&#38656;&#35201;&#23433;&#35013;&#36825;&#20123;&#20381;&#36182;&#21253;&#65306;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/mysql-1.png" alt="mysql-1.png" align="center" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#25110;&#26159;&#36825;&#26679;&#65306;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/mysql-2.png" alt="mysql-2.png" align="center" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#22914;&#26524;&#26159;&#31532;&#19968;&#20010;&#22270;&#25152;&#31034;&#38169;&#35823;&#65292;&#21487;&#20197;&#19979;&#36733;&#23433;&#35013;numactl&#65292;
# wget http://mirror.centos.org/centos/6/os/x86_64/Packages/numactl-2.0.9-2.el6.x86_64.rpm
# rpm -ivh numactl-2.0.9-2.el6.x86_64.rpm

&#22914;&#26524;&#26159;&#31532;&#20108;&#20010;&#22270;&#25152;&#31034;&#38169;&#35823;&#65292;&#21487;&#20197;
#rpm -ivh glibc-2.17-4.17.1.x86_64.rpm --force
</pre>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#25509;&#30528;&#20381;&#27425;&#23433;&#35013;mysql&#38468;&#24102;&#36719;&#20214;&#65306;
# rpm -ivh mysql-community-libs-5.6.28-2.sles12.x86_64.rpm
# rpm -ivh mysql-community-client-5.6.28-2.sles12.x86_64.rpm
# rpm -ivh mysql-community-common-5.6.28-2.sles12.x86_64.rpm
# rpm -ivh mysql-community-server-5.6.28-2.sles12.x86_64.rpm

&#22312;&#27492;&#23433;&#35013;&#36807;&#31243;&#20013;&#65292;&#21487;&#33021;&#24050;&#32463;&#23433;&#35013;&#23427;&#20854;&#20182;&#29256;&#26412;&#30340;mysql&#65292;&#21487;&#20197;&#36890;&#36807;&#21024;&#38500;&#20854;&#20182;&#29256;&#26412;&#65292;&#22312;&#36827;&#34892;&#23433;&#35013;&#12290;
</pre>
</div>
<pre class="example">
安装完成后，可以通过 # mysql_secure_installation 命令设置root用户密码。

</pre>
</div>
<div id="outline-container-orgc278ff0" class="outline-3">
<h3 id="orgc278ff0"><span class="section-number-3">4.1</span> 安装MariaDB</h3>
<div class="outline-text-3" id="text-4-1">
<pre class="example">
//非源码安装方式
yum install mariadb mariadb-server net-tools

</pre>
</div>
</div>
</div>
<div id="outline-container-org689bb75" class="outline-2">
<h2 id="org689bb75"><span class="section-number-2">5</span> 安装PHP</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org461f00d" class="outline-3">
<h3 id="org461f00d"><span class="section-number-3">5.1</span> 安装php扩展</h3>
<div class="outline-text-3" id="text-5-1">
</div>
<div id="outline-container-org9b8d2d7" class="outline-4">
<h4 id="org9b8d2d7"><span class="section-number-4">5.1.1</span> jpeg</h4>
<div class="outline-text-4" id="text-5-1-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#23448;&#32593;&#19979;&#36733;&#22320;&#22336;&#65306;http://www.ijg.org/
&#23433;&#35013;&#26102;&#38656;&#35201;&#22312;&#23433;&#35013;&#30446;&#24405;jpeg&#19979;&#26032;&#24314;bin&#65292;include&#65292;lib&#65292;man/man1&#30446;&#24405;&#12290;
#tar -zvxf jpegsrc.v6b.tar.gz
#cd jpeg-6b
#CFLAGS=<span style="color: #8b2252;">"-O3 -fPIC"</span> ./configure --prefix=/usr/local/jpeg6/ --enable-shared --enable-static
&#27492;&#26102;&#21487;&#33021;&#20250;&#25253;&#20986;&#29616;&#22914;&#19979;&#38169;&#35823;&#65306;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/php-1.png" alt="php-1.png" align="center" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#35299;&#20915;&#65306;&#22797;&#21046;config.guess&#21644;config.sub&#21040;&#23433;&#35013;&#30446;&#24405;&#19979;
#cp /usr/share/libtool/config/config.guess ./
#cp /usr/share/libtool/config/config.sub ./
&#20877;&#27425;&#25191;&#34892;&#19978;&#38754;&#30340;&#37197;&#32622;&#35821;&#21477;&#12290;&#38382;&#39064;&#35299;&#20915;&#12290;
&#20351;&#29992;64&#20301;&#20989;&#25968;&#24211;&#32534;&#35793;&#23433;&#35013;&#65306;
make libdir=/usr/lib64 <span style="color: #228b22;">&amp;&amp;</span> make libdir=/usr/lib64 install
&#25104;&#21151;&#26631;&#24535;&#65306;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/php-2.png" alt="php-2.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-orgd0a1a04" class="outline-4">
<h4 id="orgd0a1a04"><span class="section-number-4">5.1.2</span> libpng</h4>
<div class="outline-text-4" id="text-5-1-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">libpng&#26080;&#38656;&#37197;&#32622;
#cp scripts/makefile.std makefile
#vim makefile 
&#25214;&#21040;CFLAGS&#65292;&#21152;&#20837;-O3 -fPIC -I$(ZLIBINC)
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/php-3.png" alt="php-3.png" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">#make <span style="color: #228b22;">&amp;&amp;</span> make install
&#27492;&#26102;&#65292;&#21487;&#33021;&#20250;&#20986;&#29616;&#38169;&#35823;&#65292;&#35299;&#20915;&#65306;&#20808;&#25226;Zlib&#23433;&#35013;&#20102;&#65292;&#22312;&#37325;&#26032;&#23433;&#35013;libpng&#65292;&#22914;&#26524;&#20173;&#28982;&#25253;&#38169;&#65292;&#36816;&#34892;&#23433;&#35013;zlib-devel
 rpm -ivh zlib-devel-1.2.8-5.1.2.x86_64.rpm
</pre>
</div>
<p>
<img src="http://localhost:4000/assets/images/php-4.png" alt="php-4.png" />
重新编译出现下图提示信息，此时只需执行下面两个命令即可：
<img src="http://localhost:4000/assets/images/php-5.png" alt="php-5.png" />
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">#make clean
&#22312;&#36816;&#34892;&#19968;&#19979;&#65306;
#ldconfig    #&#21160;&#24577;&#38142;&#25509;&#24211;&#31649;&#29702;&#21629;&#20196;&#65292;
</pre>
</div>
</div>
</div>
<div id="outline-container-org2a8a319" class="outline-4">
<h4 id="org2a8a319"><span class="section-number-4">5.1.3</span> freetype</h4>
<div class="outline-text-4" id="text-5-1-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">Freetypr:http://download.savannah.gnu.org/releases/freetype/freetype-2.3.5.tar.gz
# ./configure --prefix=/usr/local/freetype
&#25104;&#21151;&#26631;&#24535;&#65306;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/php-6.png" alt="php-6.png" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">#make <span style="color: #228b22;">&amp;&amp;</span> make install
&#25104;&#21151;&#26631;&#24535;&#65306;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/php-7.png" alt="php-7.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-orgb26917c" class="outline-4">
<h4 id="orgb26917c"><span class="section-number-4">5.1.4</span> zlib</h4>
<div class="outline-text-4" id="text-5-1-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">#./configure --prefix=/usr/local/zlib
&#25104;&#21151;&#26631;&#24535;&#65306;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/php-8.png" alt="php-8.png" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">#make <span style="color: #228b22;">&amp;&amp;</span> make install
&#25104;&#21151;&#26631;&#24535;&#65306;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/php-9.png" alt="php-9.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-org0c9e270" class="outline-4">
<h4 id="org0c9e270"><span class="section-number-4">5.1.5</span> gd</h4>
<div class="outline-text-4" id="text-5-1-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">CFLAGS=<span style="color: #8b2252;">"-O3 -fPIC"</span> ./configure --prefix=/usr/local/gd --with-jpeg=/usr/local/jpeg 
 --with-png=/usr/local/lib --with-zlib=/usr/local/zlib --with-freetype=/usr/local/freetype
&#25104;&#21151;&#26631;&#24535;&#65306;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/php-10.png" alt="php-10.png" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#32534;&#35793;&#23433;&#35013;&#65306;
# make <span style="color: #228b22;">&amp;&amp;</span> make install
&#21487;&#33021;&#20250;&#25253;&#22914;&#19979;&#38169;&#35823;&#65292;&#26816;&#26597;libpng&#26159;&#21542;&#23433;&#35013;&#27491;&#30830;&#12290;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/php-11.png" alt="php-11.png" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#23433;&#35013;&#23436;&#25104;&#26631;&#24535;&#65306;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/php-12.png" alt="php-12.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-orge446245" class="outline-4">
<h4 id="orge446245"><span class="section-number-4">5.1.6</span> curl</h4>
<div class="outline-text-4" id="text-5-1-6">
<pre class="example">
下载地址 http://curl.haxx.se/
#./configure --prefix=/usr/local/curl
#make &amp;&amp; make install ，成功标志:

</pre>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/php-13.png" alt="php-13.png" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org551eb21" class="outline-3">
<h3 id="org551eb21"><span class="section-number-3">5.2</span> 安装php</h3>
<div class="outline-text-3" id="text-5-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">#tar zxvf php-5.4.45.tar.gz
#cd php-5.4.45
#./configure --prefix=/usr/local/php --with-apxs2=/usr/local/apache2/bin/apxs --with-gd
  --with-jpeg-dir=/usr/local/jpeg6 --with-zlib-dir=/usr/local/zlib --with-png-dir=/usr/local/lib 
  --with-freetype-dir=/usr/local/freetype --with-curl=/usr/local/curl --with-mysql --with-pdo-mysql 
  --with-mysqli --enable-ftp --with-pcre-regex --with-mhash --enable-fpm --enable-mbstring
  --enable-sockets --enable-sysvsem --enable-sysvshm --enable-pcntl --enable-mbregex --enable-zip
  &#27492;&#26102;&#65292;&#20250;&#25253;&#19979;&#22270;&#38169;&#35823;&#65292;&#35299;&#20915;&#21150;&#27861;&#23601;&#26159;&#23433;&#35013;zlib-devel&#65292;# zypper in libxml2-devel -y
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/php-14.png" alt="php-14.png" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#37325;&#26032;&#25191;&#34892;&#19978;&#38754;&#30340;&#37197;&#32622;&#21629;&#20196;&#12290;
&#20986;&#29616;&#23383;&#26679;<span style="color: #8b2252;">"Thank you for using PHP."</span>&#65292;&#34920;&#31034;&#25104;&#21151;&#20102;.
&#25104;&#21151;&#26631;&#24535;&#65306;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/php-15.png" alt="php-15.png" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#32534;&#35793;&#23433;&#35013;&#65306;# make <span style="color: #228b22;">&amp;&amp;</span> make install &#65292;&#25104;&#21151;&#26631;&#24535;&#65306;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/php-16.png" alt="php-16.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-orge89aac5" class="outline-3">
<h3 id="orge89aac5"><span class="section-number-3">5.3</span> 检测PHP是否安装成功</h3>
<div class="outline-text-3" id="text-5-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#35831;&#26816;&#26597;httpd.conf&#25991;&#20214;&#20013;&#65292;&#19979;&#38754;&#20004;&#34892;&#20195;&#30721;&#26159;&#21542;&#24050;&#28155;&#21152;&#65306;
LoadModule php5_module        modules/libphp5.so
...
AddType application/x-httpd-php .php
AddType application/x-httpd-php-source .phps
...
&lt;IfModule dir_module&gt;
DirectoryIndex index.php index.html
&lt;/IfModule&gt;

&#32534;&#36753;&#23436;&#25104;&#21518;&#65292;&#37325;&#21551;apache&#65306; /etc/init.d/apachectl restart

&#21019;&#24314;&#21644;&#32534;&#36753;php.ini&#65306;
#cp php.ini-development /usr/local/php/lib64/
#cd  /usr/local/php/lib64/
#cp php.ini-development php.ini
#vim php.ini
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/php-17.png" alt="php-17.png" />
</p>
</div>
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#26032;&#24314;&#25991;&#20214;&#26597;&#30475;phpinfo&#26159;&#21542;&#37117;&#24050;&#21152;&#36733;&#24182;&#27491;&#24120;&#26174;&#31034;&#65292;
&lt;?php
phpinfo()<span style="color: #b22222;">;</span>
?&gt;
</pre>
</div>
</div>
</div>
<div id="outline-container-org9a9c311" class="outline-3">
<h3 id="org9a9c311"><span class="section-number-3">5.4</span> bcmath扩展安装</h3>
<div class="outline-text-3" id="text-5-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#20063;&#35768;&#36825;&#20010;&#25193;&#23637;&#20250;&#29992;&#21040;&#12290;

&#19968;&#33324;&#24773;&#20917;&#19979;&#36825;&#20010;&#25193;&#23637;&#22312;php&#23433;&#35013;&#30340;&#26102;&#20505;&#65292;&#26159;&#23384;&#22312;&#23433;&#35013;&#21253;&#20013;ext/bcmath&#30446;&#24405;&#19979;&#12290;&#21033;&#29992;phpize&#36827;&#34892;&#23433;&#35013;&#26032;&#30340;php&#25193;&#23637;&#12290;
#cd ext/bcmath/
#/usr/local/php/bin/phpize                    &#65307;&#25191;&#34892;(phpize&#30340;&#36335;&#24452;&#26681;&#25454;&#21508;&#33258;&#23433;&#35013;&#26377;&#25152;&#19981;&#21516;)
#find /usr/local/php/ -name php-config                &#65307;&#20808;&#26597;&#25214;php-config&#22312;&#21738;&#20010;&#22320;&#26041;
#./configure --with-php-config=/usr/local/php/bin/php-config          &#65307;&#37197;&#32622;bcmath
# make
# make install
# find /usr/local/php/ -name bcmath.so            &#65307;&#26597;&#30475;bcmath.so&#22312;&#37027;&#20010;&#36335;&#24452;&#19979;
&#29616;&#22312;&#37197;&#32622;php&#65292;&#21046;&#23450;&#25193;&#23637;&#36335;&#24452;&#21450;&#21152;&#36733;so&#25991;&#20214;&#65306;
</pre>
</div>

<div class="figure">
<p><img src="http://localhost:4000/assets/images/php-18.png" alt="php-18.png" />
</p>
</div>
<pre class="example">
需要安装其他扩展，使用同样的操作。

</pre>
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#29305;&#21035;&#25552;&#31034;1&#65306;
 &#21487;&#33021;&#22312;make&#30340;&#26102;&#20505;&#65292;&#20250;&#36935;&#21040;&#38169;&#35823;
 &#38169;&#35823;&#65306;&#8216;<span style="color: #008b8b;">PHP_FE_END</span>&#8217;&#26410;&#22768;&#26126;(&#19981;&#22312;&#20989;&#25968;&#20869;) -----{error: &#8216;<span style="color: #008b8b;">PHP_FE_END</span>&#8217; undeclared here (not in a function)}
 &#35299;&#20915;&#26041;&#27861;&#65306; &#28304;&#20195;&#30721;&#26377;&#38169;&#35823;&#65292;&#36827;&#20837;php-5.3.18/ext/mcrypt&#30446;&#24405;
 sed -i 's|PHP_FE_END|{NULL,NULL,NULL}|' ./*.c
 sed -i 's|ZEND_MOD_END|{NULL,NULL,NULL}|' ./*.c
 &#20877;&#37325;&#26032;make <span style="color: #228b22;">&amp;&amp;</span> make install

&#29305;&#21035;&#25552;&#31034;2&#65306;
 openssl&#25193;&#23637;&#23433;&#35013;&#65292;&#38656;&#35201;&#23433;&#35013;libssl-dev,
 $ sudo apt-get install libssl-dev

&#29305;&#21035;&#25552;&#31034;3&#65306;
 openssl&#25193;&#23637;&#23433;&#35013;&#37197;&#32622;&#26102;&#65292;&#20986;&#29616;&#38169;&#35823;&#20449;&#24687;&#65306;cannot find config.m4
 &#35299;&#20915;&#65306;mv config0.m4 config.m4
</pre>
</div>
</div>
</div>
<div id="outline-container-orga9bdd65" class="outline-3">
<h3 id="orga9bdd65"><span class="section-number-3">5.5</span> php-fpm配置</h3>
<div class="outline-text-3" id="text-5-5">
<pre class="example">
cp /usr/local/php/etc/php-fpm.conf.default etc/php-fpm.conf
vim /usr/local/php/etc/php-fpm.conf
content:
        user=username
        group=groupname

</pre>

<pre class="example">
//开启php-fpm
/usr/local/php/sbin/php-fpm start

</pre>
</div>
</div>
</div>
<div id="outline-container-org9a916df" class="outline-2">
<h2 id="org9a916df"><span class="section-number-2">6</span> Memcache安装指南</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-org61ce947" class="outline-3">
<h3 id="org61ce947"><span class="section-number-3">6.1</span> 服务端安装</h3>
<div class="outline-text-3" id="text-6-1">
<pre class="example">
//安装必须组件
$apt-get install libevent-dev
或下载libevent-dev源码安装：libevent.org or https://sourceforge.net/projects/levent/

</pre>

<pre class="example">
//下载Memcached
网址：http://memcached.org/downloads

</pre>

<pre class="example">
//安装Memcached
$tar zxvf memcached-1.5.4.tar.gz
$cd memcached-1.5.4
$./configure --prefix=/usr/local/memcached --with-libevent=/usr/local/libevent
$make &amp;&amp; make install
或通过apt-get命令直接安装：$apt-get install memcached

</pre>

<pre class="example">
//启动Memcached
$/usr/local/memcached/bin/memcached -m 64 -p 11211 -u nobody -vv -d
-d表示在后台运行
$ps aux |grep memcached

</pre>
</div>
</div>
<div id="outline-container-org52f0242" class="outline-3">
<h3 id="org52f0242"><span class="section-number-3">6.2</span> 客户端安装</h3>
<div class="outline-text-3" id="text-6-2">
</div>
<div id="outline-container-org131a1e9" class="outline-4">
<h4 id="org131a1e9"><span class="section-number-4">6.2.1</span> 第一步，安装libmemcached库</h4>
<div class="outline-text-4" id="text-6-2-1">
<pre class="example">
//下载libmemcached
网址：https://launchpad.net/

</pre>

<pre class="example">
//解压安装
$tar zxvf libmemcached-1.0.18.tar.gz
$cd libmemcached-1.0.18
$./configure --prefix=/usr/local/libmemcached
#make &amp;&amp; make install

</pre>
</div>
</div>
<div id="outline-container-org3556dfd" class="outline-4">
<h4 id="org3556dfd"><span class="section-number-4">6.2.2</span> 第二步，安装PHP memcache、memcached扩展</h4>
<div class="outline-text-4" id="text-6-2-2">
<p>
### memcache 扩展
</p>
<pre class="example">
$git clone https://github.com/websupport-sk/pecl-memcache memcache
$cd memcache
$/usr/local/php7/bin/phpize
$./configure --with-php-config=/usr/local/php7/bin/php-config
#make &amp;&amp; make install
//编辑php.ini文件，加入：extension=memcache.so
//重启Apache，查看memcache扩展是否加载

</pre>
<p>
### memcached 扩展
</p>
<pre class="example">
$git clone https;//github.com/php-memcached-dev/php-memcached.git
$cd php-memcached
$git checkout php7 //进入php7分支
$/usr/local/php7/bin/phpize
$./configure --with-php-config=/usr/local/php7/bin/php-config \
--with-libmemcached-dir=/usr/local/libmemcached
--disable-memcached-sasl
//同样，编辑PHP配置文件，加入：extension=memcached.so
//重启Apache，查看memcached扩展是否加载

</pre>
</div>
</div>
</div>
<div id="outline-container-orge1c5af1" class="outline-3">
<h3 id="orge1c5af1"><span class="section-number-3">6.3</span> 参考资料</h3>
<div class="outline-text-3" id="text-6-3">
<pre class="example">
memcache官网：http://memcache.org/
Linux Memcached 安装：http://www.runoob.com/memcached/memcached-install.html
linux下安装PHP memcached扩展：http://www.cnblogs.com/flywind/p/6021568.html
编译安装Memcached勾结php7：https://www.jianshu.com/p/c7e59afabc28
PHP7 下安装 memcache 和 memcached 扩展：http://www.lnmp.cn/install-memcache-and-memcached-extends-under-php7.html
Linux下的Memcache安装：http://kimi.it/257.html
Memcache基础教程：http://kimi.it/259.html

</pre>
</div>
</div>
</div>
<div id="outline-container-orgd7bf162" class="outline-2">
<h2 id="orgd7bf162"><span class="section-number-2">7</span> 再次声明</h2>
<div class="outline-text-2" id="text-7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">&#30001;&#20110;&#27599;&#21488;&#26426;&#22120;&#23433;&#35013;&#30340;&#31995;&#32479;&#24182;&#38750;&#23436;&#20840;&#19968;&#26679;&#65292;&#23433;&#35013;&#31995;&#32479;&#26102;&#33258;&#24102;&#30340;&#21253;&#26377;&#25152;&#24046;&#24322;&#65292;&#25152;&#20197;&#35813;&#25351;&#21335;&#20165;&#20379;&#21442;&#32771;&#12290;&#20851;&#20110;&#35813;&#25351;&#21335;&#65292;&#22914;&#26524;&#20320;&#26377;&#20219;&#20309;&#38382;&#39064;&#65292;
&#20320;&#21487;&#20197;&#21457;&#37038;&#20214;&#21040;&#25105;&#30340;&#37038;&#31665;&#65292;&#37038;&#31665;&#22320;&#22336;&#20026; zrg1390556487@gmail.com
</pre>
</div>
</div>
</div>
<div id="outline-container-org9d6dc1f" class="outline-2">
<h2 id="org9d6dc1f"><span class="section-number-2">8</span> 参考资料</h2>
<div class="outline-text-2" id="text-8">
<pre class="example">
https://xwsoul.com/posts/684

</pre>

<pre class="example">
http://php.net/
http://www.apache.org/
https://www.mysql.com/
https://mariadb.org/

</pre>
</div>
</div>


      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            
            <a href="/tag/#/Apache" rel="tag"># Apache</a>
          
            
            <a href="/tag/#/Nginx" rel="tag"># Nginx</a>
          
            
            <a href="/tag/#/MySQL" rel="tag"># MySQL</a>
          
            
            <a href="/tag/#/PHP" rel="tag"># PHP</a>
          
            
            <a href="/tag/#/PHP-Extension" rel="tag"># PHP-Extension</a>
          
            
            <a href="/tag/#/Memcache" rel="tag"># Memcache</a>
          
            
            <a href="/tag/#/Redis" rel="tag"># Redis</a>
          
        </div>
      

      
      
      
      
      

      
      
        <div class="post-nav" id="post-nav-id">
          <div class="post-nav-next post-nav-item">
            
              <a href="/python/2016/05/23/selenium-with-python/" rel="next" title="To Learn Python from Selenium">
                <i class="fa fa-chevron-left"></i> To Learn Python from Selenium
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/software/2015/11/06/using-vim/" rel="prev" title="Vim 使用笔记">
                Vim 使用笔记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      
      

      
    </footer>
  </article>

  <div class="post-spread">
    
  </div>
</div>


          </div>
          


          

        </div>
        
          

  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      
        
        
        







      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/assets/images/avatar.gif"
               alt="Zhao Rengui" />
          <p class="site-author-name" itemprop="name">Zhao Rengui</p>
           
              <p class="site-description motion-element" itemprop="description">Life doesn't just happen to you; you receive everything in your life based on what you've given. 生命中的一切都不是巧合，你得到什么，是源于你付出了什么。</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">53</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/">
                <span class="site-state-item-count">82</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
        
        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              
              
              <span class="links-of-author-item">
                <a href="https://github.com/zhaorengui" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              
              
              <span class="links-of-author-item">
                <a href="https://weibo.com/zhaorengui" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                
                
                <li class="links-of-blogroll-item">
                  <a href="https://jiangshengfei.github.io/" title="JiangShengfei" target="_blank">JiangShengfei</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            








            
              <div class="post-toc-content">
    <ol class=nav>
      <li class="nav-item nav-level-2"> <a class="nav-link" href="#orgc26e699"> <span class="nav-text">1 前言(Preface)</span> </a> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#org8142e65"> <span class="nav-text">2 安装Apache</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-3"> <a class="nav-link" href="#org769e555"> <span class="nav-text">2.1 解压</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#org2bf2b9f"> <span class="nav-text">2.2 配置</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#org78ea8dd"> <span class="nav-text">2.3 安装APR和APR-util</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#org6f6539d"> <span class="nav-text">2.4 运行安装apache（httpd）</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#orgd407e62"> <span class="nav-text">2.5 启动Apache</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#orga91716c"> <span class="nav-text">2.6 设置开机启动</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#orga84b210"> <span class="nav-text">2.7 配置Virtual Host</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-4"> <a class="nav-link" href="#orgd7c5c6c"> <span class="nav-text">2.7.1 Configure virtual host</span> </a> </li> <li class="nav-item nav-level-4"> <a class="nav-link" href="#org1af3f18"> <span class="nav-text">2.7.2 Configure multiple ports and multiple sites</span> </a> </li> </ol> </li> </ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#org092da7f"> <span class="nav-text">3 安装Nginx</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-3"> <a class="nav-link" href="#orgf28b42c"> <span class="nav-text">3.1 Nginx 介绍</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#org72bb42a"> <span class="nav-text">3.2 配置yum源</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#org450cebc"> <span class="nav-text">3.3 安装(Installing)</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#org9dd2df4"> <span class="nav-text">3.4 打开 HTTP 和 HTTPS 防火墙端口</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#orgad62202"> <span class="nav-text">3.5 配置Nginx</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-4"> <a class="nav-link" href="#org7d4a121"> <span class="nav-text">3.5.1 /etc/nginx/conf.d/default.conf</span> </a> </li> <li class="nav-item nav-level-4"> <a class="nav-link" href="#org15698fe"> <span class="nav-text">3.5.2 /etc/nginx/conf.d/vhosts/finance.conf</span> </a> </li> <li class="nav-item nav-level-4"> <a class="nav-link" href="#orgf447a9a"> <span class="nav-text">3.5.3 nginx问题解决</span> </a> </li> </ol> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#orgafe4da4"> <span class="nav-text">3.6 参考资料</span> </a> </li> </ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#orgf74b9e7"> <span class="nav-text">4 安装MySQL</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-3"> <a class="nav-link" href="#orgc278ff0"> <span class="nav-text">4.1 安装MariaDB</span> </a> </li> </ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#org689bb75"> <span class="nav-text">5 安装PHP</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-3"> <a class="nav-link" href="#org461f00d"> <span class="nav-text">5.1 安装php扩展</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-4"> <a class="nav-link" href="#org9b8d2d7"> <span class="nav-text">5.1.1 jpeg</span> </a> </li> <li class="nav-item nav-level-4"> <a class="nav-link" href="#orgd0a1a04"> <span class="nav-text">5.1.2 libpng</span> </a> </li> <li class="nav-item nav-level-4"> <a class="nav-link" href="#org2a8a319"> <span class="nav-text">5.1.3 freetype</span> </a> </li> <li class="nav-item nav-level-4"> <a class="nav-link" href="#orgb26917c"> <span class="nav-text">5.1.4 zlib</span> </a> </li> <li class="nav-item nav-level-4"> <a class="nav-link" href="#org0c9e270"> <span class="nav-text">5.1.5 gd</span> </a> </li> <li class="nav-item nav-level-4"> <a class="nav-link" href="#orge446245"> <span class="nav-text">5.1.6 curl</span> </a> </li> </ol> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#org551eb21"> <span class="nav-text">5.2 安装php</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#orge89aac5"> <span class="nav-text">5.3 检测PHP是否安装成功</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#org9a9c311"> <span class="nav-text">5.4 bcmath扩展安装</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#orga9bdd65"> <span class="nav-text">5.5 php-fpm配置</span> </a> </li> </ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#org9a916df"> <span class="nav-text">6 Memcache安装指南</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-3"> <a class="nav-link" href="#org61ce947"> <span class="nav-text">6.1 服务端安装</span> </a> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#org52f0242"> <span class="nav-text">6.2 客户端安装</span> </a> <ol class="nav-child"> <li class="nav-item nav-level-4"> <a class="nav-link" href="#org131a1e9"> <span class="nav-text">6.2.1 第一步，安装libmemcached库</span> </a> </li> <li class="nav-item nav-level-4"> <a class="nav-link" href="#org3556dfd"> <span class="nav-text">6.2.2 第二步，安装PHP memcache、memcached扩展</span> </a> </li> </ol> </li> <li class="nav-item nav-level-3"> <a class="nav-link" href="#orge1c5af1"> <span class="nav-text">6.3 参考资料</span> </a> </li> </ol> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#orgd7bf162"> <span class="nav-text">7 再次声明</span> </a> </li> <li class="nav-item nav-level-2"> <a class="nav-link" href="#org9d6dc1f"> <span class="nav-text">8 参考资料</span> </a> </li>
    </ol>
  </div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>

        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  
  &copy;  2018 - 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhao Rengui</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://jekyllrb.com">Jekyll</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/simpleyyt/jekyll-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





















  
   
  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/jquery/index.js?v=2.1.3"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  
  
  
  
  <script type="text/javascript" src="/assets/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/assets/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/assets/js/src/motion.js?v=5.1.1"></script>



  
  

  <script type="text/javascript" src="/assets/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/assets/js/src/post-details.js?v=5.1.1"></script>


  


  <script type="text/javascript" src="/assets/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  











  




  

    

  





  


  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  


  

  

  

</body>
</html>

