---
layout: post
title: Debian GNU/Linux
author: zrg
comments: false
description: 这是一篇关于Debain GNU/Linux 操作系统的使用笔记.
categories:
- linux
tags:
- Debian
photos:
- https://www.debian.org/Pics/openlogo-50.png
---

<p>
本文题目应该是“Linux 操作系统”，只因平时都是使用 Debian，所以 Title 就是“Debian GNU/Linux”）。以下就是我从开始接触 Linux 到现在的一些使用笔记。
</p>

<div id="outline-container-orgf1c0259" class="outline-2">
<h2 id="orgf1c0259"><span class="section-number-2">1</span> 前言(Preface)</h2>
<div class="outline-text-2" id="text-1">
<pre class="example">
欢迎阅读本册子，和其他大‘全图书不一样，本册子以实践的方式介绍Linux基础、Linux服务架构和Linux实用技巧，涵盖了详尽的动手教程和实践信息，还提供了
与内容相关的参考资料。本册子可以作为Linux的操作参考工具书。作者会持续更新与完善内容，血不流干，死不休战。

</pre>
<p>
<b>读者对象</b>
</p>
<ul class="org-ul">
<li><p>
Linux 系统管理员
</p>
<pre class="example">
如果你是 Linux 环境下的系统管理员，那么本册子也许能为你提供一定的帮助。

</pre></li>
<li><p>
Linux 爱好者
</p>
<pre class="example">
如果你是 Linux 爱好者，本册子将告诉你部分问题的解决办法及原因。

</pre></li>
</ul>
<p>
<b>本册子结构</b>
</p>
<pre class="example">
本册子将会引领你从认识 Linux 开始，一直到熟练使用 Linux。本册子分为五大部分。
第一部分，获取和安装 Linux 系统，Linux 配置，Linux 介绍。
第二部分，介绍 Linux 文件、目录及磁盘常见操作。
第三部分，学习及应用 shell scripts。
第四部分，属于 Linux 进阶篇，对于 Linux 系统管理员比较实用。
第五部分，聚集常见开发、运维中遇到的各种问题的解决办法。

</pre>
<p>
<b>阅读提示</b>
</p>
<ol class="org-ol">
<li>阅读本文时，每个知识章节都会有「参考资料」（中文）或「References」（英文）的章节，部分实际操作章节除外。</li>
<li>本文内容以笔记的形式记录，阅读时知识点不能完全列出，敬请见谅。内容以实际应用为主。</li>
</ol>
<p>
<b>作者</b>
</p>
<ul class="org-ul">
<li>zrg 的 Linux 学习之路（My road of learning Linux）
<ul class="org-ul">
<li>第一次接触 Linux 是由于大二上学期的 Linux 基础课，但是，我并没有喜欢上这个系统，因为关于 Linux 的一切，对我来说都是陌生的，我在想我既然已经对 Windows 操作系统，又何必去瞎折腾呢，况且 Windows 可以完成 Linux 上的所有事情（后来，我发现我错了）；另一方面，可能是由于授课老师的坚毅个性，让我不想再去学习它，尽管当时我自己是多么幼稚，多么可笑。</li>
<li>后来，当我在听说 Linux 用来当服务器使用很好的时候，我开始尝试使用它来完成一些工作的时候，开始我有点喜欢 Linux 操作系统，不断的尝试（学习）使用 Linux，发现使用 Linux 来完成编程开发越来越完美了。</li>
<li>再后来，就是现在了，能使用它搭建一些服务，使我的生活更加方便，并将一些网站之类的放在上面，下面就是平时使用 Linux 的总结，仅供参考！</li>
<li>尽管工作的大部分时间都在用 Windows 操作系统，但是对 Linux 系列的折腾从未停止过。</li>
<li>现在好了，今年（2018年）1月换了一份工作，公司使用的技术基本都是 Linux 上构建的，除了正常必要性开发，使用 Windows，使用 Linux 的时间将占据工作时间的 1/3。</li>
<li>#2018-08-22,更新中……</li>
</ul></li>
<li><p>
那些年用过的 Linux 操作系统
</p>
<pre class="example">
1.Ubuntu 12.04/14.04/16.04;
2.CentOS 6.0/7.0;
3.RedHat 7;
4.Debian 7/8/9;
5.SUSE Linux Enterprise server 11/12;
6.Raspberry pi Debian;

</pre></li>
<li><p>
英文太差，能学好 Linux 吗？
</p>
<pre class="example">
关于这个问题，可以参考一下两个链接，或许能让你收获点什么！

</pre>
<ul class="org-ul">
<li><a href="http://cs2.swfu.edu.cn/~wx672/lecture_notes/linux/en.html">Linux很有趣，可我的英文太差了，怎么办？</a></li>
<li><a href="http://www.yinwang.org/blog-cn/2018/11/23/grammar">解谜英语语法</a></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgeacb85d" class="outline-2">
<h2 id="orgeacb85d"><span class="section-number-2">2</span> 开始(Get Started)</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orgcdcd66a" class="outline-3">
<h3 id="orgcdcd66a"><span class="section-number-3">2.1</span> 安装(Install)</h3>
<div class="outline-text-3" id="text-2-1">
<pre class="example">
系统安装过程暂不详细介绍，主要对安装过程和安装后的常用操作做一下简单说明。

</pre>
</div>
<div id="outline-container-org02c3dfa" class="outline-4">
<h4 id="org02c3dfa"><span class="section-number-4">2.1.1</span> 主机规划与磁盘分区</h4>
</div>
<div id="outline-container-org457e9a9" class="outline-4">
<h4 id="org457e9a9"><span class="section-number-4">2.1.2</span> 安装后的常见操作</h4>
<div class="outline-text-4" id="text-2-1-2">
</div>
<ol class="org-ol">
<li><a id="org6b4f82f"></a>查看 Linux 发行版名称及版本号<br />
<div class="outline-text-5" id="text-2-1-2-1">
<pre class="example">
1. 查看 Linux 内核版本
// 方式一
$ cat /proc/version
// 方式二
$ uname -a
2. 查看 Linux 系统版本
// 方式一(这个命令适用于所有的Linux发行版，包括Redhat、SuSE、Debian…等发行版。)
$ lsb_release -a
// 方式二(这种方法只适合Redhat系的Linux)
$ cat /etc/redhat-release
// 方式三(使用所有Linux版本)
$ cat /etc/issue

</pre>
</div>
</li>
<li><a id="orgd3d91ec"></a>Linux 上挂载NTFS格式文件系统<br />
<div class="outline-text-5" id="text-2-1-2-2">
<ul class="org-ul">
<li><p>
方案A（Scheme A）：使用linux-ntfs
</p>
<pre class="example">
1.
$ wget http://prdownloads.sourceforge.net/linux-ntfs/kernel-module-ntfs-2.6.18-92.el5-2.1.27-0.rr.10.11.x86_64.rpm
2.
# rpm -ivh kernel-module-ntfs-2.6.18-92.el5-2.1.27-0.rr.10.11.x86_64.rpm
3.
检查 ntfs 模块是否被加载进系统
$ /sbin/modprobe ntfs
 [没有输出则代表存在；否则（otherwise）将会有错误信息（error message）报出（report）]
$ cat /proc/filesystems
 [ntfs应该出现在列表中]
4.查看NTFS系统的编号
/sbin/fdisk -l |grep NTFS 
5.
#mkdir -p /mnt/win_ntfs
#mount -t ntfs /dev/sda1 /mnt/win_ntfs

</pre></li>
<li><p>
方案B（Scheme B）：使用fuse和ntfs-3g
</p>
<pre class="example">
1.
# wget http://downloads.sourceforge.net/project/fuse/fuse-2.X/2.7.4/fuse-2.7.4.tar.gz?use_mirror=ncu
# wget http://www.ntfs-3g.org/ntfs-3g-2009.4.4.tgz
2.
# tar -zxf fuse-2.7.4.tar.gz
# ./configure --prefix=/usr/local/fuse-2.7.4
# make 
# make install

</pre>

<pre class="example">
# tar -zxf ntfs-3g-2009.4.4.tgz
# ./configure --prefix=/usr/local/ntfs-3
# make 
# make install 
3.
检查fuse模块是否被加载进系统
$ /sbin/modprobe fuse
 [没有输出则代表存在；否则将会有错误信息报出]
$ cat /proc/filesystems
 [fuse应该出现在列表中]
4.
查看NTFS系统的编号 
$ /sbin/fdisk -l |grep NTFS 
5.
#mount ntfs-3g /dev/sda1 /mnt/win_ntfs

</pre>

<p>
参考：<a href="http://blog.163.com/flybood@126/blog/static/41230911201062165035335/">http://blog.163.com/flybood@126/blog/static/41230911201062165035335/</a>
</p></li>
<li>自动挂载 NTFS 格式硬盘
<ol class="org-ol">
<li><p>
安装 ntfs-3g
</p>
<pre class="example">
$ sudo apt-get install ntfs-3g

</pre></li>
<li><p>
步骤1：编辑/etc/fstab
</p>
<pre class="example">
$ sudo vim /etc/fstab
/dev/sdb1 /mnt/ntfs/ ntfs nls-utf8,umask-0222,uid-1000,gid-1000,ro 0 0
Notice:
   If /dev/sdb1 path will change due to system configuration, I recommend that you use
the UUID (Universally Unique Identifier) of the partition. To find the UUID of /dev/sdb1, enter:
翻译：/dev/sdb1 路径会随着系统配置而改变，建议使用 UUID （通用唯一标识符），下面是查看 UUID 的命令。
$ sudo /sbin/blkid /dev/sda1
//Note down the UUID value and update /etc/fstab as follows:
翻译：记录下 UUID，更新 /etc/fstab 文件。

</pre>
<div class="org-src-container">
<pre class="src src-emacs-lisp"># syntax
# UUID=<span style="color: #8b2252;">"YOUR-UID-HERE"</span> /mnt/ntfs/ ntfs nls-utf8,umask-0222,uid-1000,gid-1000,ro 0 0
UUID=<span style="color: #8b2252;">"c2dbc0c5-a8fc-439e-aa93-51b0a61372e8"</span> /mnt/ntfs/ ntfs nls-utf8,umask-0222,uid-1000,gid-1000,ro 0 0
# Owning entire file system
UUID=<span style="color: #8b2252;">"c2dbc0c5-a8fc-439e-aa93-51b0a61372e8"</span> /mnt/ntfs/ ntfs uid-1000,gid-1000 0 0
</pre>
</div>
<pre class="example">
//保存关闭文件

</pre></li>
<li><p>
步骤2：创建目录
</p>
<pre class="example">
$ sudo mkdir -p /mnt/ntfs

</pre></li>
<li><p>
步骤3：测试（Test）可用性
</p>
<pre class="example">
$ sudo mount -a
$ df -h
$ cd /mnt/ntfs
$ ls -l

</pre></li>
<li><p>
步骤4：卸载NTFS分区
</p>
<pre class="example">
$ sudo umount /mnt/ntfs
// or
$ sudo umount /dev/sda1

</pre></li>
<li><p>
注意错误信息：“Read-only file system”提示
</p>
<pre class="example">
$ mv 05Music/ /mnt/sda/sda2/
/bin/mv: inter-device move failed: '05Music/' to '/mnt/sda/sda2/05Music'; unable to remove target: Read-only file system
//解决（Solving）：配置 /etc/fstab

</pre></li>
</ol></li>
<li><p>
参考资料
</p>
<pre class="example">
https://www.cyberciti.biz/faq/debian-ubuntu-linux-auto-mounting-windows-ntfs-file-system/
http://www.tuicool.com/articles/ZbENfie
https://wiki.archlinux.org/index.php/NTFS-3G
https://wiki.archlinux.org/index.php/Fstab_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)
https://wiki.archlinux.org/index.php/NTFS-3G_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)

</pre></li>
</ul>
</div>
</li>
<li><a id="org9362869"></a>boot 加载选项修改<br />
<div class="outline-text-5" id="text-2-1-2-3">
<pre class="example">
# chmod +w /boot/grub/grub.cfg
# vim /boot/grub/grub.cfg
注释不需要的加载项！

</pre>
</div>
</li>
<li><a id="org996a5c0"></a>改变 Home 目录下的目录中文名称为英文<br />
<div class="outline-text-5" id="text-2-1-2-4">
<ul class="org-ul">
<li><p>
方法1
</p>
<pre class="example">
$ vim ~/.config/user-dirs.dirs

</pre>
<div class="org-src-container">
<pre class="src src-emacs-lisp">XDG_DESKTOP_DIR=<span style="color: #8b2252;">"$HOME/Desktop"</span>
XDG_DOWNLOAD_DIR=<span style="color: #8b2252;">"$HOME/Download"</span>
XDG_TEMPLATES_DIR=<span style="color: #8b2252;">"$HOME/Template"</span>
XDG_PUBLICSHARE_DIR=<span style="color: #8b2252;">"$HOME/Public"</span>
XDG_DOCUMENTS_DIR=<span style="color: #8b2252;">"$HOME/Document"</span>
XDG_MUSIC_DIR=<span style="color: #8b2252;">"$HOME/Music"</span>
XDG_PICTURES_DIR=<span style="color: #8b2252;">"$HOME/Picture"</span>
XDG_VIDEOS_DIR=<span style="color: #8b2252;">"$HOME/Video"</span>
</pre>
</div></li>
<li><p>
方法2
</p>
<pre class="example">
export LANG=en_US
xdg-user-dirs-gtk-update

</pre></li>
</ul>
</div>
</li>
<li><a id="orgc7e5586"></a>电脑没有声音<br />
<div class="outline-text-5" id="text-2-1-2-5">
<ul class="org-ul">
<li><p>
解决
</p>
<pre class="example">
//安装驱动软件
$ sudo apt-get install alsa-utils
$ sudo apt-get install alsa-oos
$ sudo apt-get install esound
$ sudo apt-get install gnome-audio
//检查声卡驱动
$ lspci |grep Audio
//检查内核模块
$ lsmod |grep snd
//检查系统音量
$ alsamixer
//alsamixer是alsa驱动的一个插件,是一个命令行下的图形设置工具.
//alsamixer命令，00表示音量正常，MM表示此声道静音。可以通过M键切换
//初始化声卡
$ sudo alsactl init

</pre></li>
<li>参考资料
<ul class="org-ul">
<li><a href="https://blog.gtwang.org/linux/ubuntu-16-04-headphone-speakers-sound-problem/">解決 Ubuntu Linux 16.04 耳機輸出沒有聲音的問題</a></li>
</ul></li>
</ul>
</div>
</li>
<li><a id="org7f18045"></a>关机和重启<br />
<div class="outline-text-5" id="text-2-1-2-6">
<ul class="org-ul">
<li>shutdown
<ul class="org-ul">
<li><p>
描述
</p>
<pre class="example">
关机、重启计算机(Halt, power-off or reboot the machine)
格式: shutdown [OPTIONS...] [TIME] [WALL...]

</pre></li>
<li>实践
<ul class="org-ul">
<li><p>
重启
</p>
<pre class="example">
$ sudo shutdown -r now

</pre>

<pre class="example">
// 其他重启命令
$ sudo reboot
$ init 6

</pre>

<table id="org5514b23" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">级别</th>
<th scope="col" class="org-left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-left">关机，不允许设置为初始化默认值</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-left">单用户模式</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">不完全多用户，不含NFS服务</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">完全多用户</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-left">未分配</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">图形界面</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-left">重启，不允许设置为初始化默认值</td>
</tr>
</tbody>
</table>
<pre class="example">
$ cat /etc/initable
// 查看系统运行级别
$ sudo runlevel

</pre></li>
</ul></li>
</ul></li>
<li>其他关机/注销命令
<ul class="org-ul">
<li><p>
描述
</p>
<pre class="example">
halt
poweroff
init 0
logout

</pre></li>
<li>实践</li>
</ul></li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org33b81e2" class="outline-3">
<h3 id="org33b81e2"><span class="section-number-3">2.2</span> 配置(Configure)</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-orgb32ce9c" class="outline-4">
<h4 id="orgb32ce9c"><span class="section-number-4">2.2.1</span> 用户身份切换: su &amp; sudo</h4>
<div class="outline-text-4" id="text-2-2-1">
<pre class="example">
Linux 系统当中，作身份变换，可能有以下几个原因：

</pre>
<ul class="org-ul">
<li>使用一般账号：系统平日操作的好习惯</li>
<li>用较低权限启动系统服务</li>
<li>软件本身的限制</li>
</ul>

<pre class="example">
su 是最简单的身份切换命令。
# su [options] [username]

</pre>
<p>
-：单纯使用 - 如『 su - 』代表使用 login-shell 的变量文件读取方式来登陆系统；若使用者名称没有加上去，则代表切换为 root 的身份。
-l：与 - 类似，但后面需要加欲切换的使用者账号！也是 login-shell 的方式。
-m：-m 与 -p 是一样的，表示『使用目前的环境配置，而不读取新使用者的配置文件』
-c：仅进行一次命令，所以 -c 后面可以加上命令喔！
</p>

<pre class="example">
针对 su 的缺点：当我的主机是多人共管的环境时，如果大家都要使用 su 来切换成为 root 的身份，那么不就每个人都得要知道 root 的口令，
这样很不妥当，所以使用 sudo 来处理即可。
并非所有人都能够运行 sudo ， 而是仅有规范到 /etc/sudoers 内的用户才能够运行 sudo 这个命令。

</pre>
</div>
</div>
<div id="outline-container-org872d615" class="outline-4">
<h4 id="org872d615"><span class="section-number-4">2.2.2</span> Wifi连接配置（configure）</h4>
<div class="outline-text-4" id="text-2-2-2">
<pre class="example">
完成安装第一步，当然是先解决网络。

</pre>

<pre class="example">
1.查看无线（wireless）网卡（LAN）驱动（driver）
# lsmod | grep iw

</pre>

<pre class="example">
2.安装（Installing）无线网卡驱动
# apt-get install firmware-iwlwifi wireless-tools

</pre>

<pre class="example">
3.向内核（kernel）中加载/移除模块（modules）
# modprobe iwl4965

</pre>

<pre class="example">
4.重启系统
# reboot

</pre>

<pre class="example">
5.配置无线网络
//查看无线网口（nerwork port）
# iwconfig
//开启无线网口
# ifconfig wlan0 up
//扫描（scaning）无线网络
# iwlist wlan0 scan
//连接无线网络
# iwconfig wlan0 ESSID "wifi-name" KEY "password" open
//执行上面的命令（command）后，发现并不能成功！！！
//于是，通过如下命令继续配置
//格式：wpa_passphrase &lt;ssid&gt; [passphrase]
# wpa_passphrase "wifi-name" "passowrd"&gt;/etc/wpa_supplicant.conf
# wpa_passphrase -B -i wlan0 -Dwext -c /etc/wpa_supplicant.conf
//查看wlan0无线网口
# iwconfig wlan0
//执行命令获取到IP地址，成功连上WiFi
# dhclient wlan0

</pre>

<pre class="example">
6.开机自动连接WiFi配置
# vim /etc/network/interfaces.d/wlan0

</pre>
<div class="org-src-container">
<pre class="src src-emacs-lisp">auto wlan0
allow-hotplug wlan0
iface wlan0 inet dhcp
       wpa-conf /etc/wpa_supplicant.conf 
</pre>
</div>
</div>
</div>
<div id="outline-container-org745c43a" class="outline-4">
<h4 id="org745c43a"><span class="section-number-4">2.2.3</span> 配置安装源(source)</h4>
<div class="outline-text-4" id="text-2-2-3">
<ul class="org-ul">
<li><p>
以配置163源举例说明
</p>
<pre class="example">
1. 访问域名:mirrors.163.com，找到镜像名为debian的目录，点击debian使用帮助。
2. 根据最新的debian版本进行选择jessie，wheezy，squeeze。从最新版本到最低版本选择源
3. 复制安装源文本到 /etc/apt/source.list 中。

</pre>
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org7070160"># mirrors.163.com
deb http://mirrors.163.com/debian/ jessie main non-free contrib
deb http://mirrors.163.com/debian/ jessie-updates main non-free contrib
deb http://mirrors.163.com/debian/ jessie-backports main non-free contrib
deb-src http://mirrors.163.com/debian/ jessie main non-free contrib
deb-src http://mirrors.163.com/debian/ jessie-updates main non-free contrib
deb-src http://mirrors.163.com/debian/ jessie-backports main non-free contrib
deb http://mirrors.163.com/debian-security/ jessie/updates main non-free contrib
deb-src http://mirrors.163.com/debian-security/ jessie/updates main non-free contrib
</pre>
</div></li>
<li>其他安装源
<ul class="org-ul">
<li><a href="https://mirrors.ustc.edu.cn/">中国科学技术大学开源软件镜像站</a></li>
<li><a href="https://mirrors.tuna.tsinghua.edu.cn/">清华大学开源软件镜像站</a></li>
<li><a href="http://mirror.hust.edu.cn/">华中科技大学开源镜像站</a></li>
<li><a href="https://mirrors.aliyun.com">阿里云开源镜像站</a></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org735f21e" class="outline-4">
<h4 id="org735f21e"><span class="section-number-4">2.2.4</span> 配置系统支持中文（support chinese）</h4>
<div class="outline-text-4" id="text-2-2-4">
<ul class="org-ul">
<li><p>
安装及配置
</p>
<pre class="example">
1. 查看并设置环境变量
$ echo $LANG
$ export LANG=en_US.UTF-8

</pre>

<pre class="example">
2. 没有安装 locales,先安装 locales
$ sudo aptitude install locales

</pre>

<pre class="example">
3. 配置中文编码
$ sudo dpkg-reconfigure locales
//选择编码（encode），space选择

</pre>
<ul class="org-ul">
<li>en_US.UTF-8</li>
<li>zh_CN.GB2312</li>
<li>zh_CN.GB18030</li>
<li>zh_CN.GBK</li>
<li><p>
zh_CN.UTF-8
</p>

<pre class="example">
4. 文件配置
$ sudo vim /etc/default/locate

</pre>
<div class="org-src-container">
<pre class="src src-emacs-lisp"># LANG=<span style="color: #8b2252;">"zh_CN.UTF-8"</span>
# LANGUAGE=<span style="color: #8b2252;">"zh_CN:zh"</span>
LANG=<span style="color: #8b2252;">"en_US.UTF-8"</span>
LANGUAGE=<span style="color: #8b2252;">"en_US:en"</span>
</pre>
</div></li>
</ul></li>
<li><p>
安装中文输入法
</p>
<pre class="example">
ibus &amp; UIM &amp; SCIM &amp; Fcitx

</pre>
<ul class="org-ul">
<li><a href="https://wiki.debian.org/gnome-chinese-input">gnome-chinese-input</a></li>
<li><a href="https://wiki.debian.org/I18n/ibus">i18n ibus</a></li>
</ul></li>
<li>Fcitx 输入法补充
<ul class="org-ul">
<li><p>
<a href="https://blog.csdn.net/qq_21397217/article/details/52447263">Ubuntu安装Fcitx以及Fcitx输入中文不显示候选词框的解决办法</a>
</p>
<pre class="example">
1. 安装 fcitx 组件（module）
$ sudo apt-get install fcitx-tools fcitx-config* fcitx-data fcitx-frontend* fcitx-libs fcitx-module* fcitx-ui* presage

</pre>

<pre class="example">
2. 安装 fcitx 输入法
$ sudo apt install fcitx-pinyin
$ sudo apt install fcitx-googlepinyin
$ sudo apt install fcitx-table //五笔

</pre>

<pre class="example">
3. 设置并运行
$ export LANG=zh_CN.utf8
$ export LC_CTYPE=zh_CN.utf8
$ export LC_ALL=zh_CN.utf8
$ export XMODIFIERS=@im=fcitx
$ fcitx &amp;

</pre>

<pre class="example">
4. ui 动态库的支持:
$ sudo apt install fcitx-frontend-gtk2 fcitx-frontend-gtk3 fcitx-ui-classic

</pre>

<pre class="example">
5. 重启可用

</pre></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgbb978f2" class="outline-4">
<h4 id="orgbb978f2"><span class="section-number-4">2.2.5</span> 参考资料</h4>
<div class="outline-text-4" id="text-2-2-5">
<ul class="org-ul">
<li><a href="https://wiki.debian.org/Locale">Locale debian wiki</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org3aae00c" class="outline-3">
<h3 id="org3aae00c"><span class="section-number-3">2.3</span> 介绍(Instroduction)</h3>
<div class="outline-text-3" id="text-2-3">
<pre class="example">
首先，明确一点：GNU Not's Unix.

</pre>
</div>
<div id="outline-container-orgadc0f8f" class="outline-4">
<h4 id="orgadc0f8f"><span class="section-number-4">2.3.1</span> 入门第一步，理解 Linux</h4>
<div class="outline-text-4" id="text-2-3-1">
<ol class="org-ol">
<li>首先，以 Linux 的思维方式系统性思考问题。</li>
<li>Linux 是一个面向文件的操作系统。所有的应用、管理是基于文件的。</li>
<li>Linux 是一个以命令行为主要的管理方式的 OS。</li>
<li>Linux 的日志非常完善，也至关重要。</li>
<li>Linux 是一个以配置文件为管理基础的 OS。</li>
<li>Linux 的所有应用、管理和配置，都有很多程序来辅助完成。</li>
</ol>
</div>
</div>
<div id="outline-container-org4a309b7" class="outline-4">
<h4 id="org4a309b7"><span class="section-number-4">2.3.2</span> Linux 内容划分</h4>
<div class="outline-text-4" id="text-2-3-2">
<pre class="example">
Linux 可划分为以下四部分

</pre>
<ol class="org-ol">
<li>Linux 内核</li>
<li>GNU 工具</li>
<li>图形化桌面环境</li>
<li>应用软件</li>
</ol>
</div>
<ol class="org-ol">
<li><a id="org38f9e9f"></a>深入探究 Linux 内核<br />
<div class="outline-text-5" id="text-2-3-2-1">
<pre class="example">
Linus Torvalds：Linux 内核开发者。
Linux 内核主要负责一下四种功能：

</pre>
<ol class="org-ol">
<li>系统内存管理
<ul class="org-ul">
<li>内核不仅管理服务器上的可用物理内存，还可以创建和管理虚拟内存。</li>
<li>内核通过硬盘上的存储空间来实现虚拟内存，这块区域称为交换空间（swap space）。内核不断地交换空间和实际的物理内存之间反复交换虚拟内存中的内容。这使得系统以为它拥有比物理内存更多的可用内存。</li>
<li>内存存储单元按组划分成很多块，这些块称作页面（page）。内核将每个内存页面放在物理内存或交换空间。然后，内核会维护一个内存页面表，指明哪些页面位于物理内存内，哪些页面被换到了磁盘上。</li>
<li>内核会记录哪些内存页面正在使用中，并自动把一段时间未访问的内存页面复制到交换空间区域（称为换出，swapping out）——即使还有可用内存。</li>
</ul></li>
<li>软件程序管理
<ul class="org-ul">
<li>Linux 操作系统将运行中的程序称为进程。内核控制着 Linux 系统如何管理运行在系统上的所有进程。</li>
<li>内核创建了第一个进程（称为 init 进程）来启动系统上所有其他进程。Linux 操作系统的 init 系统采用了运行级。Linux 操作系统有 5个启动运行级。
<ul class="org-ul">
<li>运行级为 1 时，只启动基本的系统进程以及一个控制台终端进程，我们称之为单用户模式。单用户模式通常用来在系统有问题时进行紧急的文件系统维护。显然，这种模式下，仅有一个人（通常是系统管理员）能登录到系统上操作数据。</li>
<li>运行级为 3 时，大多数应用软件，比如网络支持程序，都会启动。</li>
<li>运行级为 5 时，系统会启动 X Window 系统，允许用户通过图形化桌面窗口登录系统。</li>
<li>Linux 系统可以通过调整启动运行级来控制整个系统的功能。</li>
</ul></li>
</ul></li>
<li>硬件设备管理
<ul class="org-ul">
<li><p>
内核的另一职责是管理硬件设备。任何 Linux 系统需要与之通信的设备，都需要在内核代码中加入驱动程序代码。在 Linux 内核中有两种方法用于插入设备驱动程序代码：
</p>
<ul class="org-ul">
<li>编译进内核的设备驱动代码</li>
<li>可插入内核的设备驱动模块</li>
</ul>
<pre class="example">
以前，插入设备驱动代码的唯一途径是重新编译内核。随着 Linux 内核支持的硬件设备越来越多，这个过程变得越来越低效。
后来，开发人员提出了内核模块的概念。它允许将驱动代码插入到运行中的内核而无需重新编译内核。Linux 系统将硬件设备当成特殊的文件，称为设备文件。

</pre>
<ul class="org-ul">
<li>设备文件有3种分类
<ul class="org-ul">
<li>字符型设备文件：指处理数据时每次只能处理一个字符的设备。大多数类型的调制解调器和终端都是作为字符型设备文件创建的。</li>
<li>块设备文件：指处理数据时每次能处理大块大数据的设备，比如硬盘。</li>
<li>网络设备文件：指采用数据包发送和接受数据的设备，包括各种网卡和一个特殊的回环设备。这个回环设备允许 Linux 系统使用常见的网络编程协议同自身通讯。</li>
</ul></li>
</ul></li>
<li>Linux 为系统上的每个设备都创建一种称为节点的特殊文件。与设备的所有通信都通过设备节点完成。每个节点都有唯一的数值对供 Linux 内核标识它。数值对包括一个主设备号和一个次设备号。类似的设备被划分到同样的主设备号下。次设备号用于标识主设备组下的某个特定设备。</li>
</ul></li>
<li><p>
文件系统管理
</p>
<pre class="example">
Linux 内核支持通过不同类型的文件系统从硬盘中读写数据。内核必须在编译时就加入对所有可能用到的文件系统的支持。下表是 Linux 系统用来读写数据的标准文件系统

</pre>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> </caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">文件系统</th>
<th scope="col" class="org-left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">ext</td>
<td class="org-left">Linux 扩展文件系统，最早的 Linux 文件系统</td>
</tr>

<tr>
<td class="org-left">ext2</td>
<td class="org-left">第二扩展文件系统，在ext的基础上提供更多的功能</td>
</tr>

<tr>
<td class="org-left">ext3</td>
<td class="org-left">第三扩展文件系统，支持日志功能</td>
</tr>

<tr>
<td class="org-left">ext4</td>
<td class="org-left">第四扩展文件系统，支持高级日志功能</td>
</tr>

<tr>
<td class="org-left">hpfs</td>
<td class="org-left">OS/2高性能文件系统</td>
</tr>

<tr>
<td class="org-left">jfs</td>
<td class="org-left">IBM日志文件系统</td>
</tr>

<tr>
<td class="org-left">iso9660</td>
<td class="org-left">ISO 9660文件系统（CD-ROM）</td>
</tr>

<tr>
<td class="org-left">mimix</td>
<td class="org-left">MINIX文件系统</td>
</tr>

<tr>
<td class="org-left">msdos</td>
<td class="org-left">微软的FAT16</td>
</tr>

<tr>
<td class="org-left">ncp</td>
<td class="org-left">Netware文件系统</td>
</tr>

<tr>
<td class="org-left">nfs</td>
<td class="org-left">网络文件系统</td>
</tr>

<tr>
<td class="org-left">ntfs</td>
<td class="org-left">支持Microsoft NT文件系统</td>
</tr>

<tr>
<td class="org-left">proc</td>
<td class="org-left">访问系统信息</td>
</tr>

<tr>
<td class="org-left">ReiserFS</td>
<td class="org-left">高级Linux文件系统，能提供更好的性能和硬盘恢复功能</td>
</tr>

<tr>
<td class="org-left">smb</td>
<td class="org-left">支持网络访问的Samba SMB文件系统</td>
</tr>

<tr>
<td class="org-left">sysv</td>
<td class="org-left">较早期的Unix文件系统</td>
</tr>

<tr>
<td class="org-left">ufs</td>
<td class="org-left">BSD文件系统</td>
</tr>

<tr>
<td class="org-left">umsdos</td>
<td class="org-left">建立在msdos上的类Unix文件系统</td>
</tr>

<tr>
<td class="org-left">vfat</td>
<td class="org-left">Windows95文件系统（FAT32）</td>
</tr>

<tr>
<td class="org-left">XFS</td>
<td class="org-left">高性能64位日志文件系统</td>
</tr>
</tbody>
</table>
<pre class="example">
Linux 内核采用虚拟文件系统（Virtual File System,VFS）作为和每个文件系统交互的接口。     

</pre></li>
</ol>
</div>
</li>
<li><a id="orga2ce0fb"></a>GNU工具<br />
<div class="outline-text-5" id="text-2-3-2-2">
<pre class="example">
1.核心 GNU 工具：coreutils(coreutilities)软件包
GNU coreutils 软件包由三部分构成：
1)用以处理文件的工具
2)用以操作文本的工具
3)用以管理进程的工具

</pre>

<pre class="example">
2.shell
Linux 中常见的shell

</pre>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">shell</th>
<th scope="col" class="org-left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">bash</td>
<td class="org-left">bash shell 是 Bourne shell 的一个免费版本，它是最早的 Unix shell，bash还有一个特点，可以通过help命令来查看帮助。包含的功能几乎可以涵盖shell所具有的功能，所以一般的shell脚本都会指定它为执行路径。</td>
</tr>

<tr>
<td class="org-left">ash</td>
<td class="org-left">一种运行在内存受限环境中简单的轻量级shell，但与bash shell完全兼容。</td>
</tr>

<tr>
<td class="org-left">korn</td>
<td class="org-left">一种与 Bourne shell，但支持如关联数组和浮点运算等一些高级的编程特性。</td>
</tr>

<tr>
<td class="org-left">tcsh</td>
<td class="org-left">一种将C语言中的一些元素引入到shell脚本中的shell。</td>
</tr>

<tr>
<td class="org-left">zsh</td>
<td class="org-left">一种结合了bash、tcsh和korn的特性，同时提供高级编程特性、共享历史文件和主题化提示符的高级shell。</td>
</tr>
</tbody>
</table>
</div>
</li>
<li><a id="org8e6e4e0"></a>Linux 桌面环境<br />
<div class="outline-text-5" id="text-2-3-2-3">
<p>
1.X Window
2.KDE 桌面（K Desktop Environment，K 桌面系统）
3.GNOME 桌面（the GNU Network Object Model Environment，GNU 网络对象模型桌面）
4.Unity 桌面
5.其他桌面
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 2:</span> 其他桌面</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">桌面</th>
<th scope="col" class="org-left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Fluxbox</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Xfce</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">JWM</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">Fvwm</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">fvwm95</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</li>
<li><a id="org2164d85"></a>Linux 发行版<br />
<div class="outline-text-5" id="text-2-3-2-4">
<pre class="example">
不同的 Linux 发行版通常归类为3种：

</pre>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 3:</span> 1.完整的核心 Linux 发行版</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Slackware</td>
<td class="org-left">最早的 Linux 发行版之一</td>
</tr>

<tr>
<td class="org-left">Red Hat</td>
<td class="org-left">商业发行版</td>
</tr>

<tr>
<td class="org-left">Fedora</td>
<td class="org-left">Red Hat 分离出的家用发行版</td>
</tr>

<tr>
<td class="org-left">Gentoo</td>
<td class="org-left">为高级 Linux 用户设计的发行版，仅包含 Linux 源代码</td>
</tr>

<tr>
<td class="org-left">openSuse</td>
<td class="org-left">商用和家用的发行版</td>
</tr>

<tr>
<td class="org-left">Debian</td>
<td class="org-left">Linux 专家和商用 Linux 产品中流行的发行版</td>
</tr>
</tbody>
</table>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 4:</span> 2.特定用途的发行版</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">CentOS</td>
<td class="org-left">一款基于 Red Hat 企业版 Linux 源代码构建的免费发行版</td>
</tr>

<tr>
<td class="org-left">Ubuntu</td>
<td class="org-left">一款用于学校和家庭的免费发行版</td>
</tr>

<tr>
<td class="org-left">PCLinuxOS</td>
<td class="org-left">一款用于学校和办公的免费发行版</td>
</tr>

<tr>
<td class="org-left">Mint</td>
<td class="org-left">一款用于家庭娱乐的免费发行版</td>
</tr>

<tr>
<td class="org-left">dyne:bolic</td>
<td class="org-left">一款用于音频和MIDI应用的免费发型版</td>
</tr>

<tr>
<td class="org-left">Puppy Linux</td>
<td class="org-left">一款适用于老旧PC的小型免费发行版</td>
</tr>
</tbody>
</table>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 5:</span> 3.LiveCD 测试发行版。</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Knoppix</td>
<td class="org-left">最早的 LiveCD Linux</td>
</tr>

<tr>
<td class="org-left">PCLinuxOS</td>
<td class="org-left">一款成熟的 LiveCD</td>
</tr>

<tr>
<td class="org-left">Ubuntu</td>
<td class="org-left">为多种语言设计的世界级 Linux 项目</td>
</tr>

<tr>
<td class="org-left">Slax</td>
<td class="org-left">基于 Slackware Linux</td>
</tr>

<tr>
<td class="org-left">Pubby Linux</td>
<td class="org-left">为老旧 PC 设计的一款全功能 Linux</td>
</tr>
</tbody>
</table>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgec62836" class="outline-4">
<h4 id="orgec62836"><span class="section-number-4">2.3.3</span> Linux 基本网络配置</h4>
<div class="outline-text-4" id="text-2-3-3">
</div>
<ol class="org-ol">
<li><a id="org21c8b09"></a>安装网络工具<br />
<div class="outline-text-5" id="text-2-3-3-1">
<pre class="example">
//Debian/Linux
$ sudo apt-get install net-tools

</pre>
</div>
</li>
<li><a id="org1c98581"></a>配置网络<br />
<div class="outline-text-5" id="text-2-3-3-2">
<pre class="example">
1.在 Linux 中，以太网接口被命名为：eth0、eth1等。
2.lspci 命令可以查看网卡硬件信息（如果是 usb 网卡，则需要使用 lsusb 命令）
3.ifconfig 命令：查看接口信息
 $ ifconfig -a
 $ ifconfig eth0
4.ifup,ifdown 命令：启用、禁用一个接口
 $ ifup eth0
 $ ifdown eth0

</pre>
</div>
</li>
<li><a id="org62f4faa"></a>相关配置文件<br />
<div class="outline-text-5" id="text-2-3-3-3">
<pre class="example">
1.网卡配置文件：/etc/sysconfig/network-scripts/ifcfg-eth0
2.DNS 配置文件：/etc/resolv.conf
3.主机名配置文件：/etc/sysconfig/network
4.静态主机名配置文件：/etc/hosts

</pre>
</div>
</li>
<li><a id="org95cfeff"></a>网络测试<br />
<div class="outline-text-5" id="text-2-3-3-4">
<pre class="example">
1.测试网路连通性：ping 命令
2.测试DNS解析：host,dig 命令
3.显示路由表：ip route 命令
4.追踪到达目标地址的网络路径：traceroute 命令
5.mtr 命令进行网络质量测试

</pre>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgbd407e6" class="outline-4">
<h4 id="orgbd407e6"><span class="section-number-4">2.3.4</span> Linux 日期时间设置</h4>
<div class="outline-text-4" id="text-2-3-4">
<pre class="example">
Linux 时钟分为系统时钟（System Clock）和硬件时钟（Real Time Clock，简称 RTC）。系统时钟指当前 Linux Kernel 中
的时钟;硬件时钟指主板上由电池供电的时钟，可在 BIOS 中进行设置。
1.date 命令
2.hwclock 命令，查看硬件时间
//设置硬件时间
$ sudo hwclock -set -date='07/17/2017 20:00'
3.硬件时间与系统时钟同步
$ sudo hwclock --hctosys(hc 代表硬件时间，sys 代表系统时间)
$ sudo hwclock -systohc

</pre>
</div>
</div>
<div id="outline-container-org79c6720" class="outline-4">
<h4 id="org79c6720"><span class="section-number-4">2.3.5</span> 获取帮助 &amp; 问题解决</h4>
<div class="outline-text-4" id="text-2-3-5">
<ol class="org-ol">
<li>出现问题，先保护现场。（问题一种是已正确运行的系统出问题，另一种是新的操作或配置造成了问题）</li>
<li>当怀疑有黑客入侵或病毒的情况，马上做日志备份。</li>
<li>检查相关日志。</li>
<li>对于新的操作或配置造成的问题，最好是养成定期备份重要文件的习惯。</li>
<li>使用网络</li>
<li>使用搜索命令：find，locate，whereis。。。</li>
</ol>
</div>
<ol class="org-ol">
<li><a id="org8ddab73"></a>man<br />
<div class="outline-text-5" id="text-2-3-5-1">
<pre class="example">
查看在线帮助手册(an interface to the on-line reference manuals)
如果不记得命令名怎么办？可以使用关键字搜索手册页。
$ man -k terminal

</pre>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 6:</span> Linux 手册页惯用的节名</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">节</th>
<th scope="col" class="org-left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">Name</td>
<td class="org-left">显示命令和一段简短的描述</td>
</tr>

<tr>
<td class="org-left">Synopsis</td>
<td class="org-left">命令的语法</td>
</tr>

<tr>
<td class="org-left">Configuration</td>
<td class="org-left">命令配置信息</td>
</tr>

<tr>
<td class="org-left">Description</td>
<td class="org-left">命令的一般性描述</td>
</tr>

<tr>
<td class="org-left">Options</td>
<td class="org-left">命令选项描述</td>
</tr>

<tr>
<td class="org-left">Exit Status</td>
<td class="org-left">命令的推出状态指示</td>
</tr>

<tr>
<td class="org-left">Return Value</td>
<td class="org-left">命令的返回值</td>
</tr>

<tr>
<td class="org-left">Errors</td>
<td class="org-left">命令的错误信息</td>
</tr>

<tr>
<td class="org-left">Environment</td>
<td class="org-left">描述所使用的环境变量</td>
</tr>

<tr>
<td class="org-left">Files</td>
<td class="org-left">命令用到的文件</td>
</tr>

<tr>
<td class="org-left">Versions</td>
<td class="org-left">命令的版本信息</td>
</tr>

<tr>
<td class="org-left">Conforming To</td>
<td class="org-left">命令所遵从的标准</td>
</tr>

<tr>
<td class="org-left">Notes</td>
<td class="org-left">其他有帮助的资料</td>
</tr>

<tr>
<td class="org-left">Bugs</td>
<td class="org-left">提供提交Bug的途径</td>
</tr>

<tr>
<td class="org-left">Example</td>
<td class="org-left">展示命令的用法</td>
</tr>

<tr>
<td class="org-left">Authors</td>
<td class="org-left">命令开发人员的信息</td>
</tr>

<tr>
<td class="org-left">Copyright</td>
<td class="org-left">命令源代码的版权状况</td>
</tr>

<tr>
<td class="org-left">See Also</td>
<td class="org-left">与该命令类似的其他命令</td>
</tr>
</tbody>
</table>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 7:</span> Linux 手册页的内容区域</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">区域号</th>
<th scope="col" class="org-left">所涵盖的内容</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-left">可执行程序或shell命令</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">系统调用</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">库调用</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-left">特殊文件</td>
</tr>

<tr>
<td class="org-right">5</td>
<td class="org-left">文件格式与约定</td>
</tr>

<tr>
<td class="org-right">6</td>
<td class="org-left">游戏</td>
</tr>

<tr>
<td class="org-right">7</td>
<td class="org-left">概览、约定及杂项</td>
</tr>

<tr>
<td class="org-right">8</td>
<td class="org-left">超级用户和系统管理员命令</td>
</tr>

<tr>
<td class="org-right">9</td>
<td class="org-left">内核例程</td>
</tr>
</tbody>
</table>
</div>
</li>
<li><a id="orge6cb978"></a>help<br />
<div class="outline-text-5" id="text-2-3-5-2">
<pre class="example">
查看命令帮助信息(Display information about builtin commands.)

</pre>
</div>
</li>
<li><a id="orgfa74f7e"></a>type<br />
<div class="outline-text-5" id="text-2-3-5-3">
<pre class="example">
查看命令类型(Display information about command type)

</pre>
</div>
</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org33848e0" class="outline-2">
<h2 id="org33848e0"><span class="section-number-2">3</span> Linux 文件、目录与磁盘格式</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orge344a78" class="outline-3">
<h3 id="orge344a78"><span class="section-number-3">3.1</span> Linux 文件权限</h3>
<div class="outline-text-3" id="text-3-1">
</div>
<div id="outline-container-org8b8c2f3" class="outline-4">
<h4 id="org8b8c2f3"><span class="section-number-4">3.1.1</span> 理解文件权限</h4>
<div class="outline-text-4" id="text-3-1-1">
<ol class="org-ol">
<li><p>
使用文件权限符
</p>
<pre class="example">
$ ls -lh

</pre>
<p>
drwxr-xr-x 3 zrg zrg 4.0K Apr 21 16:24 练手项目
-rw-r&#x2013;r&#x2013; 1 zrg zrg 2.5M Apr 21 11:51 练手项目.rar
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 8:</span> 解释</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">d</th>
<th scope="col" class="org-left">rwxr-xr-x</th>
<th scope="col" class="org-left">3</th>
<th scope="col" class="org-left">zrg</th>
<th scope="col" class="org-left">zrg</th>
<th scope="col" class="org-left">4.0K</th>
<th scope="col" class="org-left">Apr 21 16:24</th>
<th scope="col" class="org-left">练手项目</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">文件类型。</td>
<td class="org-left">文件权限。</td>
<td class="org-left">对于普通文件：链接数</td>
<td class="org-left">用户名</td>
<td class="org-left">组名</td>
<td class="org-left">文件大小，单位：字节</td>
<td class="org-left">最后修改日期时间</td>
<td class="org-left">文件名</td>
</tr>

<tr>
<td class="org-left">d 目录文件</td>
<td class="org-left">从左往右分别代表所有者权限、组用户权限和其他用户权限</td>
<td class="org-left">对于目录文件：第一级子目录数</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">- 普通文件</td>
<td class="org-left">r 可读</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">l 链接文件</td>
<td class="org-left">w 可写</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">c 字符型设备文件</td>
<td class="org-left">x 可执行</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">b 块设备文件</td>
<td class="org-left">- 无执行权限</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">n 网络设备文件</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">s 套接字文件</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table></li>
<li><p>
默认文件权限
</p>
<pre class="example">
umask 命令用来设置所创建文件和目录的默认权限。

</pre></li>
</ol>
</div>
</div>
<div id="outline-container-orge906155" class="outline-4">
<h4 id="orge906155"><span class="section-number-4">3.1.2</span> 共享文件</h4>
<div class="outline-text-4" id="text-3-1-2">
<pre class="example">
Linux 为每个文件和目录存储了3个额外的信息位。

</pre>
<ul class="org-ul">
<li>设置用户ID（SUID）</li>
<li>设置组ID（GID）</li>
<li>粘着位：进程结束后文件还驻留（粘着）在内存中。</li>
</ul>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 9:</span> chmod SUID、SGID和粘着位的八进制值</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">二进制值</th>
<th scope="col" class="org-right">八进制值</th>
<th scope="col" class="org-left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">000</td>
<td class="org-right">0</td>
<td class="org-left">所有位都清零</td>
</tr>

<tr>
<td class="org-right">001</td>
<td class="org-right">1</td>
<td class="org-left">粘着位置位</td>
</tr>

<tr>
<td class="org-right">010</td>
<td class="org-right">2</td>
<td class="org-left">SGID位置位</td>
</tr>

<tr>
<td class="org-right">011</td>
<td class="org-right">3</td>
<td class="org-left">SGID位和粘着位都置位</td>
</tr>

<tr>
<td class="org-right">100</td>
<td class="org-right">4</td>
<td class="org-left">SUID位置位</td>
</tr>

<tr>
<td class="org-right">101</td>
<td class="org-right">5</td>
<td class="org-left">SUID位和粘着位都置位</td>
</tr>

<tr>
<td class="org-right">110</td>
<td class="org-right">6</td>
<td class="org-left">SUID位和SGID都置位</td>
</tr>

<tr>
<td class="org-right">111</td>
<td class="org-right">7</td>
<td class="org-left">所有位都置位</td>
</tr>
</tbody>
</table>
<pre class="example">
//创建一个共享目录
$ mkdir testdir
$ chgrp shared testdir
$ chmod g+s testdir
$ umask 002
$ cd testdir
$ touch testfile

</pre>
</div>
</div>
</div>
<div id="outline-container-org5ddde26" class="outline-3">
<h3 id="org5ddde26"><span class="section-number-3">3.2</span> Linux 目录结构</h3>
<div class="outline-text-3" id="text-3-2">

<div class="figure">
<p><img src="{{site.url}}/assets/images/cs2.png" alt="cs2.png" />
</p>
</div>
</div>
</div>
<div id="outline-container-org9242f60" class="outline-3">
<h3 id="org9242f60"><span class="section-number-3">3.3</span> Linux 文件搜索</h3>
<div class="outline-text-3" id="text-3-3">
</div>
<div id="outline-container-org25cddda" class="outline-4">
<h4 id="org25cddda"><span class="section-number-4">3.3.1</span> find 命令</h4>
<div class="outline-text-4" id="text-3-3-1">
<ul class="org-ul">
<li><p>
根据文件名查找
</p>
<pre class="example">
格式：find [搜索范围][匹配条件]

</pre>

<pre class="example">
// 默认在当前目录下搜索
$ find -name "MyCProgram.c"

</pre>

<pre class="example">
// 忽略大小写
$ find -iname "MyCProgram.c"

</pre>

<pre class="example">
// 查找以my开头，后面包含三个字符的文件
$ find -name my??? 

</pre>

<pre class="example">
// 深度查找：
// 在 root 目录及其子目录下查找 passwd 文件。
$ sudo find / -maxdepth 2 -name passwd
// 在第二层子目录和第四层子目录之间查找 passwd 文件。
$ sudo find / -mindepth 3 -maxdepth 5 -name passwd
// 找到 home 目录及子目录下所有的空文件(0字节文件) 
// 下面命令的输出文件绝大多数都是锁定文件盒其他程序创建的 place hoders
$ find ~/ -empty
//列出你 home 目录里的空文件。
$ find ~/ -maxdepth 1 -empty
//列出 home目录下的非隐藏空文件。
$ find ~/ -maxdepth 1 -empty -not -name ".*"

</pre>

<pre class="example">
// 相反匹配
// 显示所有的名字不是 MyCProgram.c 的文件或者目录。
$ find -maxdepth 1 -not -iname "MyCProgram.c"

</pre>

<pre class="example">
// 在查找到的文件上执行命令
// 在查找到名为“MyCProgram.c”的文件上计算 MD5 验证和。
$ find -iname "MyCProgram.c" -exec md5sum {} \;
// 在 /etc 目录下查找 inittab 文件并显示其详细属性
$ sudo find /etc -name initab -exec ls -l {} \;
注意：{} 将会被当前文件名取代。
-exec/-ok &lt;command&gt; {} \; 对搜索结果执行操作，使用 -ok 会询问是否确认。

</pre></li>
<li><p>
文件大小查找
</p>
<pre class="example">
// 格式：+n 大于；-n 小于；n 等于
// 在 root 目录下查找大于100MB的文件
$ sudo find / -size +204800
注意：在 Linux 里面，1 数据块 = 512 byte = 0.5 KB，100 MB = 102400 KB = 204800 数据块

</pre>

<pre class="example">
// 在 /etc 目录下查找大于 80MB 小于 100MB 的文件
$ sudo find /etc -size +163840 -a size -204800
-a 表示两个条件同时满足
-o 表示两个条件满足一个即可

</pre>

<pre class="example">
//列出当前目录及子目录下的 5个最大的文件。这会需要一点时间，取决于命令需要处理的文件数量。
$ find . -type f -exec ls -s {} \; | sort -n -r | head -5
//查找 5个最小的文件
$ find . -type f -exec ls -s {} \; | sort -n  | head -5
//上面的命令中，很可能你看到的只是空文件(0字节文件)。因此，你可以使用下面的命令列出最小的文件，而不是 0字节文件。
$ find . -not -empty -type f -exec ls -s {} \; | sort -n  | head -5

</pre>

<pre class="example">
//查找并删除大于 100M 的 *.zip 文件。
$ find / -type f -name *.zip -size +100M -exec rm -i {} \;
注意：{} 和 \ 之间是有空格的！

</pre></li>
<li><p>
根据文件变动情况查找
</p>
<pre class="example">
// 在/etc目录下查找5分钟内被修改过属性的文件和目录
$ sudo /etc -cmin -5

</pre>

<pre class="example">
-amin 访问时间 access
-cmin 文件属性 change
-mmin 文件内容 modify

</pre>

<pre class="example">
// 显示所有的在 ordinary_file 之后创建修改的文件。
$ ls -lrt
$ find -newer ordinary_file

</pre></li>
<li><p>
根据文件类型查找
</p>
<pre class="example">
f 文件，d 目录，l 软链接，s socket文件
//查找所有的一般文件
$ find ./ -type f
//查找所有的隐藏文件和目录
$ find ./ -type f -name ".*"
$ find ./ -type d -name ".*"

</pre></li>
<li><p>
根据文件权限、所属关系查找
</p>
<pre class="example">
$ find /home -user zrg
$ find /home -group zrg

</pre>

<pre class="example">
// 查到当前目录下对同组用户具有读权限的文件
$ find ./ -perm -g=r -type f -exec ls -l {} \;
// 找到对组用户具有只读权限的文件。
$find ./ -perm g=r -type f -exec ls -l {} \;  
// 找到对组用户具有只读权限的文件(使用八进制权限形式)。
$ find ./ -perm 040 -type f -exec ls -l {} \;

</pre></li>
<li><p>
使用 inode 编号查找
</p>
<pre class="example">
//任何一个文件都有一个独一无二的 inode 编号，借此我们可以区分文件。
//使用选项 -i，可以看到文件的 inode 编号，借此可以区分这两个文件。
$ ls -i1 test*
16187429 test-file-name
16187430 test-file-name
//使用 inode 编号来删除那些具有特殊符号的文件名。
$ find -inum 16187430 -exec rm {} \;

</pre></li>
</ul>
</div>
</div>
<div id="outline-container-org585cc8d" class="outline-4">
<h4 id="org585cc8d"><span class="section-number-4">3.3.2</span> locate 命令</h4>
<div class="outline-text-4" id="text-3-3-2">
<pre class="example">
该命令建立了一个文件资料库，查找文件时直接在资料库中查找。类似 Windows 下的 Everything 工具。

</pre>

<pre class="example">
// 安装：
$ sudo apt install mlocate

</pre>

<pre class="example">
// 使用
$ locate init
注意：locate 命令不会查找/tmp目录下内容。

</pre>

<pre class="example">
// 更新文件资料库：
$ updatedb

</pre>
</div>
</div>
<div id="outline-container-org02264e3" class="outline-4">
<h4 id="org02264e3"><span class="section-number-4">3.3.3</span> which 和 where 命令</h4>
<div class="outline-text-4" id="text-3-3-3">
<ul class="org-ul">
<li><p>
描述
</p>
<pre class="example">
用于查找某个命令(Locate a command)

</pre></li>
<li><p>
实践
</p>
<pre class="example">
$ which ls
$ where useradd

</pre></li>
</ul>
</div>
</div>
<div id="outline-container-org64aef00" class="outline-4">
<h4 id="org64aef00"><span class="section-number-4">3.3.4</span> grep 命令</h4>
<div class="outline-text-4" id="text-3-3-4">
<pre class="example">
语法格式：grep -iv [指定字符串][文件]
-i 不区分大小写
-v 排除指定字符串

</pre>

<pre class="example">
// 查找指定字符串的行并显示
$ grep 123 test.txt

</pre>

<pre class="example">
// 去掉# 注释行
$ grep -v ^# config.txt

</pre>
</div>
</div>
</div>
<div id="outline-container-org9bb3c61" class="outline-3">
<h3 id="org9bb3c61"><span class="section-number-3">3.4</span> Linux 文件压缩与打包</h3>
<div class="outline-text-3" id="text-3-4">

<div class="figure">
<p><img src="{{site.url}}/assets/images/tar.png" alt="tar.png" />
</p>
</div>

<pre class="example">
另外还有不常见的，但时有遇到的：
.tar.xz
$ tar xpvf file.tar.xz

.tgz
$ tar zxf  name.tgz

//解压到指定目录
$ tar zxvf name.tar.gz -C ./dir
$ unzip name.zip -d ./dir

</pre>
</div>
</div>

<div id="outline-container-orgc84e661" class="outline-3">
<h3 id="orgc84e661"><span class="section-number-3">3.5</span> Linux 磁盘与文件系统</h3>
<div class="outline-text-3" id="text-3-5">
</div>
<div id="outline-container-orgbf21c16" class="outline-4">
<h4 id="orgbf21c16"><span class="section-number-4">3.5.1</span> 格式化分区命令</h4>
<div class="outline-text-4" id="text-3-5-1">
<pre class="example">
将 /dev/sda7 硬盘格式化为 ext3 格式。
mkfs -t ext3 -c /dev/sda7

</pre>
</div>
</div>
</div>
<div id="outline-container-org3ec84d6" class="outline-3">
<h3 id="org3ec84d6"><span class="section-number-3">3.6</span> ～～～</h3>
<div class="outline-text-3" id="text-3-6">
</div>
<div id="outline-container-org85d38ab" class="outline-4">
<h4 id="org85d38ab"><span class="section-number-4">3.6.1</span> 网络命令</h4>
<div class="outline-text-4" id="text-3-6-1">
</div>
<ol class="org-ol">
<li><a id="org01821c4"></a>write<br />
<div class="outline-text-5" id="text-3-6-1-1">
<ul class="org-ul">
<li><p>
描述
</p>
<pre class="example">
给指定用户发送信息(send a message to another user)，Ctrl+D 保存结束
格式: write user [tty]

</pre></li>
<li>实践</li>
</ul>
</div>
</li>
<li><a id="org2470753"></a>wall<br />
<div class="outline-text-5" id="text-3-6-1-2">
<ul class="org-ul">
<li><p>
描述
</p>
<pre class="example">
发送广播信息(write a message to all users)
格式: wall [-n] [-t timeout] [message | file]

</pre></li>
<li>实践</li>
</ul>
</div>
</li>
<li><a id="orgc209e8c"></a>ping<br />
<div class="outline-text-5" id="text-3-6-1-3">
<ul class="org-ul">
<li><p>
描述
</p>
<pre class="example">
测试网络联通性(send ICMP ECHO_REQUEST to network hosts)

</pre></li>
<li>实践
<ul class="org-ul">
<li><p>
指定ping次数
</p>
<pre class="example">
$ ping -c 4 baidu.com

</pre></li>
</ul></li>
</ul>
</div>
</li>
<li><a id="org402dd7a"></a>ifconfig<br />
<div class="outline-text-5" id="text-3-6-1-4">
<ul class="org-ul">
<li><p>
描述
</p>
<pre class="example">
configure a network interface

</pre></li>
<li>实践</li>
</ul>
</div>
</li>
<li><a id="org5a2a874"></a>mail<br />
<div class="outline-text-5" id="text-3-6-1-5">
<ul class="org-ul">
<li><p>
描述
</p>
<pre class="example">
查看/发送电子邮件

</pre></li>
<li>实践</li>
</ul>
</div>
</li>
<li><a id="org12805df"></a>last &amp; lastlog<br />
<div class="outline-text-5" id="text-3-6-1-6">
<ul class="org-ul">
<li><p>
描述
</p>
<pre class="example">
列出目前/过去登入系统的用户信息
last, lastb - show a listing of last logged in users
last [options] [username...] [tty...]
lastb [options] [username...] [tty...]

</pre>

<pre class="example">
列出用户最后一次登录系统的信息
lastlog - reports the most recent login of all users or of a given user
lastlog [options]

</pre></li>
<li>实践</li>
</ul>
</div>
</li>
<li><a id="orgca3e1e2"></a>traceroute<br />
<div class="outline-text-5" id="text-3-6-1-7">
<ul class="org-ul">
<li><p>
描述
</p>
<pre class="example">
追踪数据包到主机间的路径
traceroute - print the route packets trace to network host

</pre></li>
<li>实践</li>
</ul>
</div>
</li>
<li><a id="orgfdd75af"></a>netstat<br />
<div class="outline-text-5" id="text-3-6-1-8">
<ul class="org-ul">
<li><p>
描述
</p>
<pre class="example">
显示网络相关信息
netstat - Print network connections, routing tables, interface statistics, masquerade connections, and multicast memberships

</pre></li>
<li>实践
<ul class="org-ul">
<li><p>
查看主机对外开放端口
</p>
<pre class="example">
$ netstat -ntlp

</pre></li>
<li><p>
查看本机监听的端口
</p>
<pre class="example">
$ netstat -tlun

</pre></li>
<li><p>
查看本机所有的网络连接
</p>
<pre class="example">
$ netstat -ano

</pre></li>
<li><p>
查看本机路由表
</p>
<pre class="example">
$ netstat -rn

</pre></li>
</ul></li>
</ul>
</div>
</li>
<li><a id="org4afb789"></a>setup<br />
<div class="outline-text-5" id="text-3-6-1-9">
<ul class="org-ul">
<li><p>
描述
</p>
<pre class="example">
配置网络

</pre></li>
<li>实践</li>
</ul>
</div>
</li>
</ol>
</div>
<div id="outline-container-org4c42da3" class="outline-4">
<h4 id="org4c42da3"><span class="section-number-4">3.6.2</span> 进程管理命令</h4>
<div class="outline-text-4" id="text-3-6-2">
</div>
<ol class="org-ol">
<li><a id="org847d268"></a>top<br />
<div class="outline-text-5" id="text-3-6-2-1">
<ul class="org-ul">
<li>描述</li>
</ul>
</div>
</li>
<li><a id="orgc13f382"></a>ps<br />
<div class="outline-text-5" id="text-3-6-2-2">
<ul class="org-ul">
<li><p>
描述
</p>
<pre class="example">
list the processes running on the system

</pre></li>
<li>实践
<ul class="org-ul">
<li><p>
查看
</p>
<pre class="example">
$ ps -ef

</pre></li>
</ul></li>
</ul>
</div>
</li>
<li><a id="org82d2545"></a>kill &amp; killall<br />
<div class="outline-text-5" id="text-3-6-2-3">
<ul class="org-ul">
<li><p>
描述
</p>
<pre class="example">
send a signal to one or more processes (usually to "kill" a process)

</pre></li>
</ul>
</div>
</li>
<li><a id="orgb6b5940"></a>jobs<br />
<div class="outline-text-5" id="text-3-6-2-4">
<ul class="org-ul">
<li><p>
描述
</p>
<pre class="example">
an alternate way of listing your own processes

</pre></li>
</ul>
</div>
</li>
<li><a id="orge67e07b"></a>bg<br />
<div class="outline-text-5" id="text-3-6-2-5">
<ul class="org-ul">
<li><p>
描述
</p>
<pre class="example">
put a process in the background

</pre></li>
</ul>
</div>
</li>
<li><a id="org69e0777"></a>fg<br />
<div class="outline-text-5" id="text-3-6-2-6">
<ul class="org-ul">
<li><p>
描述
</p>
<pre class="example">
put a process in the forground

</pre></li>
</ul>
</div>
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-org7772253" class="outline-2">
<h2 id="org7772253"><span class="section-number-2">4</span> Shell Scripts</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org86b409c" class="outline-3">
<h3 id="org86b409c"><span class="section-number-3">4.1</span> 疑惑</h3>
<div class="outline-text-3" id="text-4-1">
<ul class="org-ul">
<li>如何启动命令行以及接下来做什么？</li>
<li>如何使用 shell脚本来自动处理系统管理任务，包括从检测系统统计数据和数据文件到为你的老板生成报表？</li>
</ul>
</div>
</div>
<div id="outline-container-orgdd9cd1f" class="outline-3">
<h3 id="orgdd9cd1f"><span class="section-number-3">4.2</span> 学习 shell 开始</h3>
<div class="outline-text-3" id="text-4-2">
<ol class="org-ol">
<li>启动 shell
<ul class="org-ul">
<li>/bin/bash //重点讨论 GNU bash shell</li>
</ul></li>
<li>shell 提示符
<ul class="org-ul">
<li>默认的 bash shell 提示符是美元符号 \(，看起来是这样的：zrg@debian:~\)</li>
</ul></li>
<li><p>
bash 手册
</p>
<pre class="example">
man 命令用来访问存储在 Linux 系统上的手册页面。

</pre></li>
</ol>
</div>
</div>
<div id="outline-container-orgb59a071" class="outline-3">
<h3 id="orgb59a071"><span class="section-number-3">4.3</span> 理解 shell</h3>
<div class="outline-text-3" id="text-4-3">
</div>
<div id="outline-container-orgfdd0744" class="outline-4">
<h4 id="orgfdd0744"><span class="section-number-4">4.3.1</span> shell 类型</h4>
<div class="outline-text-4" id="text-4-3-1">
<ul class="org-ul">
<li>/bin/bash</li>
<li>/bin/tcsh</li>
<li>/bin/dash</li>
<li>/bin/csh</li>
<li>/bin/sh</li>
</ul>
</div>
</div>
<div id="outline-container-org65f85fb" class="outline-4">
<h4 id="org65f85fb"><span class="section-number-4">4.3.2</span> Shell 的父子关系</h4>
<div class="outline-text-4" id="text-4-3-2">
</div>
<ol class="org-ol">
<li><a id="orgad3c7f2"></a>理解<br />
<div class="outline-text-5" id="text-4-3-2-1">
<pre class="example">
$ ps -f

</pre>
<p>
UID        PID  PPID  C STIME TTY          TIME CMD
zrg      25305  4834  8 23:51 pts/4    00:00:00 -bash
zrg      25317 25305  0 23:51 pts/4    00:00:00 ps -f
</p>
<pre class="example">
$ bash
$ ps -f

</pre>
<p>
UID        PID  PPID  C STIME TTY          TIME CMD
zrg      25305  4834  0 23:51 pts/4    00:00:00 -bash
zrg      25347 25305  0 23:53 pts/4    00:00:00 bash
zrg      25352 25347  0 23:54 pts/4    00:00:00 ps -f
输入命令之后，一个子 shell 就出现了。第二个 ps -f 是在子 shell 中执行的。可以从显示结果中看到两个 bash shell 程序在运行。
</p>
<pre class="example">
$ bash
$ bash
$ bash
$ ps --forest

</pre>
<p>
PID TTY          TIME CMD
25305 pts/4    00:00:00 bash
25347 pts/4    00:00:00  &ensp;bash
25372 pts/4    00:00:00      &ensp;bash
25377 pts/4    00:00:00          &ensp;bash
25382 pts/4    00:00:00              &ensp;ps
在上面例子中，bash 命令被输入了三次。实际上创建了三个子 shell。ps &#x2013;forest 命令展示了这些子 shell 间的嵌套结构。
可以使用 exit 命令退出子 shell
</p>
<pre class="example">
$ exit

</pre>
</div>
</li>
<li><a id="orgc85bbcc"></a>进程列表<br />
<div class="outline-text-5" id="text-4-3-2-2">
<pre class="example">
$ pwd;ls;cd /etc;pwd

</pre>
<p>
/home/zrg/zhaorengui.github.io
404.html  archives  categories  _config.yml  _drafts  Gemfile.lock  index.html  _orgs   README.en.md  _sass       _site  tags
about     assets    category    _data        Gemfile  _includes     _layouts    _posts  README.md     search.xml  tag
/etc
在命令之间加入“;，指定要依次执行的一系列命令
</p>

<pre class="example">
$ (pwd;ls;cd /etc;pwd)

</pre>
<p>
/home/zrg/zhaorengui.github.io
404.html  archives  categories  _config.yml  _drafts  Gemfile.lock  index.html  _orgs   README.en.md  _sass       _site  tags
about     assets    category    _data        Gemfile  _includes     _layouts    _posts  README.md     search.xml  tag
/etc
使用括号包含命令，成为进程列表
</p>

<p>
查看是否生成了子 shell，使用：
</p>
<pre class="example">
$ echo $BASH_SUBSHELL

</pre>
</div>
</li>
<li><a id="org1dd148f"></a>子shell用法<br />
<div class="outline-text-5" id="text-4-3-2-3">
<pre class="example">
// 在后台睡眠10s
$ sleep 10&amp;
// 查看后台进程
$ ps -f
or
$ jobs -l

</pre>

<pre class="example">
//将进程列表置入后台
$ (sleep 2;echo $BASH_SUBSHELL;sleep 2)&amp;
// 创建备份
$ (tar -cf Rich.rar /home/rich;tar -cf My.tar /home/christine)&amp;

</pre>

<pre class="example">
//协程：在后台生成一个子shell，同时在这个子shell中执行命令。
// 进行协程处理，使用 coproc 命令
$ coproc sleep 10
$ coproc My_Job{sleep 10;}

</pre>
</div>
</li>
</ol>
</div>
<div id="outline-container-org0dc297e" class="outline-4">
<h4 id="org0dc297e"><span class="section-number-4">4.3.3</span> 理解 shell 的内建命令</h4>
<div class="outline-text-4" id="text-4-3-3">
<ul class="org-ul">
<li>外部命令</li>
</ul>
<pre class="example">
也被称为文件系统命令，是存在于bash shell之外的程序。
ps 就是一个外部命令，可以使用 which 和 type 命令找到
$ which ps
$ type -a ps
当外部命令执行时，会创建一个子进程，这种操作叫做衍生（forking）。

</pre>

<ul class="org-ul">
<li>内建命令</li>
</ul>
<pre class="example">
内建命令和外部命令的区别在于前者不需要使用子进程来执行。它们已经和 shell 编译成一体，作为 shell 工具的组成部分存在。
可以利用 type 命令来了解某个命令是否是内建的。
$ type cd
cd is a shell builtin
要注意，有些命令有多种实现。既有内建命令也有外部命令。
$ type -a echo
echo is a shell builtin
echo is /bin/echo
$ type -a pwd
pwd is a shell builtin
pwd is /bin/pwd 

</pre>
</div>
</div>
</div>
<div id="outline-container-org55362bd" class="outline-3">
<h3 id="org55362bd"><span class="section-number-3">4.4</span> 使用 Linux 环境变量</h3>
<div class="outline-text-3" id="text-4-4">
<ol class="org-ol">
<li>概念：环境变量（environment variable），用来存储有关 shell 会话和工作环境的信息。</li>
<li><p>
全局环境变量和局部环境变量:
</p>
<pre class="example">
// 查看全局变量
$ env
or
$ printenv
// 查看某个全局环境变量
$ env HOME
or
$ echo $HOME
// set 命令会显示为某个特定进程设置的所有环境变量，包括全局变量、局部变量以及用户自定义变量。
$ set

</pre></li>
<li><p>
设置用户自定义变量
</p>
<pre class="example">
$ my_variable=Hello
注意：所有环境变量名均使用大写字母，这是 bash shell 的标准惯例。自己创建的局部变量或是 shell 脚本，请使用小写字母。变量名区分大小写。
$ my_variable="Hello World"
// 设置全局变量
$ export my_variable="I am Global now"
// 删除环境变量
$ unset my_variable
注意：如果要用到变量，使用$；如果要操作变量，不使用$。

</pre></li>
<li>默认的 shell 环境变量</li>
<li>设置 PATH 环境变量
$ PATH=$PATH:/opt/test/scripts</li>
<li>定位系统环境变量
<ul class="org-ul">
<li><p>
登录时作为默认登录 shell
</p>
<pre class="example">
登录 shell 会从5个不同的启动文件里读取命令：
/etc/profile，默认的 bash shell 主启动文件。
$HOME/.bash_profile
$HOME/.bashrc
$HOME/.bash_login
$HOME/.profile

</pre></li>
<li><p>
作为非登录 shell 的交互式 shell
</p>
<pre class="example">
作为非登录 shell 的交互式启动的，它不会访问 /etc/profile 文件，只会检查 HOME 目录中的 .bashrc 文件。
.bashrc 文件有两个作用：一是查看/etc目录下通用的 bashrc 文件；二是为用户提供一个定制自己的命名别名和私有脚本函数的地方。

</pre></li>
<li><p>
作为运行脚本的非交互式shell
</p>
<pre class="example">
系统执行 shell 脚本时使用，不同的地方在于它没有命令提示符。bash shell 提供了 BASH_ENV 环境变量，当 shell 启动一个非交互式 shell 进程时，它会检查这个环境变量来查看要执行的启动文件。
// 环境变量持久化
在大多数发行版中，存储个人用户永久性 bash shell 变量的地方是 $HOME/.bashrc 文件。但如果设置了 BASH_ENV 变量，那么记住，除非它指向的是 $HOME/.bashrc，否则应该将非交互式 shell 的用户变量放在别的地方。

</pre></li>
</ul></li>
<li><p>
数组变量
</p>
<pre class="example">
//环境变量作为数组使用
$ mytest=(one two three four five)
$ echo ${mytest[2]}
three
$ echo ${mytest[*]}
one two three four five
//改变某个索引的值
$ mytest[2] = seven
//删除某个索引的值和删除整个数组
$ unset mytest[2]
$ unset mytest

</pre></li>
</ol>
</div>
<div id="outline-container-orgd8ccb92" class="outline-4">
<h4 id="orgd8ccb92"><span class="section-number-4">4.4.1</span> 改变安全性设置</h4>
<div class="outline-text-4" id="text-4-4-1">
<pre class="example">
1. 改变权限
chmod命令用来改变文件和目录的安全性设置。

</pre>

<pre class="example">
2. 改变所属关系
chown命令用来改变文件的所属组。

</pre>
</div>
</div>
<div id="outline-container-org0b0c2e1" class="outline-4">
<h4 id="org0b0c2e1"><span class="section-number-4">4.4.2</span> 共享文件</h4>
<div class="outline-text-4" id="text-4-4-2">
<pre class="example">
Linux为每个文件和目录存储了3个额外的信息位。

</pre>
<ul class="org-ul">
<li>设置用户ID（SUID）</li>
<li>设置组ID（GID）</li>
<li>粘着位：进程结束后文件还驻留（粘着）在内存中。</li>
</ul>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 10:</span> chmod SUID、SGID和粘着位的八进制值</caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">二进制值</th>
<th scope="col" class="org-right">八进制值</th>
<th scope="col" class="org-left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">000</td>
<td class="org-right">0</td>
<td class="org-left">所有位都清零</td>
</tr>

<tr>
<td class="org-right">001</td>
<td class="org-right">1</td>
<td class="org-left">粘着位置位</td>
</tr>

<tr>
<td class="org-right">010</td>
<td class="org-right">2</td>
<td class="org-left">SGID位置位</td>
</tr>

<tr>
<td class="org-right">011</td>
<td class="org-right">3</td>
<td class="org-left">SGID位和粘着位都置位</td>
</tr>

<tr>
<td class="org-right">100</td>
<td class="org-right">4</td>
<td class="org-left">SUID位置位</td>
</tr>

<tr>
<td class="org-right">101</td>
<td class="org-right">5</td>
<td class="org-left">SUID位和粘着位都置位</td>
</tr>

<tr>
<td class="org-right">110</td>
<td class="org-right">6</td>
<td class="org-left">SUID位和SGID都置位</td>
</tr>

<tr>
<td class="org-right">111</td>
<td class="org-right">7</td>
<td class="org-left">所有位都置位</td>
</tr>
</tbody>
</table>

<pre class="example">
//创建一个共享目录
$ mkdir testdir
$ chgrp shared testdir
$ chmod g+s testdir
$ umask 002
$ cd testdir
$ touch testfile

</pre>
</div>
</div>
</div>
<div id="outline-container-org0b7acca" class="outline-3">
<h3 id="org0b7acca"><span class="section-number-3">4.5</span> shell 脚本编程基础</h3>
<div class="outline-text-3" id="text-4-5">
</div>
<div id="outline-container-orgda8d7da" class="outline-4">
<h4 id="orgda8d7da"><span class="section-number-4">4.5.1</span> 构建基本脚本</h4>
<div class="outline-text-4" id="text-4-5-1">
</div>
<ol class="org-ol">
<li><a id="org07470f1"></a>创建一个简单的脚本<br />
<div class="outline-text-5" id="text-4-5-1-1">
<div class="org-src-container">
<pre class="src src-shell" id="org60989d3"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/bash  #&#21578;&#35785;shell&#29992;/bin/</span><span style="color: #a020f0;">bash&#26469;&#36816;&#34892;&#33050;&#26412;&#12290;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">This script displays the date and who's #&#33050;&#26412;&#29992;&#36884;&#35828;&#26126;&#21450;&#20316;&#32773;&#31561;&#20449;&#24687;&#25551;&#36848; </span>
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"This's is a shell script."</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#28040;&#24687;</span>
<span style="color: #483d8b;">echo</span> -n <span style="color: #8b2252;">"The time and date are: "</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">n&#34920;&#31034;&#22312;&#19968;&#34892;&#26174;&#31034;</span>
date

<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"User info for userid: $USER"</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29615;&#22659;&#21464;&#37327;&#65292;&#29992;set&#21629;&#20196;&#21487;&#20197;&#26597;&#30475;&#19968;&#20221;&#23436;&#25972;&#30340;&#24403;&#21069;&#29615;&#22659;&#21464;&#37327;&#21015;&#34920;&#12290;</span>
<span style="color: #483d8b;">echo</span> UID: $<span style="color: #a0522d;">UID</span>
<span style="color: #483d8b;">echo</span> HOME: $<span style="color: #a0522d;">HOME</span>
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The cost of the item is \$15."</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32654;&#20803;&#38656;&#35201;&#20351;&#29992;\&#36716;&#20041;</span>

days = 10 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#25143;&#33258;&#23450;&#20041;&#21464;&#37327;</span>
<span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">days</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#26377;&#20004;&#31181;&#26041;&#27861;&#21487;&#20197;&#23558;&#21629;&#20196;&#36171;&#32473;&#21464;&#37327;</span>
<span style="color: #483d8b;">test</span> = <span style="color: #ff00ff;">`date`</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#19968;&#23545;&#21453;&#24341;&#21495;&#25226;&#25972;&#20010;&#21629;&#20196;&#22260;&#36215;&#26469;</span>
<span style="color: #483d8b;">test</span> = $(<span style="color: #ff00ff;">date</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;$()&#26684;&#24335;</span>
today = $(<span style="color: #ff00ff;">date</span>+%y%m%d) <span style="color: #b22222;">#</span><span style="color: #b22222;">today&#21464;&#37327;&#34987;&#36171;&#20104;&#26684;&#24335;&#21270;&#21518;&#30340;date&#21629;&#20196;&#30340;&#36755;&#20986;&#12290;</span>
</pre>
</div>
</div>
</li>
<li><a id="org0266f2e"></a>重定向输入和输出<br />
<div class="outline-text-5" id="text-4-5-1-2">
<pre class="example">
// 输出重定向
$ date &gt; test
$ date &gt;&gt; test

</pre>

<pre class="example">
// 输入重定向
$ wc &lt; test

</pre>
<p>
2 11 60
</p>
<pre class="example">
//wc命令，默认情况下，会输出3个值：

</pre>
<ul class="org-ul">
<li>文本的行数</li>
<li>文本的词数</li>
<li>文本的字节数</li>
</ul>

<pre class="example">
内联输入重定向（inline input redirection）
$ wc &lt;&lt; EOF
shell 会用PS2环境变量中定义的次提示符来提示输入数据

</pre>
</div>
</li>
<li><a id="org69f20ef"></a>管道<br />
<div class="outline-text-5" id="text-4-5-1-3">
<pre class="example">
$ rpm -qa | sort
//上面的命令会同时运行。

</pre>
</div>
</li>
<li><a id="org2a3cd9e"></a>执行数学运算<br />
<div class="outline-text-5" id="text-4-5-1-4">
<pre class="example">
$ var1=$(1+5)
$ var2=$[$var1 * 2]
// 使用$和[]将数学表达式围起来
注意：bash shell数学运算符支持整数运算。z shell（zsh）提供了完整的浮点数算术操作。

</pre>

<pre class="example">
浮点解决方案
1.用内建的bash计算器：bc
$ bc

</pre>
<p>
3.44 / 5
0
scale = 4 浮点运算由scale控制，默认值为0
</p>
<pre class="example">
// -q选项可以不显示冗长的欢迎信息
$ bc -q 

</pre>
<p>
var1 = 10
var1 * 4
40
var2 = var1 / 5
print var2
2
quit
</p>
<pre class="example">
$

</pre>

<pre class="example">
2. 在脚本中使用bc

</pre>
<div class="org-src-container">
<pre class="src src-shell" id="org17cd039"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>
var1 = $(<span style="color: #ff00ff;">echo</span> <span style="color: #8b2252;">"scale=4;3.44 / 5"</span> | bc)
<span style="color: #483d8b;">echo</span> The answer is $<span style="color: #a0522d;">var1</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell" id="org3e808b3"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>

var1 = 10.46
var2 = 43.67
var3 = 33.2
var4 = 71

var5 = $(<span style="color: #ff00ff;">bc</span> &lt;&lt; EOF
<span style="color: #ffa54f;">scale =4</span>
<span style="color: #ffa54f;">a1 = ($var1*$var2)</span>
<span style="color: #ffa54f;">a2 = ($var3*var4)</span>
<span style="color: #ffa54f;">a1+b1</span>
<span style="color: #ffa54f;">EOF</span>
)

<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The final answer for this mess is $var5"</span>
</pre>
</div>
</div>
</li>
<li><a id="org5567ff5"></a>退出脚本<br />
<div class="outline-text-5" id="text-4-5-1-5">
<pre class="example">
1. 退出状态码（exit status）
$ echo $?

</pre>
<p>
0
</p>
<table id="org79a1c35" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">状态码</th>
<th scope="col" class="org-left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-left">命令成功结束</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-left">一般性未知错误</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">不适合的shell命令</td>
</tr>

<tr>
<td class="org-right">126</td>
<td class="org-left">命令不可执行</td>
</tr>

<tr>
<td class="org-right">127</td>
<td class="org-left">没找到命令</td>
</tr>

<tr>
<td class="org-right">128</td>
<td class="org-left">无效的退出参数</td>
</tr>

<tr>
<td class="org-right">128+x</td>
<td class="org-left">与Linux信号x相关的严重错误</td>
</tr>

<tr>
<td class="org-right">130</td>
<td class="org-left">通过Ctrl+C终止的命令</td>
</tr>

<tr>
<td class="org-right">255</td>
<td class="org-left">正常范围之外的退出状态码</td>
</tr>
</tbody>
</table>
<pre class="example">
2. exit命令
exit命令允许在脚本结束时指定一个退出状态码

</pre>
<div class="org-src-container">
<pre class="src src-shell" id="org1267ca8"><span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">'Hello, World'</span>
<span style="color: #a020f0;">exit</span> 5 
</pre>
</div>
<pre class="example">
$ ./test 

</pre>
<p>
Hello, World
</p>
<pre class="example">
$ echo $?

</pre>
<p>
5
</p>
</div>
</li>
</ol>
</div>
<div id="outline-container-org8fa16d2" class="outline-4">
<h4 id="org8fa16d2"><span class="section-number-4">4.5.2</span> 结构化命令</h4>
<div class="outline-text-4" id="text-4-5-2">
</div>
<ol class="org-ol">
<li><a id="org5b6959d"></a>if-then<br />
<div class="outline-text-5" id="text-4-5-2-1">
<div class="org-src-container">
<pre class="src src-shell" id="org001a8f9"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>
testuser = zrg
<span style="color: #b22222;">#</span>
<span style="color: #a020f0;">if</span> grep $<span style="color: #a0522d;">testuser</span> /etc/passwd
<span style="color: #a020f0;">then</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The bash files for user $testuser are:"</span>
    ls -a /home/$<span style="color: #a0522d;">testuser</span>/.b*
    <span style="color: #483d8b;">echo</span>
<span style="color: #a020f0;">elif</span> ls -d /home/$<span style="color: #a0522d;">testuser</span>
<span style="color: #a020f0;">then</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The user $testuser has a directory"</span>
<span style="color: #a020f0;">else</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The user $testuser does not exist on this system."</span>
    <span style="color: #483d8b;">echo</span>
<span style="color: #a020f0;">fi</span>

<span style="color: #b22222;">#</span><span style="color: #b22222;">test&#21629;&#20196;&#25552;&#20379;&#20102;&#22312;if-then&#35821;&#21477;&#20013;&#27979;&#35797;&#19981;&#21516;&#26465;&#20214;&#30340;&#36884;&#24452;&#12290;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">test&#21629;&#20196;&#21487;&#20197;&#21028;&#26029;&#19977;&#31867;&#26465;&#20214;&#65306;&#25968;&#20540;&#27604;&#36739;&#65307;&#23383;&#31526;&#20018;&#27604;&#36739;&#65307;&#25991;&#20214;&#27604;&#36739;</span>
</pre>
</div>
</div>
<ol class="org-ol">
<li><a id="org649c4c1"></a>test 命令<br />
<div class="outline-text-6" id="text-4-5-2-1-1">
<pre class="example">
格式：

</pre>
<p>
if test condition
then
	commands
fi
</p>
<pre class="example">
如果 test 命令中列出的条件成立，退出并返回退出状态码0；如果条件不成立，退出并返回非零的退出状态码。

</pre>
<div class="org-src-container">
<pre class="src src-shell" id="orgec84f88"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>
$<span style="color: #a0522d;">var</span> = 10
<span style="color: #a020f0;">if</span> [$<span style="color: #a0522d;">var</span> -eq 5]
<span style="color: #a020f0;">then</span> 
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The value $var are equal."</span>
<span style="color: #a020f0;">else</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The value $var are different."</span>
<span style="color: #a020f0;">fi</span>
$<span style="color: #a0522d;">var1</span> = baduser
<span style="color: #a020f0;">if</span> [$<span style="color: #a0522d;">USER</span> != $<span style="color: #a0522d;">var1</span>]
<span style="color: #a020f0;">then</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"This is not $var1"</span>
<span style="color: #a020f0;">else</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Welcome $var"</span>
<span style="color: #a020f0;">fi</span>
$<span style="color: #a0522d;">var2</span> = baseall
$<span style="color: #a0522d;">var3</span> = hockey
<span style="color: #a020f0;">if</span> [$<span style="color: #a0522d;">var2</span> <span style="color: #8b2252;">\&gt;</span> $<span style="color: #a0522d;">var3</span>] <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;&#31526;&#21495;&#38656;&#35201;&#36716;&#20041;&#65292;&#38450;&#27490;&#35299;&#37322;&#25104;&#36755;&#20986;&#37325;&#23450;&#21521;</span>
<span style="color: #a020f0;">then</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"$var2 is greater than $var3"</span>
<span style="color: #a020f0;">else</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"$var2 is less than $var3"</span>
<span style="color: #a020f0;">fi</span>
</pre>
</div>
<pre class="example">
特别说明：
1.test命令和测试表达式使用标准的数学比较符号来表示字符串比较，而用文本代码来表示数值比较。
2.比较测试时，大写字母被认为是小于小写字母，但sort命令恰好相反。

</pre>

<div class="org-src-container">
<pre class="src src-shell" id="orgfa1f5d1"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>
var1 = testing
var2 =<span style="color: #8b2252;">''</span>
<span style="color: #a020f0;">if</span> [-n $<span style="color: #a0522d;">var1</span>]
<span style="color: #a020f0;">then</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The string '$var1' is not empty."</span>
<span style="color: #a020f0;">else</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The string '$var1' is empty."</span>
<span style="color: #a020f0;">fi</span>
<span style="color: #a020f0;">if</span> [-z $<span style="color: #a0522d;">var2</span>]
<span style="color: #a020f0;">then</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The string '$var2' is empty."</span>
<span style="color: #a020f0;">else</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The string '$var2' is not empty."</span>
<span style="color: #a020f0;">fi</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell" id="org1350d56"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>
<span style="color: #a0522d;">jump_directory</span>=/home/arthur
<span style="color: #a020f0;">if</span> [-d $<span style="color: #a0522d;">jump_directory</span>]
<span style="color: #a020f0;">then</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The $jump_directory directory exists."</span>
<span style="color: #a020f0;">else</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The $jump_directory directory does not exists."</span>
<span style="color: #a020f0;">fi</span>
</pre>
</div>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">比较</th>
<th scope="col" class="org-left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">-d file</td>
<td class="org-left">检查file是否存在并是一个目录</td>
</tr>

<tr>
<td class="org-left">-e file</td>
<td class="org-left">检查file是否存在</td>
</tr>

<tr>
<td class="org-left">-f file</td>
<td class="org-left">检查file是否存在并是一个文件</td>
</tr>

<tr>
<td class="org-left">-r file</td>
<td class="org-left">检查file是否存在并可读</td>
</tr>

<tr>
<td class="org-left">-s file</td>
<td class="org-left">检查file是否存在并非空</td>
</tr>

<tr>
<td class="org-left">-w file</td>
<td class="org-left">检查file是否存在并可写</td>
</tr>

<tr>
<td class="org-left">-x file</td>
<td class="org-left">检查file是否存在并可执行</td>
</tr>

<tr>
<td class="org-left">-O file</td>
<td class="org-left">检查file是否存在并属当前用户所有</td>
</tr>

<tr>
<td class="org-left">-G file</td>
<td class="org-left">检查file是否存在并且默认组与当前用户相同</td>
</tr>

<tr>
<td class="org-left">file1 -nt file2</td>
<td class="org-left">检查file是否比file2</td>
</tr>

<tr>
<td class="org-left">file1 -ot file2</td>
<td class="org-left">检查file是否比file2旧</td>
</tr>
</tbody>
</table>
</div>
</li>
<li><a id="org21bc2ac"></a>复合条件<br />
<div class="outline-text-6" id="text-4-5-2-1-2">
<pre class="example">
格式：

</pre>
<p>
[condition1] &amp;&amp; [condition2]
[condition1] || [condition2]
</p>
<div class="org-src-container">
<pre class="src src-shell" id="orgff05b33"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">testing compound comparisons</span>
<span style="color: #b22222;">#</span>
<span style="color: #a020f0;">if</span> [-d $<span style="color: #a0522d;">HOME</span>] &amp;&amp; [-w $<span style="color: #a0522d;">HOME</span>/testing]
<span style="color: #a020f0;">then</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The file exists and you can write to it."</span>
<span style="color: #a020f0;">else</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"I cannot write to the file."</span>
<span style="color: #a020f0;">fi</span>
</pre>
</div>
</div>
</li>
<li><a id="orga212e31"></a>if-then 的高级特性<br />
<div class="outline-text-6" id="text-4-5-2-1-3">
<div class="org-src-container">
<pre class="src src-shell" id="orgf6a095e"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">(( expression )) expression &#21487;&#20197;&#26159;&#20219;&#24847;&#30340;&#25968;&#23398;&#36171;&#20540;&#25110;&#27604;&#36739;&#34920;&#36798;&#24335;&#12290;</span>
<span style="color: #a0522d;">var1</span>=10
<span style="color: #a020f0;">if</span>(( $<span style="color: #a0522d;">var1</span> ** 2 &gt; 90))
<span style="color: #a020f0;">then</span>
        (( $<span style="color: #a0522d;">var2</span> = $<span style="color: #a0522d;">var1</span> ** 2))
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The square of $var1 is $var2."</span>
<span style="color: #a020f0;">fi</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell" id="org07d6fdc">  <span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/bash</span>
  <span style="color: #b22222;"># </span><span style="color: #b22222;">[[ expression ]]</span>
  <span style="color: #a020f0;">if</span>[[ $<span style="color: #a0522d;">USER</span> == r* ]]
  <span style="color: #a020f0;">then</span>
          <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Hello $USER"</span>
<span style="color: #a020f0;">else</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Sorry, I do not know you."</span>
  <span style="color: #a020f0;">fi</span>
</pre>
</div>
</div>
</li>
</ol>
</li>
<li><a id="org2c9a766"></a>case 命令<br />
<div class="outline-text-5" id="text-4-5-2-2">
<pre class="example">
格式：

</pre>
<p>
case $变量名 in
模式1)
	命令序列1;;
模式2)
	命令序列2;;
*)
	默认执行的命令序列;;
esac 
</p>
<div class="org-src-container">
<pre class="src src-shell" id="orgcc69a6b">  <span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/bash</span>
  <span style="color: #a020f0;">case</span> $<span style="color: #a0522d;">action</span><span style="color: #a020f0;"> in</span>
        start | begin)
                <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"start something"</span>
                <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"begin something"</span>;;
        stop | end)
                <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"stop something"</span>
                <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"end something"</span>;;
        *)
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Ignorant."</span>;;
<span style="color: #a020f0;">esac</span>
</pre>
</div>
</div>
</li>
<li><a id="org16f3e72"></a>for 命令<br />
<div class="outline-text-5" id="text-4-5-2-3">
<pre class="example">
格式：

</pre>
<p>
for var in list
do
	commands
done
</p>
<div class="org-src-container">
<pre class="src src-shell" id="org4406905"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>
<span style="color: #b22222;">#</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">basic for command</span>
<span style="color: #a020f0;">for</span> country<span style="color: #a020f0;"> in</span> China America India Japen
<span style="color: #a020f0;">do</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The next state is $country"</span>
<span style="color: #a020f0;">done</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">another example of how not to use the for command</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">1.&#20351;&#29992;&#36716;&#20041;&#23383;&#31526;&#65288;&#21453;&#26012;&#32447;&#65289;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">2.&#20351;&#29992;&#21452;&#24341;&#21495;</span>
<span style="color: #a020f0;">for </span><span style="color: #483d8b;">test</span><span style="color: #a020f0;"> in</span> I don<span style="color: #8b2252;">\'</span>t know if <span style="color: #8b2252;">"this'll"</span> work
<span style="color: #a020f0;">do</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"word:$test"</span>
<span style="color: #a020f0;">done</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">using a variable to hold the list</span>
<span style="color: #a0522d;">list</span>=<span style="color: #8b2252;">"China America India Japen"</span>
<span style="color: #a0522d;">list</span>=$<span style="color: #a0522d;">list</span><span style="color: #8b2252;">" Connecticut"</span>
<span style="color: #a020f0;">for</span> country<span style="color: #a020f0;"> in</span> $<span style="color: #a0522d;">list</span>
<span style="color: #a020f0;">do</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Welcome to $country"</span>
<span style="color: #a020f0;">done</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">reading values from a file</span>
<span style="color: #a0522d;">file</span>=<span style="color: #8b2252;">"states"</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#20462;&#25913;IFS&#29615;&#22659;&#21464;&#37327;&#30340;&#20540;&#65292;&#20351;&#20854;&#21482;&#33021;&#35782;&#21035;&#25442;&#34892;&#31526;</span>
<span style="color: #a0522d;">IFS</span>=$<span style="color: #8b2252;">'\n'</span>
<span style="color: #a020f0;">for</span> state<span style="color: #a020f0;"> in</span> $(<span style="color: #ff00ff;">cat</span> $<span style="color: #a0522d;">file</span>)
<span style="color: #a020f0;">do</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Visit beautiful $state"</span>
<span style="color: #a020f0;">done</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">iterate through all the files in a directory</span>
<span style="color: #a020f0;">for</span> file<span style="color: #a020f0;"> in</span> $<span style="color: #a0522d;">HOME</span>/* /etc/nginx/*
<span style="color: #a020f0;">do</span>
        <span style="color: #a020f0;">if</span> [-d <span style="color: #8b2252;">"$file"</span>]
        <span style="color: #a020f0;">then</span>
                <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"$file is a directory."</span>
        <span style="color: #a020f0;">elif</span> [-f <span style="color: #8b2252;">"$file"</span>]
        <span style="color: #a020f0;">then</span>
                <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"$file is a file."</span>
        <span style="color: #a020f0;">fi</span>
<span style="color: #a020f0;">done</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">C-style for loop</span>
<span style="color: #b22222;">#</span>
<span style="color: #a020f0;">for</span> (( <span style="color: #a0522d;">i</span>=1; i &lt;= 10; i++))
<span style="color: #a020f0;">do</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The next number is $i"</span>
<span style="color: #a020f0;">done</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">multiple variable</span>
<span style="color: #a020f0;">for</span> (( <span style="color: #a0522d;">a</span>=1; <span style="color: #a0522d;">b</span>=10;a &lt;= 10; a++, b++))
<span style="color: #a020f0;">do</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"$a - $b"</span>
<span style="color: #a020f0;">done</span>
</pre>
</div>
</div>
</li>
<li><a id="org47769a2"></a>while 命令<br />
<div class="outline-text-5" id="text-4-5-2-4">
<pre class="example">
格式：

</pre>
<p>
while test command
do
	other commands
done
</p>
<div class="org-src-container">
<pre class="src src-shell" id="orgd66bc91"><span style="color: #b22222;"># </span><span style="color: #b22222;">while command test</span>
<span style="color: #a0522d;">var1</span>=10
<span style="color: #a020f0;">while</span> [ $<span style="color: #a0522d;">var1</span> -gt 0 ]
<span style="color: #a020f0;">do</span>
        <span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">var1</span>
        <span style="color: #a0522d;">var1</span>=$[ $<span style="color: #a0522d;">var1</span> - 1 ]
<span style="color: #a020f0;">done</span>
</pre>
</div>
</div>
</li>

<li><a id="org4f55abf"></a>until 命令<br />
<div class="outline-text-5" id="text-4-5-2-5">
<pre class="example">
until 命令和 while 命令完全相反。
格式：

</pre>
<p>
until test command
do
	other commands
done
</p>
<div class="org-src-container">
<pre class="src src-shell" id="org0d1df4e"><span class="linenr">1: </span><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>
<span class="linenr">2: </span><span style="color: #b22222;"># </span><span style="color: #b22222;">using the until command</span>
<span class="linenr">3: </span><span style="color: #a0522d;">var1</span>=100
<span class="linenr">4: </span><span style="color: #a020f0;">until</span> [ $<span style="color: #a0522d;">var1</span> -eq 0 ]
<span class="linenr">5: </span><span style="color: #a020f0;">do</span>
<span class="linenr">6: </span>        <span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">var1</span>
<span class="linenr">7: </span>        <span style="color: #a0522d;">var1</span>=$[ $<span style="color: #a0522d;">var1</span> -25 ]
<span class="linenr">8: </span><span style="color: #a020f0;">done</span>
</pre>
</div>
</div>
</li>

<li><a id="orgb793c58"></a>应用<br />
<ol class="org-ol">
<li><a id="org935cf2b"></a>循环处理文件数据<br />
<div class="outline-text-6" id="text-4-5-2-6-1">
<div class="org-src-container">
<pre class="src src-shell" id="org79a9d9c"><span class="linenr"> 1: </span><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>
<span class="linenr"> 2: </span><span style="color: #b22222;"># </span><span style="color: #b22222;">changing the IFS value</span>
<span class="linenr"> 3: </span>IFS.OLD=$<span style="color: #a0522d;">IFS</span>
<span class="linenr"> 4: </span><span style="color: #a0522d;">IFS</span>=$<span style="color: #8b2252;">'\n'</span>
<span class="linenr"> 5: </span><span style="color: #a020f0;">for</span> entry<span style="color: #a020f0;"> in</span> $(<span style="color: #ff00ff;">cat</span> /etc/passwd)
<span class="linenr"> 6: </span><span style="color: #a020f0;">do</span>
<span class="linenr"> 7: </span>        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Values in $entry -"</span>
<span class="linenr"> 8: </span>        <span style="color: #a0522d;">IFS</span>=:
<span class="linenr"> 9: </span>        <span style="color: #a020f0;">for</span> value<span style="color: #a020f0;"> in</span> $<span style="color: #a0522d;">entry</span>
<span class="linenr">10: </span>        <span style="color: #a020f0;">do</span>
<span class="linenr">11: </span>                <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"$value"</span>
<span class="linenr">12: </span>        <span style="color: #a020f0;">done</span>
<span class="linenr">13: </span><span style="color: #a020f0;">done</span>
<span class="linenr">14: </span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#35813;&#33050;&#26412;&#20351;&#29992;&#20102;&#20004;&#20010;&#19981;&#21516;&#30340; IFS &#30340;&#20540;&#26469;&#35299;&#26512;&#25968;&#25454;&#65292;&#31532;&#19968;&#20010; IFS &#20540;&#35299;&#26512;&#20986; /etc/passwd &#25991;&#20214;&#20013;&#30340;&#21333;&#29420;&#30340;&#34892;&#65292;&#20869;&#37096; for &#24490;&#29615;&#25509;&#30528;&#23558; IFS &#30340;&#20540;&#20462;&#25913;&#20026;&#20882;&#21495;&#65292;&#20801;&#35768;&#20320;&#20174; /etc/passwd &#30340;&#34892;&#20013;&#35299;&#26512;&#20986;&#21333;&#29420;&#30340;&#20540;&#12290;</span>
</pre>
</div>
</div>
</li>
<li><a id="org7bb19a0"></a>break 命令<br />
<div class="outline-text-6" id="text-4-5-2-6-2">
<div class="org-src-container">
<pre class="src src-shell" id="org8557971"><span class="linenr"> 1: </span><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>
<span class="linenr"> 2: </span><span style="color: #b22222;"># </span><span style="color: #b22222;">--------------------------------</span>
<span class="linenr"> 3: </span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#36339;&#20986;&#21333;&#20010;&#24490;&#29615;</span>
<span class="linenr"> 4: </span><span style="color: #b22222;"># </span><span style="color: #b22222;">1.breaking out of a for loop</span>
<span class="linenr"> 5: </span><span style="color: #a020f0;">for</span> var1<span style="color: #a020f0;"> in</span> 1 2 3 4 5
<span class="linenr"> 6: </span><span style="color: #a020f0;">do</span>
<span class="linenr"> 7: </span>        <span style="color: #a020f0;">if</span> [ $<span style="color: #a0522d;">var1</span> -eq 5]
<span class="linenr"> 8: </span>        <span style="color: #a020f0;">then</span>
<span class="linenr"> 9: </span>                <span style="color: #a020f0;">break</span>
<span class="linenr">10: </span>        <span style="color: #a020f0;">fi</span>
<span class="linenr">11: </span>        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Iteration number: $var1"</span>
<span class="linenr">12: </span><span style="color: #a020f0;">done</span>
<span class="linenr">13: </span><span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The for loop is completed"</span>
<span class="linenr">14: </span><span style="color: #b22222;"># </span><span style="color: #b22222;">2.breaking out of a while loop</span>
<span class="linenr">15: </span><span style="color: #a0522d;">var1</span>=1
<span class="linenr">16: </span><span style="color: #a020f0;">while</span> [ $<span style="color: #a0522d;">var1</span> -lt 10 ]
<span class="linenr">17: </span><span style="color: #a020f0;">do</span>
<span class="linenr">18: </span>        <span style="color: #a020f0;">if</span> [ $<span style="color: #a0522d;">var1</span> -eq 5]
<span class="linenr">19: </span>        <span style="color: #a020f0;">then</span>
<span class="linenr">20: </span>                <span style="color: #a020f0;">break</span>
<span class="linenr">21: </span>        <span style="color: #a020f0;">fi</span>
<span class="linenr">22: </span>        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Iteration number: $var1"</span>
<span class="linenr">23: </span><span style="color: #a020f0;">done</span>
<span class="linenr">24: </span><span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The while loop is completed"</span>
<span class="linenr">25: </span><span style="color: #b22222;"># </span><span style="color: #b22222;">--------------------------------</span>
<span class="linenr">26: </span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#36339;&#20986;&#20869;&#37096;&#24490;&#29615;</span>
<span class="linenr">27: </span><span style="color: #b22222;"># </span><span style="color: #b22222;">3.breaking out of an inner loop</span>
<span class="linenr">28: </span><span style="color: #a020f0;">for</span>(( a = 1; a&lt;4; a++))
<span class="linenr">29: </span><span style="color: #a020f0;">do</span>
<span class="linenr">30: </span>        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Outer loop: $a"</span>
<span class="linenr">31: </span>        <span style="color: #a020f0;">for</span>((b = 1; b&lt;100; b++))
<span class="linenr">32: </span>        <span style="color: #a020f0;">do</span>
<span class="linenr">33: </span>                <span style="color: #a020f0;">if</span> [ $<span style="color: #a0522d;">var1</span> -eq 5]
<span class="linenr">34: </span>                <span style="color: #a020f0;">then</span>
<span class="linenr">35: </span>                        <span style="color: #a020f0;">break</span>
<span class="linenr">36: </span>                <span style="color: #a020f0;">fi</span>
<span class="linenr">37: </span>                <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Inner loop: $b"</span>
<span class="linenr">38: </span>        <span style="color: #a020f0;">done</span>
<span class="linenr">39: </span><span style="color: #a020f0;">done</span>
<span class="linenr">40: </span><span style="color: #b22222;"># </span><span style="color: #b22222;">---------------------------------</span>
<span class="linenr">41: </span><span style="color: #b22222;"># </span><span style="color: #b22222;">&#36339;&#20986;&#22806;&#37096;&#24490;&#29615;</span>
<span class="linenr">42: </span><span style="color: #b22222;"># </span><span style="color: #b22222;">4.breaking out of an outer loop</span>
<span class="linenr">43: </span><span style="color: #a020f0;">for</span>(( a = 1; a&lt;4; a++))
<span class="linenr">44: </span><span style="color: #a020f0;">do</span>
<span class="linenr">45: </span>        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Outer loop: $a"</span>
<span class="linenr">46: </span>        <span style="color: #a020f0;">for</span>((b = 1; b&lt;100; b++))
<span class="linenr">47: </span>        <span style="color: #a020f0;">do</span>
<span class="linenr">48: </span>                <span style="color: #a020f0;">if</span> [ $<span style="color: #a0522d;">var1</span> -eq 5]
<span class="linenr">49: </span>                <span style="color: #a020f0;">then</span>
<span class="linenr">50: </span>                        <span style="color: #a020f0;">break</span> 2
<span class="linenr">51: </span>                <span style="color: #a020f0;">fi</span>
<span class="linenr">52: </span>                <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Inner loop: $b"</span>
<span class="linenr">53: </span>        <span style="color: #a020f0;">done</span>
<span class="linenr">54: </span><span style="color: #a020f0;">done</span>
</pre>
</div>
</div>
</li>
<li><a id="orgd50b043"></a>continue 命令<br />
<div class="outline-text-6" id="text-4-5-2-6-3">
<div class="org-src-container">
<pre class="src src-shell" id="org1c16a21"><span class="linenr"> 1: </span><span style="color: #b22222;"># </span><span style="color: #b22222;">1.using the continue command</span>
<span class="linenr"> 2: </span><span style="color: #a020f0;">for</span>((var1 = 1; var1&lt;15; var1++))
<span class="linenr"> 3: </span><span style="color: #a020f0;">do</span>
<span class="linenr"> 4: </span>        <span style="color: #a020f0;">if</span> [$<span style="color: #a0522d;">var1</span> -gt 5] &amp;&amp; [$<span style="color: #a0522d;">var1</span> -lt 10]
<span class="linenr"> 5: </span>        <span style="color: #a020f0;">then</span>
<span class="linenr"> 6: </span>                <span style="color: #a020f0;">continue</span>
<span class="linenr"> 7: </span>        <span style="color: #a020f0;">fi</span>
<span class="linenr"> 8: </span>        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Iteration number: $var1"</span>
<span class="linenr"> 9: </span><span style="color: #a020f0;">done</span>
<span class="linenr">10: </span><span style="color: #b22222;"># </span><span style="color: #b22222;">2.improperly using the continue command in a while loop</span>
<span class="linenr">11: </span><span style="color: #a0522d;">var1</span>=1
<span class="linenr">12: </span><span style="color: #a020f0;">while </span><span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"while iteration: $var1"</span>
<span class="linenr">13: </span>        [ $<span style="color: #a0522d;">var1</span> -lt 15 ]
<span class="linenr">14: </span><span style="color: #a020f0;">do</span>
<span class="linenr">15: </span>        <span style="color: #a020f0;">if</span> [ $<span style="color: #a0522d;">var1</span> -gt 5] &amp;&amp; [$<span style="color: #a0522d;">var1</span> -lt 10]
<span class="linenr">16: </span>        <span style="color: #a020f0;">then</span>
<span class="linenr">17: </span>                <span style="color: #a020f0;">continue</span>
<span class="linenr">18: </span>        <span style="color: #a020f0;">fi</span>
<span class="linenr">19: </span>        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Inside iteration number: $var1"</span>
<span class="linenr">20: </span>        var1 = $[$<span style="color: #a0522d;">var1</span> +1]
<span class="linenr">21: </span><span style="color: #a020f0;">done</span>
<span class="linenr">22: </span><span style="color: #b22222;"># </span><span style="color: #b22222;">3.continuing an outer loop</span>
<span class="linenr">23: </span><span style="color: #a020f0;">for</span>(( a = 1; a&lt;5; a++))
<span class="linenr">24: </span><span style="color: #a020f0;">do</span>
<span class="linenr">25: </span>        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"Interation : $a"</span>
<span class="linenr">26: </span>        <span style="color: #a020f0;">for</span>((b = 1; b&lt;3; b++))
<span class="linenr">27: </span>        <span style="color: #a020f0;">do</span>
<span class="linenr">28: </span>                <span style="color: #a020f0;">if</span> [ $<span style="color: #a0522d;">b</span> -gt 2] &amp;&amp; [$<span style="color: #a0522d;">a</span> -lt 4]
<span class="linenr">29: </span>                <span style="color: #a020f0;">then</span>
<span class="linenr">30: </span>                        <span style="color: #a020f0;">continue</span> 2
<span class="linenr">31: </span>                <span style="color: #a020f0;">fi</span>
<span class="linenr">32: </span>                <span style="color: #a0522d;">var3</span>=$[$<span style="color: #a0522d;">a</span>+$<span style="color: #a0522d;">b</span>]
<span class="linenr">33: </span>                <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The result of $a * $b is $var3"</span>
<span class="linenr">34: </span>        <span style="color: #a020f0;">done</span>
<span class="linenr">35: </span><span style="color: #a020f0;">done</span>
</pre>
</div>
</div>
</li>
<li><a id="org9f7e72e"></a>处理循环的输出<br />
<div class="outline-text-6" id="text-4-5-2-6-4">
<pre class="example">
可以对循环的输出使用管道或进行重定向，通过在 done 命令之后添加一个处理命令来实现：

</pre>
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orga270bdb">for file in /home/zrg/*
do
...
done &gt; output.txt
</pre>
</div>
</div>
</li>
<li><a id="org6ca4a1a"></a>实例<br />
<div class="outline-text-6" id="text-4-5-2-6-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgd52e788">#!/bin/bash
# finding files in the PATH
IF=:
for folder in $PATH
do
        echo <span style="color: #8b2252;">"$folder:"</span>
        for file in $folder/*
        do
                if [-x $file]
                then
                        echo <span style="color: #8b2252;">"$file"</span>
                fi
        done
done
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org9ddfc83">#!/bin/bash
# process new user accounts
input = <span style="color: #8b2252;">"users.csv"</span>
while IFS=',' read -r userid name
do
        echo <span style="color: #8b2252;">"adding $userid"</span>
        useradd -c <span style="color: #8b2252;">"$name"</span> -m $userid
done &lt; <span style="color: #8b2252;">"$input"</span>
</pre>
</div>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div id="outline-container-orgb6cb82d" class="outline-4">
<h4 id="orgb6cb82d"><span class="section-number-4">4.5.3</span> 输入输出</h4>
<div class="outline-text-4" id="text-4-5-3">
</div>
<ol class="org-ol">
<li><a id="orgae96675"></a>命令行参数<br />
<div class="outline-text-5" id="text-4-5-3-1">
<pre class="example">
位置参数(positional parameter)变量是标准的数字：$0是程序名，$1是第一个参数，$2是第二个参数，依次类推，直到第九个参数$9

</pre>
<div class="org-src-container">
<pre class="src src-shell" id="org2cf40b0"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">bash</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">using one command line parameter</span>
<span style="color: #b22222;">#</span>
<span style="color: #a0522d;">factorial</span>=1
<span style="color: #a020f0;">for</span> ((<span style="color: #a0522d;">number</span>=1; number&lt;=$<span style="color: #a0522d;">1</span>; number++))
<span style="color: #a020f0;">do</span>
        <span style="color: #a0522d;">factorial</span>=$[$<span style="color: #a0522d;">factorial</span> * $<span style="color: #a0522d;">number</span>]
<span style="color: #a020f0;">done</span>
<span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"The factorial of $1 is $factorial"</span>
</pre>
</div>
</div>
</li>
</ol>
</div>

<div id="outline-container-orgf3433d6" class="outline-4">
<h4 id="orgf3433d6"><span class="section-number-4">4.5.4</span> 控制脚本</h4>
</div>
</div>
<div id="outline-container-org3fafaf6" class="outline-3">
<h3 id="org3fafaf6"><span class="section-number-3">4.6</span> 高级 shell 脚本编程</h3>
<div class="outline-text-3" id="text-4-6">
</div>
<div id="outline-container-org376703c" class="outline-4">
<h4 id="org376703c"><span class="section-number-4">4.6.1</span> 创建函数</h4>
</div>
<div id="outline-container-org4be1910" class="outline-4">
<h4 id="org4be1910"><span class="section-number-4">4.6.2</span> 图形化桌面环境中的脚本编程</h4>
</div>
<div id="outline-container-org53f956d" class="outline-4">
<h4 id="org53f956d"><span class="section-number-4">4.6.3</span> 初识 sed 和 gawk</h4>
</div>
<div id="outline-container-org3b56878" class="outline-4">
<h4 id="org3b56878"><span class="section-number-4">4.6.4</span> 正则表达式</h4>
</div>
<div id="outline-container-orgf44a55a" class="outline-4">
<h4 id="orgf44a55a"><span class="section-number-4">4.6.5</span> sed 和 gawk 进阶</h4>
</div>
<div id="outline-container-org24bd27e" class="outline-4">
<h4 id="org24bd27e"><span class="section-number-4">4.6.6</span> 使用其他 shell</h4>
</div>
</div>
<div id="outline-container-org9de2abb" class="outline-3">
<h3 id="org9de2abb"><span class="section-number-3">4.7</span> 创建实用的脚本</h3>
<div class="outline-text-3" id="text-4-7">
</div>
<div id="outline-container-org2c0b571" class="outline-4">
<h4 id="org2c0b571"><span class="section-number-4">4.7.1</span> 编写简单的脚本实用工具</h4>
<div class="outline-text-4" id="text-4-7-1">
</div>
<ol class="org-ol">
<li><a id="orgc603fe5"></a>归档<br /></li>
<li><a id="org4c01501"></a>管理用户账户<br /></li>
<li><a id="org064224d"></a>检测磁盘空间<br /></li>
</ol>
</div>
<div id="outline-container-orgd259d52" class="outline-4">
<h4 id="orgd259d52"><span class="section-number-4">4.7.2</span> 创建与数据库、Web及E-Mail相关的脚本</h4>
</div>
<div id="outline-container-orgdb49b17" class="outline-4">
<h4 id="orgdb49b17"><span class="section-number-4">4.7.3</span> 一些小意思的脚本</h4>
<div class="outline-text-4" id="text-4-7-3">
</div>
<ol class="org-ol">
<li><a id="orgfaff8c9"></a>发送消息<br /></li>
<li><a id="orgc26bee6"></a>获取格言<br /></li>
<li><a id="org0b99792"></a>编造借口<br /></li>
<li><a id="orgcb7981a"></a>在当前目录及指定子目录深度下创建.gitignore文件<br />
<div class="outline-text-5" id="text-4-7-3-4">
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">sh</span>
<span style="color: #a020f0;">for</span> dir<span style="color: #a020f0;"> in</span> <span style="color: #ff00ff;">`find ./ -mindepth 2 -maxdepth 4 -type d`</span>
<span style="color: #a020f0;">do</span>
        <span style="color: #483d8b;">echo</span> $<span style="color: #a0522d;">dir</span>
        <span style="color: #ff00ff;">`touch $dir/.gitignore`</span>
        <span style="color: #483d8b;">echo</span> <span style="color: #8b2252;">"*"</span>&gt;$<span style="color: #a0522d;">dir</span>/.gitignore
<span style="color: #a020f0;">done</span>
</pre>
</div>
</div>
</li>
<li><a id="orge0424bd"></a>解决 dpkg: warning: files list file for package 'x' missing<br />
<div class="outline-text-5" id="text-4-7-3-5">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span></label><pre class="src src-shell"><span style="color: #a020f0;">for</span> package<span style="color: #a020f0;"> in</span> $(<span style="color: #ff00ff;">sudo</span> apt install catdoc 2&amp;1 |grep <span style="color: #8b2252;">"warning: files list file for package'"</span> |grep -Po <span style="color: #8b2252;">"[^'\n ]+'"</span> |grep -Po <span style="color: #8b2252;">"[^']+"</span>);
<span style="color: #a020f0;">do</span>
        sudo apt install --reinstall <span style="color: #8b2252;">"$package"</span>
<span style="color: #a020f0;">done</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-orgfd56aaf" class="outline-2">
<h2 id="orgfd56aaf"><span class="section-number-2">5</span> Linux 进阶篇(Advanced)：系统管理</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-orgf8c1cc2" class="outline-3">
<h3 id="orgf8c1cc2"><span class="section-number-3">5.1</span> Linux 帐号管理与 ACL 权限控制</h3>
<div class="outline-text-3" id="text-5-1">
</div>
<div id="outline-container-org8d9b91c" class="outline-4">
<h4 id="org8d9b91c"><span class="section-number-4">5.1.1</span> Linux 账户</h4>
<div class="outline-text-4" id="text-5-1-1">
<ol class="org-ol">
<li><p>
/etc/passwd
</p>
<pre class="example">
$ cat /etc/passwd

</pre>
<p>
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
&#x2026;
zrg:x:1000:1000:zrg,,,:/home/zrg:/bin/bash
</p>
<pre class="example">
/etc/passwd 文件的字段包含如下信息：

</pre>
<ul class="org-ul">
<li>登录用户名</li>
<li>用户密码</li>
<li>UID</li>
<li>Group ID</li>
<li>描述</li>
<li>HOME目录位置</li>
<li>默认shell</li>
</ul>
<pre class="example">
/etc/passwd文件中的密码字段都被设置成了x，多数Linux系统都将用户密码保存在/etc/shadow文件中，只有特定的程序（比如登录程序）才能访问这个文件。
一般情况下，不建议直接手动在/etc/passwd文件里进行用户管理（比如添加、修改或删除用户账户）。用标准的Linux用户管理工具去执行这些操作就会安全许多。

</pre></li>
<li><p>
/etc/shadow
</p>
<pre class="example">
/etc/shadow 文件的每条记录都有9个字段：

</pre>
<ul class="org-ul">
<li>与/etc/passwd文件对应的登录名</li>
<li>加密后的密码</li>
<li>自上次修改密码后过去的天数密码（自1970年1月1日开始计算）</li>
<li>多少天后才能更改密码</li>
<li>多少天后必须更改密码</li>
<li>密码过期前提前多少天提醒用户更改密码</li>
<li>密码过期后多少天禁用用户帐目</li>
<li>用户账户被禁用的日期（用自1970年1月1日到当天的天数表示）</li>
<li>预留字段给将来使用</li>
</ul></li>
<li>用户管理文件
<ul class="org-ul">
<li><p>
Home 目录
</p>
<pre class="example">
超级用户：/root/
普通用户：/home/zrg/

</pre></li>
<li><p>
<i>var/spool/mail/zrg</i>
</p>
<pre class="example">
用户邮箱目录

</pre></li>
<li><p>
/etc/skel
</p>
<pre class="example">
在创建用户时，默认复制该目录下的文件到用户的家目录。

</pre></li>
</ul></li>
<li><p>
新增、删除和修改用户
</p>
<pre class="example">
//新增用户
$ sudo useradd -D
or
$ sudo less /etc/default/useradd
See below, the subsection "Changing the default values".

</pre>
<p>
GROUP=100 //用户默认组，新用户被添加到GID为100的公共组
HOME=/home //HOME目录位置
INACTIVE=-1 //密码过期宽限天数，密码过期后不会被禁用
EXPIRE= //密码失效时间，未被设置过期日期，密码失效与 /etc/login.defs 默认文件相关。
SHELL=/bin/sh //将sh作为默认shell
SKEL=/etc/skel //模板目录，会将/etc/skel目录下的内容复制到用户的HOME目录下
CREATE_MAIL_SPOOL=no //是否为该用户账户在mail目录下创建一个用于接收邮件的文件
</p>
<pre class="example">
//用上面的默认系统参数创建一个新用户账户
$ sudo useradd test
//要想在创建用户时改变默认值或默认行为，可以使用命令参数，比如:
$ sudo useradd -u 666 -G root,bin -c "test user" -d /home/test -s /bin/bash test

</pre>

<pre class="example">
//删除用户
默认情况下，userdel命令只会删除/etc/passwd文件中的用户信息，而不会删除系统中属于该账户的任何文件。
$ userdel -r test
加上-r参数，userdel会删除用户的HOME目录以及邮件目录，但必须在删除之前检查清楚（比如是否存放了其他用户或其他程序要使用的重要文件）

</pre>

<pre class="example">
//修改用户

</pre>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 11:</span> 用户账户修改工具</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">命令</th>
<th scope="col" class="org-left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">usermod</td>
<td class="org-left">修改用户账户的字段，指定主要组以及附加组的所属关系</td>
</tr>

<tr>
<td class="org-left">passwd</td>
<td class="org-left">修改已有用户的密码</td>
</tr>

<tr>
<td class="org-left">chpasswd</td>
<td class="org-left">从文件中读取登录名密码对，并更新密码</td>
</tr>

<tr>
<td class="org-left">chage</td>
<td class="org-left">修改密码的过期时间</td>
</tr>

<tr>
<td class="org-left">chfn</td>
<td class="org-left">修改用户账户的备注信息</td>
</tr>

<tr>
<td class="org-left">chsh</td>
<td class="org-left">修改用户账户的默认登录shell</td>
</tr>
</tbody>
</table></li>
<li><p>
修改密码
</p>
<pre class="example">
修改用户密码的命令：passwd

</pre>
<p>
-S 查询用户密码的状态，仅root用户可用。
-l 暂时锁定用户。仅root用户可用。
-u 解锁用户。仅root用户可用。
&#x2013;stdin 通过管道符输出的数据作为用户的密码。
</p></li>
</ol>
</div>
</div>
<div id="outline-container-orge426e44" class="outline-4">
<h4 id="orge426e44"><span class="section-number-4">5.1.2</span> Linux 群组</h4>
<div class="outline-text-4" id="text-5-1-2">
<ol class="org-ol">
<li><p>
/etc/group
</p>
<pre class="example">
/etc/group文件有4个字段：

</pre>
<ul class="org-ul">
<li>组名</li>
<li>组密码</li>
<li>GID</li>
<li>属于该组的用户列表，当一个用户在/etc/passwd文件中指定某个组作为默认组时，用户账户不会作为该组成员再出现在/etc/group文件中。</li>
</ul></li>
<li><p>
/etc/gshadow
</p>
<pre class="example">
/etc/group的加密资讯文件，比如用户组（Group）管理密码就是存放在这个文件。
/etc/gshadow和/etc/group是互补的两个文件；对于大型服务器，针对很多用户和组，定制一些关系结构比较复杂的权限模型，设置用户组密码是极有
必要的。比如我们不想让一些非用户组成员永久拥有用户组的权限和特性，这时我们可以通过密码验证的方式来让某些用户临时拥有一些用户组特性，
这时就要用到用户组密码。

</pre>

<pre class="example">
$ sudo less /etc/gshadow

</pre>
<p>
组名：用户组的名称，由字母或数字构成。
口令：用户组密码，这个段可以是空的或!，如果是空的或有!，表示没有密码。
组管理者：这个字段也可为空，如果有多个用户组管理者，用,号分割。
组内用户列表：如果有多个成员，用,号分割 ;
</p></li>
<li><p>
创建、修改和删除组
</p>
<pre class="example">
$ sudo groupadd shared
$ sudo groupmod -n sharing shared
$ sudo groupdel shared

</pre></li>
<li><p>
加入组和从组里删除
</p>
<pre class="example">
$ sudo gpasswd -a test tests
$ sudo gpasswd -d test tests

</pre></li>
</ol>
</div>
</div>
<div id="outline-container-org9d88a1c" class="outline-4">
<h4 id="org9d88a1c"><span class="section-number-4">5.1.3</span> Linux 细部权限规划：ACL 的使用</h4>
<div class="outline-text-4" id="text-5-1-3">
</div>
<ol class="org-ol">
<li><a id="orgbce30bc"></a>什么是 ACL？<br />
<div class="outline-text-5" id="text-5-1-3-1">
<pre class="example">
ACL 是 Access Control List 的缩写，主要的目的是在提供传统的 owner,group,others 的 read,write,execute 权限之外的细部权限配置。
ACL 主要可以针对哪些方面来控制权限呢？它主要可以针对几个项目：

</pre>
<ul class="org-ul">
<li>使用者 (user)：可以针对使用者来配置权限；</li>
<li>群组 (group)：针对群组为对象来配置其权限；</li>
<li>默认属性 (mask)：还可以针对在该目录下在创建新文件/目录时，规范新数据的默认权限；</li>
</ul>
</div>
</li>
<li><a id="orgef7be91"></a>如何开启 ACL？<br />
<div class="outline-text-5" id="text-5-1-3-2">
<pre class="example">
// 查看分区 ACL 权限是否开启。
$ sudo dumpe2fs -h /dev/sdb1
// 找到"Default mount options"，查看是否有

</pre>

<pre class="example">
// 临时开启分区 ACL 权限
$ sudo mount -o remount,acl /
// 重新挂载跟分区，并挂载加入 acl 权限。
// 永久开启分区 ACL 权限
$ sudo vim /etc/fstab

</pre>
<p>
UUID=e50dea0a-bcb6-4921-8762-dd96782846dd / ext4 defaults,acl 0 1
</p>
<pre class="example">
// 加入acl。注意：目前多数 Linux 系统 defaults 默认已经支持 acl 开启了，所以只需要添加 defaults 选项就可以了。
$ sudo mount -o remount /
// 重新挂载文件系统或重启系统，使修改生效。

</pre>
</div>
</li>
<li><a id="orga3e0cf6"></a>设定 ACL 权限<br />
<div class="outline-text-5" id="text-5-1-3-3">
<ol class="org-ol">
<li><p>
setfacl 命令
</p>
<pre class="example">
选项与参数：

</pre>
<p>
-m ：配置后续的 acl 参数给文件使用，不可与 -x 合用；
-x ：删除后续的 acl 参数，不可与 -m 合用；
-b ：移除所有的 ACL 配置参数；
-k ：移除默认的 ACL 参数，关于所谓的『默认』参数于后续范例中介绍；
-R ：递归配置 acl ，亦即包括次目录都会被配置起来；
-d ：配置『默认 acl 参数』的意思！只对目录有效，在该目录新建的数据会引用此默认值
</p>
<pre class="example">
示例：构建听课权限组，为特定用户设定 ACL 权限
# useradd wang
# useradd li
# useradd zhao
# groupadd coursegroup
# mkdir /project
# chown root:coursegroup /project/
# chmod 770 /project
# setfacl -m u:zhao:rwx /project
// setfacl格式：u:使用者:权限

</pre></li>
<li><p>
getfacl 命令
</p>
<pre class="example">
选项与参数：getfacl 的选项几乎与 setfacl 相同！
格式: getfacl filename

</pre></li>
<li><p>
针对有效权限 (effective permission)mask 的设定
</p>
<pre class="example">
有效权限：使用者或群组所配置的权限必须要存在于 mask 的权限配置范围内才会生效。
配置规范：『 m:[rwx] 』，例如针对某个文件规范为仅有 rx ：
# setfacl -m m:rx /project/testfile

</pre></li>
<li><p>
针对默认权限的设定
</p>
<pre class="example">
配置规范：『 d:[ug]:使用者列表:[rwx] 』
# setfacl -m d:u:zhao:rx /project

</pre></li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-orge7e5ed5" class="outline-3">
<h3 id="orge7e5ed5"><span class="section-number-3">5.2</span> 例行性工作排程</h3>
<div class="outline-text-3" id="text-5-2">
</div>
<div id="outline-container-org09e5c7e" class="outline-4">
<h4 id="org09e5c7e"><span class="section-number-4">5.2.1</span> 对于 Linux 用户</h4>
<div class="outline-text-4" id="text-5-2-1">
<pre class="example">
你肯定希望：
     每一天早上 8:00 钟，让电脑连接上音响，并播放音乐来唤你起床；
     而中午 12:00 希望 Linux 可以发一封信到你的邮件信箱，提醒你可以去吃午餐了；
     另外，在每年你爱人生日的前一天，先发封信提醒你，以免忘记这么重要的一天。

</pre>
</div>
</div>
<div id="outline-container-org8585652" class="outline-4">
<h4 id="org8585652"><span class="section-number-4">5.2.2</span> crontab 简单介绍</h4>
<div class="outline-text-4" id="text-5-2-2">
<pre class="example">
crontab 命令的功能是在一定的时间间隔调度一些命令的执行。
1./etc/crontab 文件
在 /etc 目录下有一个 crontab 文件，这里存放有系统运行的一些调度程序。每个用户可以建立自己的调度 crontab(在 /var/spool/cron 目录下)。

cron 服务每分钟不仅要读一次 /var/spool/cron 内的所有文件，还需要读一次 /etc/crontab，因此我们配置这个文件也能运用 cron 服务做一些事情。

用 crontab 配置是针对某个用户的，而编辑 /etc/crontab 是针对系统的任务。

2.crontab 文件格式如下：

</pre>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #a0522d;">SHELL</span>=/bin/bash
<span style="color: #a0522d;">PATH</span>=/sbin:/bin:/usr/sbin:/usr/bin
<span style="color: #a0522d;">MAILTO</span>=root       <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#20986;&#29616;&#38169;&#35823;&#65292;&#25110;&#32773;&#26377;&#25968;&#25454;&#36755;&#20986;&#65292;&#25968;&#25454;&#20316;&#20026;&#37038;&#20214;&#21457;&#32473;&#36825;&#20010;&#24080;&#21495;</span>
<span style="color: #a0522d;">HOME</span>=/            <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20351;&#29992;&#32773;&#36816;&#34892;&#30340;&#36335;&#24452;,&#36825;&#37324;&#26159;&#26681;&#30446;&#24405;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">run-parts</span>
</pre>
</div>
<pre class="example">
注意到"run-parts"这个参数，后面可以写要运行的某个脚本。

另外：
/usr/lib/cron/cron.allow 表示谁能使用 crontab 命令。如果它是一个空文件表明没有一个用户能安排作业。如果这个文件不存在，而有另外一个文件。
/usr/lib/cron/cron.deny,则只有不包括在这个文件中的用户才可以使用 crontab 命令。如果它是一个空文件表明任何用户都可安排作业。两个文件同时存在时，cron.allow 优先，如果都不存在，只有超级用户可以安排作业。

</pre>
</div>
</div>
<div id="outline-container-orga98584a" class="outline-4">
<h4 id="orga98584a"><span class="section-number-4">5.2.3</span> crontab 基本格式</h4>
<div class="outline-text-4" id="text-5-2-3">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">\</th>
<th scope="col" class="org-left">*</th>
<th scope="col" class="org-left">*</th>
<th scope="col" class="org-left">*</th>
<th scope="col" class="org-left">*</th>
<th scope="col" class="org-left">*</th>
<th scope="col" class="org-left">commond</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">代表意思</td>
<td class="org-left">分</td>
<td class="org-left">时</td>
<td class="org-left">日</td>
<td class="org-left">月</td>
<td class="org-left">周</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">范    围</td>
<td class="org-left">(0-59)</td>
<td class="org-left">(0-23)</td>
<td class="org-left">(1-31)</td>
<td class="org-left">(1-12)</td>
<td class="org-left">(0-6)</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>

<pre class="example">
“ * ”表示任意时刻
“ , ”表示分割
“ - ”表示一个段
“ /n ”表示每 n 的单位执行一次

</pre>

<pre class="example">
命令后面加上 &gt;/dev/null 2&gt;&amp;1  ,标准错误重定向到标准输出

</pre>
</div>
</div>

<div id="outline-container-org6f45065" class="outline-4">
<h4 id="org6f45065"><span class="section-number-4">5.2.4</span> 实例1：实现两个周备份一次 /var/ftp 目录下的内容</h4>
<div class="outline-text-4" id="text-5-2-4">
<pre class="example">
具体实现方法如下:
   a.先新建一个 txt 文件，这里是 ftp-back-shell.txt，文件内容：
* * 14 * * cd /back/ftp-back/ &amp;&amp; rsync -avzc /var/ftp ./

   b.将 ftp-back.txt 文件放到 /opt/ftp-back/ 目录下 

   c.运行：
        $ crontab /opt/ftp-back/ftp-back.txt
        $ crontab -l

   d.需要进行重启，配置文件生效： sudo systemctl restart crond.service

</pre>
</div>
</div>
<div id="outline-container-org538f732" class="outline-4">
<h4 id="org538f732"><span class="section-number-4">5.2.5</span> 实例2：实现定时插入数据</h4>
<div class="outline-text-4" id="text-5-2-5">
<pre class="example">
1.新建 crontab.sh 脚本文件
$ vim crontab.sh

</pre>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">sh</span>
/usr/bin/php /home/zrg/.crontab/crontab.php
</pre>
</div>
<pre class="example">
2.编辑 php 文件

3.设置定时任务
$ crontab -e
   */2 * * * * /bin/bash /home/zrg/.crontab/crontab.sh

4.查看定时任务
$ crontab -l
重启服务使生效：sudo systemctl restart cron.service

5.移除定时服务
$ crontab -r

</pre>
</div>
</div>
<div id="outline-container-org630ed38" class="outline-4">
<h4 id="org630ed38"><span class="section-number-4">5.2.6</span> 示例3：备份 mysql 数据</h4>
<div class="outline-text-4" id="text-5-2-6">
<pre class="example">
$ vim cron.sh

</pre>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">sh</span>
<span style="color: #a0522d;">filename</span>=<span style="color: #ff00ff;">`date +%Y%m%d%H%M%S`</span>
mysqldump -u root -proot testdb&gt;/home/zrg/crontab/$<span style="color: #a0522d;">filename</span>.sql
</pre>
</div>
<pre class="example">
$ crontab -e
0 2 * * *  /bin/bash /home/zrg/crontab/cron.sh
$rccron reload

</pre>
</div>
</div>
<div id="outline-container-org44ed683" class="outline-4">
<h4 id="org44ed683"><span class="section-number-4">5.2.7</span> 一些简单示例</h4>
<div class="outline-text-4" id="text-5-2-7">
<pre class="example">
43 21 * * * 21:43 执行

0 17 * * 1 每周一的 17:00 执行
0,10 17 * * 0,2,3 每周日,周二,周三的 17:00和 17:10 执行
0-10 17 1 * * 毎月1日从 17:00到17:10 毎隔1分钟 执行

*/10 * * * * 　　　　　　 每隔10分 执行
0,10,20,30,40,50 * * * *　每隔10分 执行

2 8-20/3 * * *　　　　　　8:02,11:02,14:02,17:02,20:02 执行

</pre>
</div>
</div>
</div>
<div id="outline-container-org6fae1b8" class="outline-3">
<h3 id="org6fae1b8"><span class="section-number-3">5.3</span> 软件安装</h3>
<div class="outline-text-3" id="text-5-3">
</div>
<div id="outline-container-org63f90a6" class="outline-4">
<h4 id="org63f90a6"><span class="section-number-4">5.3.1</span> ssh</h4>
<div class="outline-text-4" id="text-5-3-1">
</div>
<ol class="org-ol">
<li><a id="org5d65c92"></a>SSH &amp; OpenSSH &amp; SSL &amp; OpenSSL<br />
<div class="outline-text-5" id="text-5-3-1-1">
<ul class="org-ul">
<li>SSL(Secure Sockets Layer)，是网络通信提供安全及数据完整性的一种安全协议，它涉及所有TC/IP应用程序。SSL协议使用通讯双方的客户证书以及CA根证书，允许客户/服务器应用以一种不能被偷听的方式通讯，在通讯双方间建立起了一条安全的、可信任的通讯通道。它具备以下基本特征：信息保密性、信息完整性、相互鉴定。 主要用于提高应用程序之间数据的安全系数。</li>
<li>OpenSSL，对SSL的实现。</li>
<li>SSH(Secure Shell)，意为“安全外壳协议”，是一种可以为远程登录提供安全保障的协议。使用SSH，可以把所有传输的数据进行加密，“中间人”攻击方式就不可能实现，能防止DNS欺骗和IP欺骗。</li>
<li>OpenSSH，对SSH的实现。依赖于OpenSSL，没有OpenSSL的话OpenSSH就编译不过去，也运行不了。</li>
<li>HTTPS(Hypertext Transfer Protocol Secure，超文本传输安全协议)，是一种透过计算器网上进行安全通信的传输协议。HTTPS经由HTTP进行通信，但利用SSL/TLS来加密数据包。HTTPS开发的主要目的，是提供对网站服务器的身份认证，保护交换数据的隐私与完整性。</li>
</ul>
</div>
</li>
<li><a id="orga8867dd"></a>ssh 配置<br />
<div class="outline-text-5" id="text-5-3-1-2">
<p>
<b>配置持久连接</b>
</p>
<pre class="example">
1. 服务端
$ sudo vim /etc/ssh/sshd_config

</pre>
<div class="org-src-container">
<pre class="src src-shell" id="orgf59053a"><span style="color: #b22222;">#</span><span style="color: #b22222;">server&#27599;&#38548;60&#31186;&#21457;&#36865;&#19968;&#27425;&#35831;&#27714;&#32473;client&#65292;&#28982;&#21518;client&#21709;&#24212;&#65292;&#20174;&#32780;&#20445;&#25345;&#36830;&#25509;</span>
ClientAliveInterval 60  
<span style="color: #b22222;">#</span><span style="color: #b22222;">server&#21457;&#20986;&#35831;&#27714;&#21518;&#65292;&#23458;&#25143;&#31471;&#27809;&#26377;&#21709;&#24212;&#24471;&#27425;&#25968;&#36798;&#21040;3&#65292;&#23601;&#33258;&#21160;&#26029;&#24320;&#36830;&#25509;&#65292;&#27491;&#24120;&#24773;&#20917;&#19979;&#65292;client&#19981;&#20250;&#19981;&#21709;&#24212;&#12290;</span>
ClientAliveCountMax 3
</pre>
</div>

<pre class="example">
// 2. 客户端
$ sudo vim /etc/ssh/ssh_config

</pre>
<div class="org-src-container">
<pre class="src src-shell" id="orgd2ddb6a"><span style="color: #b22222;">#</span><span style="color: #b22222;">server&#27599;&#38548;60&#31186;&#21457;&#36865;&#19968;&#27425;&#35831;&#27714;&#32473;client&#65292;&#28982;&#21518;client&#21709;&#24212;&#65292;&#20174;&#32780;&#20445;&#25345;&#36830;&#25509;</span>
ServerAliveInterval 60  
<span style="color: #b22222;">#</span><span style="color: #b22222;">server&#21457;&#20986;&#35831;&#27714;&#21518;&#65292;&#23458;&#25143;&#31471;&#27809;&#26377;&#21709;&#24212;&#24471;&#27425;&#25968;&#36798;&#21040;3&#65292;&#23601;&#33258;&#21160;&#26029;&#24320;&#36830;&#25509;&#65292;&#27491;&#24120;&#24773;&#20917;&#19979;&#65292;client&#19981;&#20250;&#19981;&#21709;&#24212;&#12290;</span>
ServerAliveCountMax 3
</pre>
</div>
</div>
</li>
<li><a id="orge83a5b5"></a>使用OpenSSL生成密钥对<br />
<div class="outline-text-5" id="text-5-3-1-3">
<pre class="example">
生成私钥
$ openssl genrsa -out rsa_private_key.pem 1024
参数:genrsa 生成密钥   -out 输出到文件  rsa_private_key.pem 文件名  1024 长度

</pre>

<pre class="example">
从私钥中提取公钥
$ openssl rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem
参数: rsa 提取公钥  -in 从文件中读入  rsa_private_key.pem 文件名   -pubout  输出   -out 到文件  rsa_public_key.pem  文件名

</pre>
</div>
</li>
<li><a id="orge557385"></a>修改ssh默认端口号<br />
<div class="outline-text-5" id="text-5-3-1-4">
<pre class="example">
1. 首先修改配置文件：
$ vim /etc/ssh/sshd_config

</pre>
<p>
Port 22 Port 6666
</p>
<pre class="example">
注意：

</pre>
<ul class="org-ul">
<li>这里添加6666端口，测试成功连接后，再去除22端口配置。这样可以避免修改不成功无法正常登录。</li>
<li>所修改的端口需要事先查明未被其他服务占用，以免造成不可估计的后果！</li>
</ul>

<pre class="example">
3. 重启ssh和防火墙
$ systemctl restart iptables
$ systemctl restart sshd

</pre>

<pre class="example">
4. 假如要限制SSH登陆的IP，那么可以如下做：
先：修改/etc/hosts.deny，在其中加入sshd:ALL
然后：修改：/etc/hosts.allow，在其中进行如下设置：sshd:192.168.1.1：deny  （192.168.1.*）
这样就可以限制只有192.168.1.1的IP通过SSH登陆上LINUX机器了。

</pre>
</div>
</li>
<li><a id="org6e2579a"></a>通过密钥登录服务器<br />
<div class="outline-text-5" id="text-5-3-1-5">
<pre class="example">
1. 生成密钥对
$ ssh-keygen

</pre>
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orgc652cf4">Generating public/private rsa key pair.
Enter file in which to save the key (/home/zrg/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/zrg/.ssh/id_rsa.
Your public key has been saved in /home/zrg/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:OEEJVicOORWU5awcPz7oYPtldQwQXdwuPFyUcVY0umU zrg@DESKTOP-5IIDIKQ
The key's randomart image is:
+---[RSA 2048]----+
|    +*B==o o.oo=*|
|   .o+o= .. . =o.|
|     .+ o .o + E |
|     . *   o= =  |
|      = S . o+   |
|       + o .     |
|    o . =        |
|   . + o .       |
|    ..o          |
+----[SHA256]-----+
</pre>
</div>

<pre class="example">
2. 在服务器上配置上公钥
$ cat ~/.ssh/id_rsa.pub &gt;&gt; authorized_keys
$ chmod 600 ~/.ssh/authorized_keys
$ chmod 700 ~/.ssh

</pre>

<pre class="example">
3. 配置ssh，打开密钥登录功能
$ vim /etc/ssh/sshd_config

</pre>
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="orga0b8858">RSAAuthentication yes
PubkeyAuthentication yes
PermitRootLogin yes //root &#29992;&#25143;&#33021;&#21542;&#36890;&#36807; SSH &#30331;&#24405;
PasswordAuthentication no //&#24403;&#23436;&#25104;&#20840;&#37096;&#35774;&#32622;&#65292;&#20197;&#23494;&#38053;&#26041;&#24335;&#30331;&#24405;&#25104;&#21151;&#21518;&#65292;&#21487;&#20197;&#31105;&#29992;&#23494;&#30721;&#30331;&#24405;&#65306;
</pre>
</div>

<pre class="example">
4. 重启ssh服务
$ systemctl restart sshd.service

</pre>
</div>
</li>
<li><a id="orgea28dbc"></a>使用scp上传或下载文件<br />
<div class="outline-text-5" id="text-5-3-1-6">
<pre class="example">
1. 从服务器上下载文件
scp username@servername:/path/filename /var/www/local_dir（本地目录）
示例：scp root@192.168.0.101:/var/www/test.txt  把 192.168.0.101 上的 /var/www/test.txt 的文件下载到 /var/www/local_dir（本地目录）

</pre>

<pre class="example">
2. 上传本地文件到服务器
scp /path/filename username@servername:/path   
例如 scp /var/www/test.php  root@192.168.0.101:/var/www/  把本机 /var/www/ 目录下的 test.php 文件上传到 192.168.0.101 这台服务器上的 /var/www/ 目录中

</pre>

<pre class="example">
3. 从服务器下载整个目录
scp -r username@servername:/var/www/remote_dir/（远程目录） /var/www/local_dir（本地目录）
例如：scp -r root@192.168.0.101:/var/www/test  /var/www/  
4. 上传目录到服务器
scp  -r local_dir username@servername:remote_dir
例如：scp -r test  root@192.168.0.101:/var/www/ 把当前目录下的test目录上传到服务器的 /var/www/ 目录

</pre>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgbeaf1fe" class="outline-4">
<h4 id="orgbeaf1fe"><span class="section-number-4">5.3.2</span> 在服务器上启用HTTPS</h4>
<div class="outline-text-4" id="text-5-3-2">
<ul class="org-ul">
<li>创建一个 2048 位 RSA 公钥/私钥对。</li>
<li>生成一个嵌入您的公钥的证书签名请求 (CSR)</li>
<li>将 CSR 与证书颁发机构 (CA) 共享以接收最终证书或证书链。</li>
<li>将最终证书安装在非网络可访问的位置，例如 /etc/ssl（Linux 和 Unix）或 IIS 需要它的位置 (Windows)。</li>
</ul>
<pre class="example">
1. 生成密钥和证书签名请求
此部分使用 openssl 命令行程序（大部分 Linux、BSD 和 Mac OS X 系统均附带此程序）来生成私钥/公钥和 CSR。


</pre>

<pre class="example">
参考资料：

</pre>
<p>
<a href="https://developers.google.com/web/fundamentals/security/encrypt-in-transit/enable-https?hl=zh-cn">在服务器上启用 HTTPS</a>
</p>
</div>
</div>
<div id="outline-container-org0fae4fa" class="outline-4">
<h4 id="org0fae4fa"><span class="section-number-4">5.3.3</span> iptables &amp; firewalld</h4>
<div class="outline-text-4" id="text-5-3-3">
</div>
<ol class="org-ol">
<li><a id="org63c361c"></a>防火墙管理工具<br />
<div class="outline-text-5" id="text-5-3-3-1">
<pre class="example">
众所周知，企业内网和外部公网相比，外部的公网环境更加恶劣，罪恶丛生。
在公网与企业内网之间充当保护屏障的防火墙（见下图所示）虽然有软件或硬件之分，但主要功能都是依据策略对穿越防火墙自身的流量进行过滤。
防火墙策略可以基于流量的源地址、端口号、协议、应用等信息来定制，然后防火墙使用预先定制的策略规则监控出入的流量，若流量与某一条策略
规则相匹配，则执行相应的处理，反之则丢弃。这样一来，就可以保证仅有合法的流量在企业内网和外部公网之间流动了。

</pre>

<pre class="example">
目前在RHEL 7系统中，firewalld防火墙取代了iptables防火墙。其实，iptables与firewalld都不是真正的防火墙，它们都只是用来定义防火墙策略
的防火墙管理工具而已，或者说，它们只是一种服务。与 Linux 内核集成的 IP 信息包过滤系统。防火墙在做数据包过滤决定时，有一套遵循和组
成的规则，这些规则存储在专用的数据包过滤表中，而这些表集成在 Linux 内核中。

</pre>

<pre class="example">
iptables服务会把配置好的防火墙策略交由内核层面的netfilter网络过滤器来处理，而firewalld服务则是把配置好的防火墙策略交由内核层面的
nftables包过滤框架来处理。换句话说，当前在Linux系统中其实存在多个防火墙管理工具，旨在方便运维人员管理Linux系统中的防火墙策略，我
们只需要配置妥当其中的一个就足够了。虽然这些工具各有优劣，但它们在防火墙策略的配置思路上是保持一致的。

</pre>

<pre class="example">
netfilter 组件也称为内核空间（kernelspace），是内核的一部分，由一些信息包过滤表组成，这些表包含内核用来控制信息包过滤处理的规则集。
iptables 组件是一种工具，也称为用户空间（userspace），它使插入、修改和除去信息包过滤表中的规则变得容易。

</pre>
</div>
</li>
<li><a id="orgf5cc3a3"></a>iptables<br />
<div class="outline-text-5" id="text-5-3-3-2">
<pre class="example">
在早期的Linux系统中，默认使用的是iptables防火墙管理服务来配置防火墙。尽管新型的firewalld防火墙管理服务已经被投入使用多年，但是大量的企业在生产环境中依然出于
各种原因而继续使用iptables。

</pre>
</div>
<ol class="org-ol">
<li><a id="org0706ac7"></a>策略与规则链<br />
<div class="outline-text-6" id="text-5-3-3-2-1">
<pre class="example">
防火墙会从上至下的顺序来读取配置的策略规则，在找到匹配项后就立即结束匹配工作并去执行匹配项中定义的行为（即放行或阻止）。如果在读取完所有的策略规则
之后没有匹配项，就去执行默认的策略。防火墙策略规则的设置有两种：一种是“通”（即放行），一种是“堵”（即阻止）。

</pre>

<pre class="example">
iptables服务把用于处理或过滤流量的策略条目称之为规则，多条规则可以组成一个规则链，而规则链则依据数据包处理位置的不同进行分类，具体如下：

</pre>
<ul class="org-ul">
<li>在进行路由选择前处理数据包（PREROUTING）；</li>
<li>处理流入的数据包（INPUT）；</li>
<li>处理流出的数据包（OUTPUT）；</li>
<li>处理转发的数据包（FORWARD）；</li>
<li>在进行路由选择后处理数据包（POSTROUTING）。</li>
</ul>

<pre class="example">
一般来说，从内网向外网发送的流量一般都是可控且良性的，因此我们使用最多的就是INPUT规则链，该规则链可以增大黑客人员从外网入侵内网的难度。

</pre>

<pre class="example">
iptables 服务的术语:ACCEPT（允许流量通过）、REJECT（拒绝流量通过，拒绝流量后再回复一条"您的信息已经收到，但是被扔掉了"）、LOG（记录日志信息）、
DROP（拒绝流量通过，直接将流量丢弃不响应）。
当把Linux系统中的防火墙策略设置为REJECT拒绝动作后，流量发送方会看到端口不可达的响应：
把Linux系统中的防火墙策略修改成DROP拒绝动作后，流量发送方会看到响应超时的提醒。但是流量发送方无法判断流量是被拒绝，还是接收方主机当前不在线

</pre>
</div>
</li>

<li><a id="orge7b58d9"></a>基本的命令参数<br />
<div class="outline-text-6" id="text-5-3-3-2-2">
<ul class="org-ul">
<li><p>
规则功能说明
</p>
<pre class="example">
1. 

</pre>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 12:</span> 表</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">filter</td>
<td class="org-left">主要和主机自身有关，主要负责防火墙功能 过滤本机流入流出的数据包是默认使用的表</td>
</tr>

<tr>
<td class="org-left">input</td>
<td class="org-left">负责过滤所有目标地址是本机地址的数据包，就是过滤进入主机的数据包</td>
</tr>

<tr>
<td class="org-left">forward</td>
<td class="org-left">负责转发流经主机但不进入本机的数据包，和NAT关系很大</td>
</tr>

<tr>
<td class="org-left">output</td>
<td class="org-left">负责处理源地址的数据包，就是对本机发出的数据包;</td>
</tr>
</tbody>
</table>
<pre class="example">
2. NAT 表，负责网络地址转换，即来源于目的IP地址和端口的转换，一般用于共享上网或特殊端口的转换服务

</pre>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 13:</span> NAT</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">snat</td>
<td class="org-left">地址转换</td>
</tr>

<tr>
<td class="org-left">dnat</td>
<td class="org-left">标地址转换</td>
</tr>

<tr>
<td class="org-left">pnat</td>
<td class="org-left">标端口转换</td>
</tr>
</tbody>
</table>
<pre class="example">
3. mangle 表
将报文拆开来并修改报文标志位，最后封装起来

</pre>

<pre class="example">
4. 5个检查点（内置链）

</pre>
<ul class="org-ul">
<li>PREROUTING</li>
<li>INPUT</li>
<li>FORWORD</li>
<li>OUTPUT</li>
<li>POSTROUTING</li>
</ul></li>
<li><p>
iptables中常用的参数以及作用
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 14:</span> iptables中常用的参数以及作用</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">参数</th>
<th scope="col" class="org-left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">-P</td>
<td class="org-left">设置默认策略</td>
</tr>

<tr>
<td class="org-left">-F</td>
<td class="org-left">清空规则链</td>
</tr>

<tr>
<td class="org-left">-L</td>
<td class="org-left">查看规则链</td>
</tr>

<tr>
<td class="org-left">-A</td>
<td class="org-left">在规则链的末尾加入新规则</td>
</tr>

<tr>
<td class="org-left">-I num</td>
<td class="org-left">在规则链的头部加入新规则</td>
</tr>

<tr>
<td class="org-left">-D num</td>
<td class="org-left">删除某一条规则</td>
</tr>

<tr>
<td class="org-left">-s</td>
<td class="org-left">匹配来源地址IP/MASK，加叹号“!”表示除这个IP外</td>
</tr>

<tr>
<td class="org-left">-d</td>
<td class="org-left">匹配目标地址</td>
</tr>

<tr>
<td class="org-left">-i 网卡名称</td>
<td class="org-left">匹配从这块网卡流入的数据</td>
</tr>

<tr>
<td class="org-left">-o 网卡名称</td>
<td class="org-left">匹配从这块网卡流出的数据</td>
</tr>

<tr>
<td class="org-left">-p</td>
<td class="org-left">匹配协议，如TCP、UDP、ICMP</td>
</tr>

<tr>
<td class="org-left">&#x2013;dport num</td>
<td class="org-left">匹配目标端口号</td>
</tr>

<tr>
<td class="org-left">&#x2013;sport num</td>
<td class="org-left">匹配来源端口号</td>
</tr>
</tbody>
</table></li>
<li><p>
查看已有的防火墙规则链
</p>
<pre class="example">
$ iptables -L
$ iptables -nvL –line-number
-L 查看当前表的所有规则，默认查看的是filter表，如果要查看NAT表，可以加上-t NAT参数
-n 不对ip地址进行反查，加上这个参数显示速度会快很多
-v 输出详细信息，包含通过该规则的数据包数量，总字节数及相应的网络接口
–line-number 显示规则的序列号，这个参数在删除或修改规则时会用到

</pre></li>
<li><p>
清空已有的防火墙规则链
</p>
<pre class="example">
$ iptables -F

</pre></li>
<li>添加规则
<ul class="org-ul">
<li><p>
把INPUT规则链的默认策略设置为拒绝
</p>
<pre class="example">
$ iptables -P INPUT DROP
规则链的默认策略拒绝动作只能是DROP，而不能是REJECT。

</pre></li>
<li><p>
向INPUT链中添加允许ICMP流量进入的策略规则
</p>
<pre class="example">
$ iptables -I INPUT -p icmp -j ACCEPT
在日常运维工作中，经常会使用ping命令来检查对方主机是否在线，而向防火墙的INPUT规则链中添加一条允许ICMP流量进入的策略规则就默认允许了
这种ping命令检测行为。

</pre></li>
<li><p>
删除INPUT规则链中刚刚加入的那条策略（允许ICMP流量），并把默认策略设置为允许
</p>
<pre class="example">
$ iptables -D INPUT 1
$ iptables -P INPUT ACCEPT

</pre></li>
<li><p>
将INPUT规则链设置为只允许指定网段的主机访问本机的22端口，拒绝来自其他所有主机的流量
</p>
<pre class="example">
$ iptables -I INPUT -s 192.168.10.0/24 -p tcp --dport 22 -j ACCEPT
$ iptables -A INPUT -p tcp --dport 22 -j REJECT

</pre></li>
<li><p>
向INPUT规则链中添加拒绝所有人访问本机12345端口的策略规则
</p>
<pre class="example">
$ iptables -I INPUT -p tcp --dport 12345 -j REJECT
$ iptables -I INPUT -p udp --dport 12345 -j REJECT

</pre></li>
<li><p>
向INPUT规则链中添加拒绝192.168.10.5主机访问本机80端口（Web服务）的策略规则
</p>
<pre class="example">
$ iptables -I INPUT -p tcp -s 192.168.10.5 --dport 80 -j REJECT

</pre></li>
<li><p>
向INPUT规则链中添加拒绝所有主机访问本机1000～1024端口的策略规则
</p>
<pre class="example">
$ iptables -A INPUT -p tcp --dport 1000:1024 -j REJECT
$ iptables -A INPUT -p udp --dport 1000:1024 -j REJECT

</pre></li>
<li><p>
保存防火墙策略命令，使其永久生效
</p>
<pre class="example">
$ service iptables save

</pre></li>
</ul></li>
</ul>
</div>
</li>
</ol>
</li>
<li><a id="orgec0a218"></a>Firewalld<br />
<div class="outline-text-5" id="text-5-3-3-3">
<pre class="example">
Firewalld(Dynamic Firewall Manager of Linux systems, Linux系统的动态防火墙管理器)，服务是默认的防火墙配置管理工具，它拥有基于CLI（命令行界面）
和基于GUI（图形用户界面）的两种管理方式。

</pre>

<pre class="example">
相较于传统的防火墙管理配置工具，firewalld支持动态更新技术并加入了区域（zone）的概念。简单来说，区域就是firewalld预先准备了几套防火墙策略集合（
策略模板），用户可以根据生产场景的不同而选择合适的策略集合，从而实现防火墙策略之间的快速切换。

</pre>

<pre class="example">
firewalld中常见的区域名称（默认为public）以及相应的策略规则如下表所示。

</pre>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 15:</span> firewalld中常用的区域名称及策略规则</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">区域</th>
<th scope="col" class="org-left">默认规则策略</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">trusted</td>
<td class="org-left">允许所有的数据包</td>
</tr>

<tr>
<td class="org-left">home</td>
<td class="org-left">拒绝流入的流量，除非与流出的流量相关；而如果流量与ssh、mdns、ipp-client、amba-client与dhcpv6-client服务相关，则允许流量</td>
</tr>

<tr>
<td class="org-left">internal</td>
<td class="org-left">等同于home区域</td>
</tr>

<tr>
<td class="org-left">work</td>
<td class="org-left">拒绝流入的流量，除非与流出的流量相关；而如果流量与ssh、ipp-client与dhcpv6-client服务相关，则允许流量</td>
</tr>

<tr>
<td class="org-left">public</td>
<td class="org-left">拒绝流入的流量，除非与流出的流量相关；而如果流量与ssh、dhcpv6-client服务相关，则允许流量</td>
</tr>

<tr>
<td class="org-left">external</td>
<td class="org-left">拒绝流入的流量，除非与流出的流量相关；而如果流量与ssh服务相关，则允许流量</td>
</tr>

<tr>
<td class="org-left">dmz</td>
<td class="org-left">拒绝流入的流量，除非与流出的流量相关；而如果流量与ssh服务相关，则允许流量</td>
</tr>

<tr>
<td class="org-left">block</td>
<td class="org-left">拒绝流入的流量，除非与流出的流量相关</td>
</tr>

<tr>
<td class="org-left">drop</td>
<td class="org-left">拒绝流入的流量，除非与流出的流量相关</td>
</tr>
</tbody>
</table>
</div>
<ol class="org-ol">
<li><a id="org22473ea"></a>终端管理工具<br />
<div class="outline-text-6" id="text-5-3-3-3-1">
<pre class="example">
firewall-cmd是firewalld防火墙配置管理工具的CLI（命令行界面）版本

</pre>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 16:</span> firewall-cmd命令中使用的参数以及作用</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">参数</th>
<th scope="col" class="org-left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">&#x2013;get-default-zone</td>
<td class="org-left">查询默认的区域名称</td>
</tr>

<tr>
<td class="org-left">&#x2013;set-default-zone=&lt;区域名称&gt;</td>
<td class="org-left">设置默认的区域，使其永久生效</td>
</tr>

<tr>
<td class="org-left">&#x2013;get-zones</td>
<td class="org-left">显示可用的区域</td>
</tr>

<tr>
<td class="org-left">&#x2013;get-services</td>
<td class="org-left">显示预先定义的服务</td>
</tr>

<tr>
<td class="org-left">&#x2013;get-active-zones</td>
<td class="org-left">显示当前正在使用的区域与网卡名称</td>
</tr>

<tr>
<td class="org-left">&#x2013;add-source=</td>
<td class="org-left">将源自此IP或子网的流量导向指定的区域</td>
</tr>

<tr>
<td class="org-left">&#x2013;remove-source=</td>
<td class="org-left">不再将源自此IP或子网的流量导向某个指定区域</td>
</tr>

<tr>
<td class="org-left">&#x2013;add-interface=&lt;网卡名称&gt;</td>
<td class="org-left">将源自该网卡的所有流量都导向某个指定区域</td>
</tr>

<tr>
<td class="org-left">&#x2013;change-interface=&lt;网卡名称&gt;</td>
<td class="org-left">将某个网卡与区域进行关联</td>
</tr>

<tr>
<td class="org-left">&#x2013;list-all</td>
<td class="org-left">显示当前区域的网卡配置参数、资源、端口以及服务等信息</td>
</tr>

<tr>
<td class="org-left">&#x2013;list-all-zones</td>
<td class="org-left">显示所有区域的网卡配置参数、资源、端口以及服务等信息</td>
</tr>

<tr>
<td class="org-left">&#x2013;add-service=&lt;服务名&gt;</td>
<td class="org-left">设置默认区域允许该服务的流量</td>
</tr>

<tr>
<td class="org-left">&#x2013;add-port=&lt;端口号/协议&gt;</td>
<td class="org-left">设置默认区域允许该端口的流量</td>
</tr>

<tr>
<td class="org-left">&#x2013;remove-service=&lt;服务名&gt;</td>
<td class="org-left">设置默认区域不再允许该服务的流量</td>
</tr>

<tr>
<td class="org-left">&#x2013;remove-port=&lt;端口号/协议&gt;</td>
<td class="org-left">设置默认区域不再允许该端口的流量</td>
</tr>

<tr>
<td class="org-left">&#x2013;reload</td>
<td class="org-left">让“永久生效”的配置规则立即生效，并覆盖当前的配置规则</td>
</tr>

<tr>
<td class="org-left">&#x2013;panic-on</td>
<td class="org-left">开启应急状况模式</td>
</tr>

<tr>
<td class="org-left">&#x2013;panic-off</td>
<td class="org-left">关闭应急状况模式</td>
</tr>
</tbody>
</table>

<pre class="example">
使用firewalld配置的防火墙策略默认为运行时（Runtime）模式，又称为当前生效模式，而且随着系统的重启会失效。如果想让配置策略一直存在，
就需要使用永久（Permanent）模式了，方法就是在用firewall-cmd命令正常设置防火墙策略时添加--permanent参数，这样配置的防火墙策略就可以
永久生效了。但是，永久生效模式有一个“不近人情”的特点，就是使用它设置的策略只有在系统重启之后才能自动生效。如果想让配置的策略立即
生效，需要手动执行firewall-cmd --reload命令。

</pre>
<ul class="org-ul">
<li>使用示例
<ul class="org-ul">
<li><p>
查看firewalld服务当前所使用的区域
</p>
<pre class="example">
# firewall-cmd --get-default-zone

</pre></li>
<li><p>
查询eno16777728网卡在firewalld服务中的区域
</p>
<pre class="example">
# firewall-cmd --get-zone-of-interface=eno16777728

</pre></li>
<li><p>
把firewalld服务中eno16777728网卡的默认区域修改为external，并在系统重启后生效。分别查看当前与永久模式下的区域名称
</p>
<pre class="example">
# firewall-cmd --permanent --zone=external --change-interface=eno16777728
# firewall-cmd --get-zone-of-interface=eno16777728
# firewall-cmd --permanent --get-zone-of-interface=eno16777728

</pre></li>
<li><p>
把firewalld服务的当前默认区域设置为public
</p>
<pre class="example">
# firewall-cmd --set-default-zone=public
# firewall-cmd --get-default-zone

</pre></li>
<li><p>
启动/关闭firewalld防火墙服务的应急状况模式，阻断一切网络连接（当远程控制服务器时请慎用）
</p>
<pre class="example">
# firewall-cmd --panic-on
# firewall-cmd --panic-off

</pre></li>
<li><p>
查询public区域是否允许请求SSH和HTTPS协议的流量
</p>
<pre class="example">
# firewall-cmd --zone=public --query-service=ssh
# firewall-cmd --zone=public --query-service=https

</pre></li>
<li><p>
把firewalld服务中请求HTTPS协议的流量设置为永久允许，并立即生效
</p>
<pre class="example">
# firewall-cmd --zone=public --add-service=https
# firewall-cmd --permanent --zone=public --add-service=https
# firewall-cmd --reload

</pre></li>
<li><p>
把firewalld服务中请求HTTP协议的流量设置为永久拒绝，并立即生效：
</p>
<pre class="example">
# firewall-cmd --permanent --zone=public --remove-service=http
# firewall-cmd --reload 

</pre></li>
<li><p>
把在firewalld服务中访问8080和8081端口的流量策略设置为允许，但仅限当前生效
</p>
<pre class="example">
# firewall-cmd --zone=public --add-port=8080-8081/tcp
# firewall-cmd --zone=public --list-ports

</pre></li>
<li><p>
把原本访问本机888端口的流量转发到22端口，要且求当前和长期均有效
</p>
<pre class="example">
流量转发命令格式为:
# firewall-cmd --permanent --zone=&lt;区域&gt; --add-forward-port=port=&lt;源端口号&gt;:proto=&lt;协议&gt;:toport=&lt;目标端口号&gt;:toaddr=&lt;目标IP地址&gt;

</pre>

<pre class="example">
# firewall-cmd --permanent --zone=public --add-forward-port=port=888:proto=tcp:toport=22:toaddr=192.168.10.10
# firewall-cmd --reload

</pre></li>
<li><p>
firewalld中的富规则表示更细致、更详细的防火墙策略配置，它可以针对系统服务、端口号、源地址和目标地址等诸多信息进行更有针对性的策略配置。它的优先级在所有的防火墙策略中也是最高的。比如，我们可以在firewalld服务中配置一条富规则，使其拒绝192.168.10.0/24网段的所有用户访问本机的ssh服务（22端口）：
</p>
<pre class="example">
# firewall-cmd --permanent --zone=public --add-rich-rule="rule family="ipv4" source address="192.168.10.0/24" service name="ssh" reject"

</pre></li>
</ul></li>
</ul>
</div>
</li>
<li><a id="org0048efc"></a>图形化管理工具<br /></li>
<li><a id="org2edea9d"></a>服务的访问控制列表<br />
<div class="outline-text-6" id="text-5-3-3-3-3">
<pre class="example">
TCP Wrappers是RHEL 7系统中默认启用的一款流量监控程序，它能够根据来访主机的地址与本机的目标服务程序作出允许或拒绝的操作。换句话说，
Linux系统中其实有两个层面的防火墙，第一种是前面讲到的基于TCP/IP协议的流量过滤工具，而TCP Wrappers服务则是能允许或禁止Linux系统提供
服务的防火墙，从而在更高层面保护了Linux系统的安全运行。

</pre>

<pre class="example">
TCP Wrappers服务的防火墙策略由两个控制列表文件所控制。系统将会先检查允许控制列表文件（/etc/hosts.allow），如果匹配到相应的允许策略
则放行流量；如果没有匹配，则去进一步匹配拒绝控制列表文件（/etc/hosts.deny），若找到匹配项则拒绝该流量。如果这两个文件全都没有匹配到，
则默认放行流量。

</pre>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 17:</span> TCP Wrappers服务的控制列表文件中常用的参数</caption>

<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">客户端类型</th>
<th scope="col" class="org-left">示例</th>
<th scope="col" class="org-left">满足示例的客户端列表</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">单一主机</td>
<td class="org-left">192.168.10.10</td>
<td class="org-left">IP地址为192.168.10.10的主机</td>
</tr>

<tr>
<td class="org-left">指定网段</td>
<td class="org-left">192.168.10.</td>
<td class="org-left">IP段为192.168.10.0/24的主机</td>
</tr>

<tr>
<td class="org-left">指定网段</td>
<td class="org-left">192.168.10.0/255.255.255.0</td>
<td class="org-left">IP段为192.168.10.0/24的主机</td>
</tr>

<tr>
<td class="org-left">指定DNS后缀</td>
<td class="org-left">.linuxprobe.com</td>
<td class="org-left">所有DNS后缀为.linuxprobe.com的主机</td>
</tr>

<tr>
<td class="org-left">指定主机名称</td>
<td class="org-left">www.linuxprobe.com</td>
<td class="org-left">主机名称为www.linuxprobe.com的主机</td>
</tr>

<tr>
<td class="org-left">指定所有客户端</td>
<td class="org-left">ALL</td>
<td class="org-left">所有主机全部包括在内</td>
</tr>
</tbody>
</table>

<pre class="example">
在配置TCP Wrappers服务时需要遵循两个原则：

</pre>
<ol class="org-ol">
<li>编写拒绝策略规则时，填写的是服务名称，而非协议名称；</li>
<li>建议先编写拒绝策略规则，再编写允许策略规则，以便直观地看到相应的效果。</li>
</ol>
</div>
</li>
</ol>
</li>
<li><a id="orgeaf48dd"></a>参考资料<br />
<div class="outline-text-5" id="text-5-3-3-4">
<ul class="org-ul">
<li><a href="https://en.wikipedia.org/wiki/Iptables">iptables wiki</a></li>
<li><a href="https://baike.baidu.com/item/IPTABLES/9139339?fr=aladdin">iptables 百度百科</a></li>
<li><a href="https://wiki.debian.org/iptables">iptables debian wiki</a></li>
</ul>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgb4a0310" class="outline-4">
<h4 id="orgb4a0310"><span class="section-number-4">5.3.4</span> 删除大文件的前n行</h4>
<div class="outline-text-4" id="text-5-3-4">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 2: </span>示例：删除前10行</label><pre class="src src-shell">tail -n +10 old_file&gt;new_file
mv new_file old_file
</pre>
</div>
</div>
</div>
<div id="outline-container-org1c80762" class="outline-4">
<h4 id="org1c80762"><span class="section-number-4">5.3.5</span> 神奇的 nc 命令</h4>
<div class="outline-text-4" id="text-5-3-5">
</div>
<ol class="org-ol">
<li><a id="org993dbb0"></a>介绍<br />
<div class="outline-text-5" id="text-5-3-5-1">
<pre class="example">
netcat是网络工具中的瑞士军刀，它能通过TCP和UDP在网络中读写数据。通过与其他工具结合和重定向。
netcat所做的就是在两台电脑之间建立链接并返回两个数据流。你能建立一个服务器，传输文件，与朋友聊天，传输流媒体或者用它作为其它协议的独立客户端。

</pre>
</div>
</li>
<li><a id="orgbd38bd6"></a>安装<br />
<div class="outline-text-5" id="text-5-3-5-2">
<pre class="example">
// Redhat/CentOS/Fedora
$ yum install nc
// Debian/Ubuntu
$ sudo apt-get install netcat

</pre>
</div>
</li>
<li><a id="orgc12c222"></a>常见使用<br />
<ol class="org-ol">
<li><a id="org02b684b"></a>端口扫描<br />
<div class="outline-text-6" id="text-5-3-5-3-1">
<pre class="example">
端口扫描经常被系统管理员和黑客用来发现在一些机器上开放的端口，帮助他们识别系统中的漏洞。
$ nc -z -v -n 172.31.100.7 21-25
可以运行在TCP或者UDP模式，默认是TCP，-u参数调整为udp.
z 参数告诉netcat使用0 IO,连接成功后立即关闭连接， 不进行数据交换(谢谢@jxing 指点)
v 参数指使用冗余选项（译者注：即详细输出）
n 参数告诉netcat 不要使用DNS反向查询IP地址的域名

Banner是一个文本，Banner是一个你连接的服务发送给你的文本信息。
一旦你发现开放的端口，你可以容易的使用netcat 连接服务抓取他们的banner。
$ nc -v 172.31.100.7 21

</pre>
</div>
</li>
<li><a id="org330c14d"></a>聊天工具<br />
<div class="outline-text-6" id="text-5-3-5-3-2">
<pre class="example">
// Server
$ nc -l 1234
// Client
$ nc 172.168.100.7 1234

</pre>
</div>
</li>
<li><a id="org1466a48"></a>文件传输<br />
<div class="outline-text-6" id="text-5-3-5-3-3">
<pre class="example">
// Server &gt; Client
$ nc -l 1234 &gt; file.txt
$ nc 172.168.100.7 1234 &lt;file.txt

</pre>
</div>
</li>
<li><a id="org959e680"></a>目录传输<br />
<div class="outline-text-6" id="text-5-3-5-3-4">
<pre class="example">
// Server &gt; Client
$ tar -cvf - dir_name | nc -l 1234
$ nc -n 172.168.100.7 1234 | tar -xvf -
这里在A服务器上，我们创建一个tar归档包并且通过-在控制台重定向它，然后使用管道，重定向给netcat，netcat可以通过网络发送它。
在客户端我们下载该压缩包通过netcat 管道然后打开文件。
如果想要节省带宽传输压缩包，我们可以使用bzip2或者其他工具压缩。
// Server
$ tar -cvf – dir_name| bzip2 -z | nc -l 1234
// Client
$ nc -n 172.31.100.7 1234 | bzip2 -d |tar -xvf -

</pre>
</div>
</li>
<li><a id="org061867d"></a>加密网络传输数据<br />
<div class="outline-text-6" id="text-5-3-5-3-5">
<pre class="example">
// Server
$ nc localhost 1234 | mcrypt –flush –bare -F -q -d -m ecb &gt; file.txt
// Client
$ mcrypt –flush –bare -F -q -m ecb &lt; file.txt | nc -l 1234

</pre>
</div>
</li>
<li><a id="org6999eb7"></a>流视频<br />
<div class="outline-text-6" id="text-5-3-5-3-6">
<pre class="example">
// Server
$ cat video.avi | nc -l 1234
从一个视频文件中读入并重定向输出到netcat客户端
// Client
$ nc 172.31.100.7 1234 | mplayer -vo x11 -cache 3000 -
从socket中读入数据并重定向到mplayer。

</pre>
</div>
</li>
<li><a id="org8ee9ceb"></a>克隆一个设备<br />
<div class="outline-text-6" id="text-5-3-5-3-7">
<pre class="example">
已经安装配置一台Linux机器并且需要重复同样的操作对其他的机器，而你不想在重复配置一遍。
假如你的系统在磁盘/dev/sda上:
// Server
$ dd if=/dev/sda | nc -l 1234
// Client
$ nc -n 172.31.100.7 1567 | dd of=/dev/sda
dd是一个从磁盘读取原始数据的工具，我通过netcat服务器重定向它的输出流到其他机器并且写入到磁盘中，它会随着分区表拷贝所有的信息。
但是如果我们已经做过分区并且只需要克隆root分区，我们可以根据我们系统root分区的位置，更改sda 为sda1，sda2.等等。

</pre>
</div>
</li>
</ol>
</li>
<li><a id="orgd0a7770"></a>参考资料<br />
<div class="outline-text-5" id="text-5-3-5-4">
<pre class="example">
https://blog.csdn.net/zhangxiao93/article/details/52705642

</pre>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgdccda1e" class="outline-4">
<h4 id="orgdccda1e"><span class="section-number-4">5.3.6</span> 设置命令别名：alias</h4>
<div class="outline-text-4" id="text-5-3-6">
<pre class="example">
//利用别名代替长命令
$ vim ~/.bashrc                                                                                                                                     
//存在这样的三行代码，意思就是检查是否存在 .bash_aliases 文件，存在就加载                 

</pre>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #a020f0;">if</span> [ -f ~/.bash_aliases ]; <span style="color: #a020f0;">then</span>                                                                                                                       
    <span style="color: #483d8b;">.</span> ~/.bash_aliases                                                                                                                                 
<span style="color: #a020f0;">fi</span>                                                                                                                                                    
</pre>
</div>
<pre class="example">
//于是,新建并编辑                                                                                                                                   
$ vim .bash_aliases                                                                                                                                 

</pre>
<div class="org-src-container">
<pre class="src src-emacs-lisp"># shadowsocks                                                                                                                                         
alias shadowsocks=<span style="color: #8b2252;">"sudo sslocal -c /etc/shadowsocks.json -d start"</span>                                                                                    
</pre>
</div>
</div>
</div>
<div id="outline-container-orge41915b" class="outline-4">
<h4 id="orge41915b"><span class="section-number-4">5.3.7</span> GCC</h4>
<div class="outline-text-4" id="text-5-3-7">
</div>
<ol class="org-ol">
<li><a id="orgeafd3e5"></a>简单编译<br />
<div class="outline-text-5" id="text-5-3-7-1">
<pre class="example">
$ gcc test.c -o test
实质上，以上这条命令编译过程分为四个阶段进行的，即预处理（预编译，Preprocessing）、编译（Compilation）、汇编（Assembly）和连接（Linking）。

</pre>

<pre class="example">
1.Preprocessing
$ gcc -E test.c -o test.i
或
$ gcc -E test.c
gcc 的 -E 选项，可以让编译器在预处理后停止，并输出预处理结果。在本例中，预处理结果就是将 stdio.h 文件中的内容插入到 test.c 中了。
2.Compilation
$ gcc -S test.i -o test.s
gcc 的 -S 选项，表示在程序编译期间，在生成汇编代码后，停止，-o 输出汇编代码文件。
3.Assembly
$ gcc -c test.s -o test.o
对于上一小节中生成的汇编代码文件 test.s，gas 汇编器负责将其编译为目标文件
4.Linking
gcc 连接器是 gas 提供的，负责将程序的目标文件与所需的所有附加的目标文件连接起来，最终生成可执行文件。附加的目标文件包括静态连接库和动态连接库。
对于上一小节中生成的 test.o，将其与 Ｃ 标准输入输出库进行连接，最终生成程序 test
$ gcc test.o -o test

</pre>
</div>
</li>
<li><a id="orgc2e98cd"></a>多个程序文件的编译<br />
<div class="outline-text-5" id="text-5-3-7-2">
<pre class="example">
$ gcc test1.c test2.c -o test

</pre>
</div>
</li>
<li><a id="orgd61f78a"></a>检错<br />
<div class="outline-text-5" id="text-5-3-7-3">
<pre class="example">
$ gcc -pedantic test.c -o test
//警告信息
$ gcc -Wall test.c -p test
//-Werror 选项，那么 GCC 会在所有产生警告的地方停止编译，迫使程序员对自己的代码进行修改
$ gcc -Werror test.c -o test

</pre>
</div>
</li>
<li><a id="org05269d9"></a>库文件连接<br />
<div class="outline-text-5" id="text-5-3-7-4">
<pre class="example">
1.编译可执行文件。首先我们要进行编译 test.c 为目标文件，这个时候需要执行
$ gcc  –c –I /usr/dev/mysql/include test.c –o test.o
2.链接。最后我们把所有目标文件链接成可执行文件:
$ gcc –L /usr/dev/mysql/lib –lmysqlclient test.o –o test
3.强制链接时使用静态链接库。默认情况下， GCC 在链接时优先使用动态链接库，只有当动态链接库不存在时才考虑使用静态链接库，如果需要的话可以在编译时加上 -static 选项，强制使用静态链接库。
$ gcc –L /usr/dev/mysql/lib –static –lmysqlclient test.o –o test

</pre>
</div>
</li>
<li><a id="org13b241c"></a>其他<br />
<div class="outline-text-5" id="text-5-3-7-5">
<pre class="example">
静态库链接时搜索路径顺序：

</pre>

<pre class="example">
1. ld 会去找GCC命令中的参数 -L
2. 再找 gcc 的环境变量 LIBRARY_PATH
3. 再找内定目录 /lib /usr/lib /usr/local/lib 这是当初 compile gcc 时写在程序内的

</pre>

<pre class="example">
动态链接时、执行时搜索路径顺序:

</pre>

<pre class="example">
1. 编译目标代码时指定的动态库搜索路径
2. 环境变量 LD_LIBRARY_PATH 指定的动态库搜索路径
3. 配置文件 /etc/ld.so.conf 中指定的动态库搜索路径
4. 默认的动态库搜索路径 /lib
5. 默认的动态库搜索路径 /usr/lib

</pre>

<pre class="example">
有关环境变量：
LIBRARY_PATH 环境变量：指定程序静态链接库文件搜索路径
LD_LIBRARY_PATH 环境变量：指定程序动态链接库文件搜索路径

</pre>
</div>
</li>
<li><a id="org4d2c0f6"></a>Reference<br />
<div class="outline-text-5" id="text-5-3-7-6">
<pre class="example">
http://www.cnblogs.com/ggjucheng/archive/2011/12/14/2287738.html

</pre>
</div>
</li>
</ol>
</div>
<div id="outline-container-org4375bea" class="outline-4">
<h4 id="org4375bea"><span class="section-number-4">5.3.8</span> 系统状态监视命令：top &amp; htop</h4>
<div class="outline-text-4" id="text-5-3-8">
</div>
<ol class="org-ol">
<li><a id="org46d9616"></a>top<br />
<div class="outline-text-5" id="text-5-3-8-1">

<div class="figure">
<p><img src="{{site.url}}/assets/images/top.jpg" alt="top.jpg" />
</p>
</div>
</div>
</li>
<li><a id="orgb03f5bb"></a>htop<br />
<ol class="org-ol">
<li><a id="orgb99bdc1"></a>下载及安装<br />
<div class="outline-text-6" id="text-5-3-8-2-1">
<pre class="example">
$ git clone https://github.com/hishamhm/htop 
$ tar zxvf htop-2.0.2.tar.gz
$ cd htop-2.0.2
$ ./configure
# make &amp;&amp; make install

</pre>
</div>
</li>
<li><a id="org860786c"></a>错误解决<br />
<div class="outline-text-6" id="text-5-3-8-2-2">
<pre class="example">
configure: error: missing libraries: libncurses
Solving:
$ sudo apt-get install nucurses-dev

</pre>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div id="outline-container-orgddaca37" class="outline-4">
<h4 id="orgddaca37"><span class="section-number-4">5.3.9</span> 网络监视命令：iftop</h4>
<div class="outline-text-4" id="text-5-3-9">
<pre class="example">
$ sudo apt-get install iftop


</pre>
</div>
</div>
<div id="outline-container-org3220bb3" class="outline-4">
<h4 id="org3220bb3"><span class="section-number-4">5.3.10</span> wget vs axel</h4>
<div class="outline-text-4" id="text-5-3-10">
<pre class="example">
官方地址: http://axel.alioth.debian.org/
描述: 替换wget命令

</pre>
</div>
</div>
<div id="outline-container-orgf04f847" class="outline-4">
<h4 id="orgf04f847"><span class="section-number-4">5.3.11</span> VIM&amp;Emacs</h4>
<div class="outline-text-4" id="text-5-3-11">
<pre class="example">
两个神器软件单独介绍，这里不重复叙写。

</pre>
</div>
</div>
<div id="outline-container-orgf2c68b6" class="outline-4">
<h4 id="orgf2c68b6"><span class="section-number-4">5.3.12</span> MPlayer</h4>
<div class="outline-text-4" id="text-5-3-12">
<pre class="example">
// official：http://www.mplayerhq.hu/design7/news.html
$ tar -Jxf MPlayer-1.1.1.tar.xz
$ cd MPlayer-1.1.1
$ sudo ./configure
// 发现，需要安装一个依赖包:yasm
$ wget http://www.tortall.net/projects/yasm/releases/yasm-1.2.0.tar.gz
// 安装完成后，重新配置、编译和安装
$ sudo ./configure
$ sudo make &amp;&amp; make install

</pre>
</div>
</div>
<div id="outline-container-orge3612ab" class="outline-4">
<h4 id="orge3612ab"><span class="section-number-4">5.3.13</span> google-chrome &amp; chromium</h4>
<div class="outline-text-4" id="text-5-3-13">
<pre class="example">
1. 添加安装源
$ sudo vim /etc/apt/sources.list
deb http://dl.google.com/linux/chrome/deb/ stable main

</pre>

<pre class="example">
2. 添加公钥验证下载
$ wget https://dl-ssl.google.com/linux/linux_signing_key.pub
$ apt-key add linux_signing_key.pub

</pre>

<pre class="example">
3. 执行安装
$ sudo apt update
// stable ersion
$ sudo apt install google-chrome-stable
// beta or unstable ersion
$ sudo apt install google-chrome-beta
$ sudo apt install google-chrome-unstable

</pre>

<pre class="example">
4. 安装 chromium
$ sudo apt-get update
$ sudo apt-get install chromium chromium-l10n
（chromium-l10n 是用于本地化界面的，是可选的软件包）
注意：chromium不支持PDF查看

</pre>
</div>
</div>
<div id="outline-container-orge735fd6" class="outline-4">
<h4 id="orge735fd6"><span class="section-number-4">5.3.14</span> Scrot：截图工具</h4>
<div class="outline-text-4" id="text-5-3-14">
</div>
<ol class="org-ol">
<li><a id="org75cf33e"></a>安装<br />
<div class="outline-text-5" id="text-5-3-14-1">
<pre class="example">
$ sudo apt-get install scrot

</pre>
</div>
</li>
<li><a id="orgfa300c8"></a>使用方法<br />
<div class="outline-text-5" id="text-5-3-14-2">
<p>
1.整个桌面截图(Full desktop)
</p>
<pre class="example">
$ scrot
$ scrot ~/Downloads/my_desktop.png //Saving to specified directory.

</pre>
<p>
2.特定区域截图（选择截取）(Specific area)
</p>
<pre class="example">
$ scrot -s

</pre>
<p>
3.延迟截图(temporize screenshot)
</p>
<pre class="example">
$ scrot -s -d 5

</pre>
<p>
4.截图调整质量(Adjust the quality of screenshots)
</p>
<pre class="example">
$ scrot -q 50

</pre>
<p>
5.截图调整大小(Adjust the screen size)
</p>
<pre class="example">
$ scrot -t 10

</pre>
<p>
6.将截图发送给其他命令(Deliver the intercepted screenshots to other commands)
</p>
<pre class="example">
$ scrot -e 'mv $f ~/screenshots'

</pre>
</div>
</li>
<li><a id="org3d255ec"></a>参考资料(References)<br />
<div class="outline-text-5" id="text-5-3-14-3">
<pre class="example">
https://linux.cn/article-3197-1.html

</pre>
</div>
</li>
</ol>
</div>
<div id="outline-container-org967181f" class="outline-4">
<h4 id="org967181f"><span class="section-number-4">5.3.15</span> rarcrack（压缩包密码破解工具）</h4>
<div class="outline-text-4" id="text-5-3-15">
<pre class="example">
支持格式：rar,7z,zip
// install
$ sudo apt-get install libxml2-dev build-essential
$ sudo apt-get install rarcrack
// use
$ rarcrack --threads 10 --type rar test.rar

</pre>
</div>
</div>
<div id="outline-container-org4b36baf" class="outline-4">
<h4 id="org4b36baf"><span class="section-number-4">5.3.16</span> 宝塔面板</h4>
<div class="outline-text-4" id="text-5-3-16">
<pre class="example">
一款使用方便、功能强大且终身免费的服务器管理软件。详见官网:http://www.bt.cn/

</pre>
</div>
</div>
<div id="outline-container-org5e092d4" class="outline-4">
<h4 id="org5e092d4"><span class="section-number-4">5.3.17</span> Cisco AnyConnect VPN Client</h4>
<div class="outline-text-4" id="text-5-3-17">
</div>
<ol class="org-ol">
<li><a id="orgb61f083"></a>问题解决<br />
<div class="outline-text-5" id="text-5-3-17-1">
<pre class="example">
$ sudo systemctl enable vpnagentd_init
vpnagentd_init.service is not a native service, redirecting to systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable vpnagentd_init
insserv: warning: script 'vpnagentd_init' missing LSB tags and overrides
insserv: There is a loop between service bt and vpnagentd_init if stopped
insserv:  loop involving service vpnagentd_init at depth 2
insserv:  loop involving service bt at depth 1
insserv: Stopping vpnagentd_init depends on bt and therefore on system facility `$all' which can not be true!
insserv: exiting now without changing boot order!
update-rc.d: error: insserv rejected the script header

</pre>

<pre class="example">
[solve]：$ sudo vim /etc/init.d/vpnagentd_init

</pre>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">sh</span>
<span style="color: #b22222;">### </span><span style="color: #b22222;">BEGIN INIT INFO</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Provides: vpnagentd_init</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Required-Start: $remote_fs $syslog</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Required-Stop: $remote_fs $syslog</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Default-Start: 2 3 4 5</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Default-Stop: 0 1 6</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Short-Description: Start Cisco vpn agent daemon at boot time</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Description: Cisco vpn agent daemon</span>
<span style="color: #b22222;">### </span><span style="color: #b22222;">END INIT INFO</span>
</pre>
</div>
</div>
</li>
</ol>
</div>
<div id="outline-container-org2b1bd4f" class="outline-4">
<h4 id="org2b1bd4f"><span class="section-number-4">5.3.18</span> Bind：DNS工具</h4>
<div class="outline-text-4" id="text-5-3-18">
</div>
<ol class="org-ol">
<li><a id="org25e663a"></a>安装<br />
<div class="outline-text-5" id="text-5-3-18-1">
<pre class="example">
# yum install -y bind

</pre>
</div>
</li>
<li><a id="org939cc0c"></a>配置<br />
<div class="outline-text-5" id="text-5-3-18-2">
<pre class="example">
1)# vim /etc/named.conf
修改内容如下：
 将下面
 listen-on port 53 { 127.0.0.1; };
 allow-query { localhost; };
 改为
 listen-on port 53 { any; };
 allow-query { any; };

</pre>

<pre class="example">
2)# vim named.rfc1912.zones
注意改动位置：
zone "zrg.com.cn" IN {
type master;
file "named.zrg";
allow-update { none; };
};

</pre>

<pre class="example">
3)# cp /var/named/named.localhost /var/named/named.zrg
//修改文件所属群组
#chgrp named /var/named/named.zrg

</pre>

<pre class="example">
4)# vim /var/named/named.zrg
注意改动位置：
$TTL 1D
@ IN SOA @ dns.zrg.com.cn. root(
0 ; serial
1D ; refresh
1H ; retry
1W ; expire
3H ) ; minimum
NS dns.zrg.com.cn.
DNS A 192.168.120.166
A 127.0.0.1
AAAA ::1

</pre>

<pre class="example">
5)# /etc/init.d/named restart
# chkconfig named on

</pre>

<pre class="example">
6)# vim /etc/sysconfig/network
Network=yes
Hostname=dns.zrg.com.cn

</pre>

<pre class="example">
7)# vim /etc/resolv.conf
Search zrg.com.cn
Nameserver 192.168.120.166

</pre>

<pre class="example">
8)# /etc/init.d/named restart
# ping zrg.com.cn
# reboot

</pre>
</div>
</li>
</ol>
</div>
<div id="outline-container-org4287461" class="outline-4">
<h4 id="org4287461"><span class="section-number-4">5.3.19</span> Composer</h4>
<div class="outline-text-4" id="text-5-3-19">
</div>
<ol class="org-ol">
<li><a id="orga342906"></a>安装<br />
<div class="outline-text-5" id="text-5-3-19-1">
<pre class="example">
1.Download composer.phar file.
2.Excute:
# php composer.phar
3.Global:
# mv composer.phar /usr/local/bin/composer
4.Permission:
# chmod 744 composer

</pre>
</div>
</li>
<li><a id="org5b41d22"></a>问题解决<br />
<div class="outline-text-5" id="text-5-3-19-2">
<pre class="example">
error: /usr/bin/env: php: No such file or directory
 solve:Configuring php to become global variables

</pre>
</div>
</li>
</ol>
</div>
<div id="outline-container-org4a60e9d" class="outline-4">
<h4 id="org4a60e9d"><span class="section-number-4">5.3.20</span> vsftpd</h4>
<div class="outline-text-4" id="text-5-3-20">
</div>
<ol class="org-ol">
<li><a id="org31beec4"></a>Download and Install<br />
<div class="outline-text-5" id="text-5-3-20-1">
<pre class="example">
https://security.appspot.com/vsftpd.html#download
//yum
yum install -y vsftpd

</pre>
</div>
</li>

<li><a id="orgffdfc94"></a>Change default dir<br />
<div class="outline-text-5" id="text-5-3-20-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">#local user
local_root=/usr/share/nginx/html
#is_enable local view,default_setting is NO
chroot_local_user=NO
#anonymous user
anon_root=/var/ftp/pub
</pre>
</div>
</div>
</li>

<li><a id="org734a3b2"></a>Configuring directory of access<br />
<div class="outline-text-5" id="text-5-3-20-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">chroot_local_user=YES
chroot_list_enable=NO
allow_writeable_chroot=YES

&#25253;&#22914;&#19979;&#38169;&#35823;&#65292;&#26159;&#22240;&#20026;&#27809;&#26377;&#28155;&#21152;&#19978;&#38754;&#30340;&#31532;&#19977;&#26465;&#35821;&#21477;&#65292;&#23548;&#33268;&#29992;&#25143;&#26080;&#27861;&#38145;&#23450;&#33258;&#24049;&#30340;&#30446;&#24405;&#12290;
   500 OOPS: vsftpd: refusing to run with writable root inside chroot()

notice:
 &#37197;&#32622;&#20855;&#20307;&#24773;&#20917;&#26377;&#20197;&#19979;&#20960;&#31181;&#65306;
1&#65289;<span style="color: #ff0000; font-weight: bold;">&#24403; chroot_list_enable=yes&#65292;chroot_local_user=yes&#26102;&#65292;&#22312;/etc/vsftpd/chroot_list&#25991;&#20214; &#20013;&#21015;&#20986;&#30340;&#29992;&#25143;&#65292;&#21487;&#20197;&#20999;&#25442;&#21040;&#19978;&#32423;&#30446;&#24405;&#65307;&#26410;&#22312;&#25991;&#20214;&#20013;&#21015;&#20986;&#30340;&#29992;&#25143;&#65292;&#19981;&#33021;&#20999;&#25442;&#21040;&#31449;&#28857;&#26681;&#30446;&#24405;&#30340;&#19978;&#32423;&#30446;&#24405;&#12290;</span>
2&#65289;<span style="color: #ff0000; font-weight: bold;">&#24403; chroot_list_enable=yes&#65292;chroot_local_user=no&#26102;&#65292;&#22312;/etc/vsftpd/chroot_list&#25991;&#20214;&#20013; &#21015;&#20986;&#30340;&#29992;&#25143;&#65292;&#19981;&#33021;&#20999;&#25442;&#21040;&#31449;&#28857;&#26681;&#30446;&#24405;&#30340;&#19978;&#32423;&#30446;&#24405;&#65307;&#26410;&#22312;&#25991;&#20214;&#20013;&#21015;&#20986;&#30340;&#29992;&#25143;&#65292;&#21487;&#20197;&#20999;&#25442;&#21040;&#19978;&#32423;&#30446;&#24405;&#12290;</span>
3&#65289;<span style="color: #ff0000; font-weight: bold;">&#24403; chroot_list_enable=no&#65292;chroot_local_user=yes&#26102;&#65292;&#25152;&#26377;&#29992;&#25143;&#22343;&#19981;&#33021;&#20999;&#25442;&#21040;&#19978;&#32423;&#30446;&#24405;&#12290;</span>
4&#65289;<span style="color: #ff0000; font-weight: bold;">&#24403; chroot_list_enable=no&#65292;chroot_local_user=no&#26102;&#65292;&#25152;&#26377;&#29992;&#25143;&#22343;&#21487;&#20197;&#20999;&#25442;&#21040;&#19978;&#32423;&#30446;&#24405;&#12290;</span>

5&#65289;<span style="color: #ff0000; font-weight: bold;">&#24403;&#29992;&#25143;&#19981;&#20801;&#35768;&#20999;&#25442;&#21040;&#19978;&#32423;&#30446;&#24405;&#26102;&#65292;&#30331;&#24405;&#21518;ftp&#31449;&#28857;&#30340;&#26681;&#30446;&#24405;&#8220;/&#8221;&#26159;&#35813;ftp&#36134;&#25143;&#30340;&#20027;&#30446;&#24405;&#65292;&#21363;&#25991;&#20214;&#30340;&#31995;&#32479;&#30340;/var/ftp&#30446;&#24405;&#12290;</span>
</pre>
</div>
</div>
</li>

<li><a id="orgc93f3a9"></a>my vsftpd.conf<br />
<div class="outline-text-5" id="text-5-3-20-4">
<p>
//CentOS 7, /etc/vsftpd/vsftpd.conf.
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp"># Example config file /etc/vsftpd/vsftpd.conf
# Allow anonymous FTP? (Beware - allowed by default if you comment this out).
anonymous_enable=NO
#
local_root=/srv/www/
#
# Uncomment this to allow local users to log in.
# When SELinux is enforcing check for SE bool ftp_home_dir
local_enable=YES
#
# Uncomment this to enable any form of FTP write command.
write_enable=YES
#
# Default umask for local users is 077. You may wish to change this to 022,
# if your users expect that (022 is used by most other ftpd's)
local_umask=022
#
# Uncomment this to allow the anonymous FTP user to upload files. This only
# has an effect if the above global write enable is activated. Also, you will
# obviously need to create a directory writable by the FTP user.
# When SELinux is enforcing check for SE bool allow_ftpd_anon_write, allow_ftpd_full_access
#anon_upload_enable=YES
#
# Uncomment this if you want the anonymous FTP user to be able to create
# new directories.
#anon_mkdir_write_enable=YES
#
# Activate directory messages - messages given to remote users when they
# go into a certain directory.
dirmessage_enable=YES
#
# Activate logging of uploads/downloads.
xferlog_enable=YES
#
# Make sure PORT transfer connections originate from port 20 (ftp-data).
connect_from_port_20=YES
#
# If you want, you can arrange for uploaded anonymous files to be owned by
# a different user. Note! Using <span style="color: #8b2252;">"root"</span> for uploaded files is not
# recommended!
#chown_uploads=YES
#chown_username=whoever
#
# You may override where the log file goes if you like. The default is shown
# below.
#xferlog_file=/var/log/xferlog
#
# If you want, you can have your log file in standard ftpd xferlog format.
# Note that the default log file location is /var/log/xferlog in this case.
xferlog_std_format=YES
#
# You may change the default value for timing out an idle session.
#idle_session_timeout=600
#
# You may change the default value for timing out a data connection.
#data_connection_timeout=120
#
# It is recommended that you define on your system a unique user which the
# ftp server can use as a totally isolated and unprivileged user.
#nopriv_user=ftpsecure
#
# Enable this and the server will recognise asynchronous ABOR requests. Not
# recommended for security (<span style="color: #a020f0;">the</span> code is non-trivial). Not enabling it,
# however, may confuse older FTP clients.
#async_abor_enable=YES
#
# By default the server will pretend to allow ASCII mode but in fact ignore
# the request. Turn on the below options to have the server actually do ASCII
# mangling on files when in ASCII mode.
# Beware that on some FTP servers, ASCII support allows a denial of service
# attack (DoS) via the command <span style="color: #8b2252;">"SIZE /big/file"</span> in ASCII mode. vsftpd
# predicted this attack and has always been safe, reporting the size of the
# raw file.
# ASCII mangling is a horrible feature of the protocol.
#ascii_upload_enable=YES
#ascii_download_enable=YES
#
# You may fully customise the login banner string:
#ftpd_banner=Welcome to blah FTP service.
#
# You may specify a file of disallowed anonymous e-mail addresses. Apparently
# useful for combatting certain DoS attacks.
#deny_email_enable=YES
# (default follows)
#banned_email_file=/etc/vsftpd/banned_emails
#
# You may specify an explicit list of local users to chroot() to their home
# directory. If chroot_local_user is YES, then this list becomes a list of
# users to NOT chroot().
# (Warning! chroot'ing can be very dangerous. If using chroot, make sure that
# the user does not have write access to the top level directory within the
# chroot)
chroot_local_user=YES
chroot_list_enable=YES
allow_writeable_chroot=YES
# (default follows)
chroot_list_file=/etc/vsftpd/chroot_list
#
# You may activate the <span style="color: #8b2252;">"-R"</span> option to the builtin ls. This is disabled by
# default to avoid remote users being able to cause excessive I/O on large
# sites. However, some broken FTP clients such as <span style="color: #8b2252;">"ncftp"</span> and <span style="color: #8b2252;">"mirror"</span> assume
# the presence of the <span style="color: #8b2252;">"-R"</span> option, so there is a strong case for enabling it.
#ls_recurse_enable=YES
#
# When <span style="color: #8b2252;">"listen"</span> directive is enabled, vsftpd runs in standalone mode and
# listens on IPv4 sockets. This directive cannot be used in conjunction
# with the listen_ipv6 directive.
listen=NO
#
# This directive enables listening on IPv6 sockets. By default, listening
# on the IPv6 <span style="color: #8b2252;">"any"</span> address (<span style="color: #483d8b;">::</span>) will accept connections from both IPv6
# and IPv4 clients. It is not necessary to listen on *both* IPv4 and IPv6
# sockets. If you want that (perhaps because you want to listen on specific
# addresses) <span style="color: #ff0000; font-weight: bold;">then you must run two copies of vsftpd with two configuration</span>
# files.
# Make sure, that one of the listen options is commented !!
listen_ipv6=YES

pam_service_name=vsftpd
userlist_enable=YES
tcp_wrappers=YES
</pre>
</div>
</div>
</li>
<li><a id="orgac7c08d"></a>References<br />
<div class="outline-text-5" id="text-5-3-20-5">
<pre class="example">
https://security.appspot.com/vsftpd.html
https://en.wikipedia.org/wiki/Vsftpd
http://baike.baidu.com/item/vsftpd

</pre>
</div>
</li>
</ol>
</div>
<div id="outline-container-orgdf0d7ba" class="outline-4">
<h4 id="orgdf0d7ba"><span class="section-number-4">5.3.21</span> Cygwin：windows 下 Linux 模拟软件</h4>
<div class="outline-text-4" id="text-5-3-21">
</div>
<ol class="org-ol">
<li><a id="org2d5d9d8"></a>安装Cygwin<br />
<div class="outline-text-5" id="text-5-3-21-1">
<pre class="example">
略
提示：安装软件时，可使用中国科技大学软件源mirrors.ustc.edu.cn/cygwin

</pre>

<pre class="example">
// 举例说明：安装及配置ssh
1.运行安装文件
2.搜索ssh，在Net类别下选上OpenSSH和OpenSSL两项
3.安装完成后，打开Cygwin，输入ssh-host-config
当询问if privilege separation should be used 时输入 no . 
当询问if sshd should be installed as a service 时输入yes . 
当询问about the value of CYGWIN environment variable enter 时输入 ntsec .
其余询问均输入 no
4.在cygwin中输入 cygrunsrv --start sshd 启动sshd
5.打开cygwin，输入 ssh-keygen，当询问要filenames 和 pass phrases 的时候都点回车，接受默认的值
6.命令结束后输入 cd ~/.ssh 转到.ssh目录，输入 ls –l 应该包含两个文件：id_rsa.pub 和 id_rsa
7.在第8步的窗口（当前目录在.ssh）中输入 cat id_rsa.pub &gt;&gt; authorized_keys
8.输入 ssh localhost 启动SSH

</pre>
</div>
</li>
<li><a id="org19c75c1"></a>参考资料<br />
<div class="outline-text-5" id="text-5-3-21-2">
<pre class="example">
1.Cygwin-Official Site:http://cygwin.com/
2.Cygwin-Wikipedia:https://en.wikipedia.org/wiki/Cygwin
3.Cygwin-百度百科：http://baike.baidu.com/view/3968.htm
4.Cygwin在线安装指南：http://www.crifan.com/files/doc/docbook/cygwin_intro/release/htmls/install_cygwin_setup_exe.html

</pre>
</div>
</li>
</ol>
</div>
<div id="outline-container-org68bf21f" class="outline-4">
<h4 id="org68bf21f"><span class="section-number-4">5.3.22</span> Wps for Linux</h4>
<div class="outline-text-4" id="text-5-3-22">
<pre class="example">
1. 从官网下载安装包，网址：http://www.wps.cn/

</pre>

<pre class="example">
2. 安装
$ sudo dpkg -i wps_office_10.xxx.deb

</pre>

<pre class="example">
3. 安装完成后，提示“系统缺失字体symbol、wingdings、wingdings 2、wingdings 3、webding”的解决办法：
1) 下载缺失的字体文件，然后复制到Linux系统中的/usr/share/fonts文件夹中。
国外下载地址：https://www.dropbox.com/s/lfy4hvq95ilwyw5/wps_symbol_fonts.zip
国内下载地址：http://pan.baidu.com/s/1mh0lcbY
或者直接 在win 中（C/WINDOWS/FONTS）
2) 执行以下命令,生成字体的索引信息：
$ sudo mkfontscale
$ sudo mkfontdir
3) 运行fc-cache命令更新字体缓存
$ sudo fc-cache

</pre>
</div>
</div>
<div id="outline-container-orgf000afd" class="outline-4">
<h4 id="orgf000afd"><span class="section-number-4">5.3.23</span> gnome-screenshots</h4>
<div class="outline-text-4" id="text-5-3-23">
</div>
<ol class="org-ol">
<li><a id="orgc52e077"></a>常用快捷键<br />
<div class="outline-text-5" id="text-5-3-23-1">
<pre class="example">
Prt Scrn to take a screenshot of the desktop.
Alt+Prt Scrn to take a screenshot of a window.
Shift+Prt Scrn to take a screenshot of an area you select.

</pre>
</div>
</li>
<li><a id="orged03fda"></a>参考资料(References)<br />
<div class="outline-text-5" id="text-5-3-23-2">
<ul class="org-ul">
<li><a href="https://help.gnome.org/users/gnome-help/stable/screen-shot-record.html.en">Screenshots and screencasts</a></li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-org2d2a357" class="outline-3">
<h3 id="org2d2a357"><span class="section-number-3">5.4</span> 网络(Network)</h3>
</div>
</div>
<div id="outline-container-orgbaf2da2" class="outline-2">
<h2 id="orgbaf2da2"><span class="section-number-2">6</span> 常见问题解决(Problem)</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-org3175d87" class="outline-3">
<h3 id="org3175d87"><span class="section-number-3">6.1</span> 不能在 Sublime 编辑器（Editor）中输入中文</h3>
<div class="outline-text-3" id="text-6-1">
</div>
<div id="outline-container-orgb5108eb" class="outline-4">
<h4 id="orgb5108eb"><span class="section-number-4">6.1.1</span> 1.下载（Download）</h4>
<div class="outline-text-4" id="text-6-1-1">
<pre class="example">
$ git clone https://github.com/lyfeyaj/sublime-text-imfix.git

</pre>
</div>
</div>
<div id="outline-container-org533b701" class="outline-4">
<h4 id="org533b701"><span class="section-number-4">6.1.2</span> 2.配置（Configure）</h4>
<div class="outline-text-4" id="text-6-1-2">
<pre class="example">
$ cd ~/sublime-text-imfix
$ sudo cp ./lib/libsublime-imfix.so /opt/sublime_text/
$ sudo cp ./src/subl /usr/bin/ 
$ LD_PRELOAD=./libsublime-imfix.so subl

</pre>
</div>
</div>
<div id="outline-container-orgc5b45c7" class="outline-4">
<h4 id="orgc5b45c7"><span class="section-number-4">6.1.3</span> 3.新建Shell脚本</h4>
<div class="outline-text-4" id="text-6-1-3">
<pre class="example">
$ vim /home/zrg/sublime
#!/bin/bash
LD_PRELOAD=/opt/sublime_text/libsublime-imfix.so subl

</pre>
</div>
</div>
<div id="outline-container-orge46a1ab" class="outline-4">
<h4 id="orge46a1ab"><span class="section-number-4">6.1.4</span> 参考资料</h4>
<div class="outline-text-4" id="text-6-1-4">
<pre class="example">
http://www.jianshu.com/p/bf05fb3a4709

</pre>
</div>
</div>
</div>
<div id="outline-container-org432ed85" class="outline-3">
<h3 id="org432ed85"><span class="section-number-3">6.2</span> 解决系统不能支持加密算法：chacha20</h3>
<div class="outline-text-3" id="text-6-2">
<pre class="example">
$ sudo apt-get install m2crypto gcc -y
$ wget -N --no-check-certificate https://download.libsodium.org/libsodium/releases/libsodium-1.0.8.tar.gz
$ tar zxvf libsodium-1.0.8.tar.gz
$ cd libsodium-1.0.8
$ ./configure
$ sudo make &amp;&amp; make install
$ sudo echo "include ld.so.conf.d/*.conf"&gt;/etc/ld.so.conf
$ sudo echo "/lib"&gt;&gt;/etc/ld.so.conf
$ sudo echo "/usr/lib64"&gt;&gt;/etc/ld.so.conf
$ sudo echo "/usr/local/lib"&gt;&gt;/etc/ld.so.conf
$ ldconfig

</pre>
</div>
</div>
<div id="outline-container-orgf58e401" class="outline-3">
<h3 id="orgf58e401"><span class="section-number-3">6.3</span> 软件源配置不全，导致软件不能安装</h3>
<div class="outline-text-3" id="text-6-3">
<pre class="example">
//Error: Can't fix the error because you are asking some packages to stay the same, that is they break the dependencies between the packages.
//翻译：无法修正错误,因为您要求某些软件包保持现状,就是它们破坏了软件包间的依赖关系
//解决：检查安装源，进行重新配置，必要时添加debian官方安装源
$ vim /etc/apt/sources.list
$ sudo apt-get update

</pre>
</div>
</div>
<div id="outline-container-orgffdfd3f" class="outline-3">
<h3 id="orgffdfd3f"><span class="section-number-3">6.4</span> .deb 转换为 .rpm</h3>
<div class="outline-text-3" id="text-6-4">
</div>
<div id="outline-container-org8fc265d" class="outline-4">
<h4 id="org8fc265d"><span class="section-number-4">6.4.1</span> 下载及安装 alien</h4>
<div class="outline-text-4" id="text-6-4-1">
<pre class="example">
1.下载:
$ wget https://packages.debian.org/unstable/source/alien

</pre>

<pre class="example">
2.安装:
$ tar xpvf alien_8.95.tar.xz 
$ cd alien-8.95
$ make &amp;&amp; make install

</pre>
</div>
</div>
<div id="outline-container-org5585ceb" class="outline-4">
<h4 id="org5585ceb"><span class="section-number-4">6.4.2</span> 转换(Conversion)</h4>
<div class="outline-text-4" id="text-6-4-2">
<pre class="example">
$ alien -r kuaipan4uk_2.0.0.5_amd64.deb

</pre>
</div>
</div>
</div>
<div id="outline-container-orgb6fc7c9" class="outline-3">
<h3 id="orgb6fc7c9"><span class="section-number-3">6.5</span> 软件自启动脚本实例</h3>
<div class="outline-text-3" id="text-6-5">
</div>
<div id="outline-container-org1dbc429" class="outline-4">
<h4 id="org1dbc429"><span class="section-number-4">6.5.1</span> 实例：php-fpm 服务启动脚本</h4>
<div class="outline-text-4" id="text-6-5-1">
<ol class="org-ol">
<li>$ sudo vim /etc/init.d/php-fpm</li>
</ol>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #b22222;">#</span><span style="color: #b22222;">!/bin/</span><span style="color: #a020f0;">sh</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">DateTime:2017-03-09</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Author:zrg</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">chkconfig: - 84 16</span>
<span style="color: #483d8b;">.</span> /etc/rc.d/init.d/functions

<span style="color: #b22222;"># </span><span style="color: #b22222;">Source networking configuration.</span>
<span style="color: #483d8b;">.</span> /etc/sysconfig/network

<span style="color: #b22222;"># </span><span style="color: #b22222;">Check that networking is up.</span>
[ <span style="color: #8b2252;">"$NETWORKING"</span> = <span style="color: #8b2252;">"no"</span> ] &amp;&amp; <span style="color: #a020f0;">exit</span> 0

<span style="color: #a0522d;">phpfpm</span>=<span style="color: #8b2252;">"/usr/local/php/sbin/php-fpm"</span>
<span style="color: #a0522d;">prog</span>=$(<span style="color: #ff00ff;">basename</span> ${<span style="color: #a0522d;">phpfpm</span>})

<span style="color: #a0522d;">lockfile</span>=/var/lock/subsys/phpfpm

<span style="color: #0000ff;">start</span>() {
    [ -x ${<span style="color: #a0522d;">phpfpm</span>} ] || <span style="color: #a020f0;">exit</span> 5
    <span style="color: #483d8b;">echo</span> -n $<span style="color: #8b2252;">"Starting $prog: "</span>
    daemon ${<span style="color: #a0522d;">phpfpm</span>}
    <span style="color: #a0522d;">retval</span>=$<span style="color: #a0522d;">?</span>
    <span style="color: #483d8b;">echo</span>
    [ $<span style="color: #a0522d;">retval</span> -eq 0 ] &amp;&amp; touch $<span style="color: #a0522d;">lockfile</span>
    <span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">retval</span>
}

<span style="color: #0000ff;">stop</span>() {
    <span style="color: #483d8b;">echo</span> -n $<span style="color: #8b2252;">"Stopping $prog: "</span>
    killproc $<span style="color: #a0522d;">prog</span> -QUIT
    <span style="color: #a0522d;">retval</span>=$<span style="color: #a0522d;">?</span>
    <span style="color: #483d8b;">echo</span>
    [ $<span style="color: #a0522d;">retval</span> -eq 0 ] &amp;&amp; rm -f $<span style="color: #a0522d;">lockfile</span>
    <span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">retval</span>
}

<span style="color: #0000ff;">restart</span>() {
    configtest || <span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">?</span>
    stop
    start
}

<span style="color: #0000ff;">reload</span>() {
    configtest || <span style="color: #a020f0;">return</span> $<span style="color: #a0522d;">?</span>
    <span style="color: #483d8b;">echo</span> -n $<span style="color: #8b2252;">"Reloading $prog: "</span>
killproc ${<span style="color: #a0522d;">phpfpm</span>} -HUP
    <span style="color: #a0522d;">RETVAL</span>=$<span style="color: #a0522d;">?</span>
    <span style="color: #483d8b;">echo</span>
}

<span style="color: #0000ff;">force_reload</span>() {
    restart
}

<span style="color: #0000ff;">configtest</span>() {
  ${<span style="color: #a0522d;">phpfpm</span>} -t
}

<span style="color: #0000ff;">rh_status</span>() {
    status $<span style="color: #a0522d;">prog</span>
}

<span style="color: #0000ff;">rh_status_q</span>() {
    rh_status &gt;/dev/null 2&gt;&amp;1
}

<span style="color: #a020f0;">case</span> <span style="color: #8b2252;">"$1"</span><span style="color: #a020f0;"> in</span>
    start)
        rh_status_q &amp;&amp; <span style="color: #a020f0;">exit</span> 0
        $<span style="color: #a0522d;">1</span>
        ;;
    stop)
        rh_status_q || <span style="color: #a020f0;">exit</span> 0
        $<span style="color: #a0522d;">1</span>
        ;;
    restart|configtest)
        $<span style="color: #a0522d;">1</span>
        ;;
    reload)
        rh_status_q || <span style="color: #a020f0;">exit</span> 7
        $<span style="color: #a0522d;">1</span>
        ;;
    status)
        rh_status
        ;;
     *)
        <span style="color: #483d8b;">echo</span> $<span style="color: #8b2252;">"Usage: $0 {start|stop|status|restart|reload|configtest}"</span>
        <span style="color: #a020f0;">exit</span> 2
<span style="color: #a020f0;">esac</span>
</pre>
</div>
<pre class="example">
脚本说明：
# Source function library.  
. /etc/rc.d/init.d/functions  //类似于include,require，引入文件。
# Source networking configuration.  
. /etc/sysconfig/network   //同理。
//引入后，用到的daemon、status
NETWORKING=yes
 HOSTNAME=E10162
//将他们作为变量赋值,判断网卡是否启动，如果你的 nginx 不走网卡，其实网络这段可以去掉
//daemon便是实现上图漂亮的【 OK 】的函数.

</pre>
<p>
2.设置自启动
</p>
<pre class="example">
# php-fpm 加入服务
chkconfig --add php-fpm
# php-fpm 234 级别下设置为启动
chkconfig php-fpm on
# 查看 php-fpm 服务当前配置
chkconfig --list php-fpm
php-fpm         0:off   1:off   2:on    3:on    4:on    5:on    6:off

</pre>
<p>
3.php-fpm操作
</p>
<pre class="example">
# 启动/关闭/重启/重载
service php-fpm start/stop/restart/reload
# 检查配置文件
#service php-fpm configtest

</pre>
</div>
</div>
<div id="outline-container-org4addcbf" class="outline-4">
<h4 id="org4addcbf"><span class="section-number-4">6.5.2</span> References</h4>
<div class="outline-text-4" id="text-6-5-2">
<ul class="org-ul">
<li><a href="http://www.ttlsa.com/php/php-fpm-service-scripts/">http://www.ttlsa.com/php/php-fpm-service-scripts/</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org620a92f" class="outline-3">
<h3 id="org620a92f"><span class="section-number-3">6.6</span> 解决 dpkg: warning: files list file for package 'x' missing 问题</h3>
<div class="outline-text-3" id="text-6-6">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 3: </span></label><pre class="src src-shell"><span style="color: #a020f0;">for</span> package<span style="color: #a020f0;"> in</span> $(<span style="color: #ff00ff;">apt-get</span> upgrade 2&gt;&amp;1 |<span style="color: #8b2252;">\</span>
                 grep <span style="color: #8b2252;">"warning: files list file for package '"</span> |<span style="color: #8b2252;">\</span>
                 grep -Po <span style="color: #8b2252;">"[^'\n ]+'"</span> | grep -Po <span style="color: #8b2252;">"[^']+"</span>); <span style="color: #a020f0;">do</span>
    apt-get install --reinstall <span style="color: #8b2252;">"$package"</span>;
<span style="color: #a020f0;">done</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfcadfc8" class="outline-3">
<h3 id="orgfcadfc8"><span class="section-number-3">6.7</span> dpkg: error: failed to open package info file `/var/lib/dpkg/available' for reading</h3>
<div class="outline-text-3" id="text-6-7">
<pre class="example">
$ sudo dpkg --configure -a
$ sudo apt-get -f install
$ sudo apt-get --fix-missing install
$ sudo apt-get clean
$ sudo apt-get update
$ sudo apt-get upgrade
$ sudo apt-get dist-upgrade
$ sudo apt-get clean
$ sudo apt-get autoremove

</pre>
</div>
</div>
<div id="outline-container-orgf308f87" class="outline-3">
<h3 id="orgf308f87"><span class="section-number-3">6.8</span> CentOS 7关闭firewall，安装iptables</h3>
<div class="outline-text-3" id="text-6-8">
<pre class="example">
1. 查看安装和状态
$ yum installed firewalld iptables
$ systemctl list-unit-files firewalld.service iptables.service

</pre>

<pre class="example">
2. 停止并禁止自启动firewall和安装iptables防火墙
$ systemctl stop firewalld.service
$ systemctl disable firewalld.service
$ yum install iptables-service
$ systemctl enable iptables.service

</pre>

<pre class="example">
3. 编辑并修改配置文件/etc/sysconfig/iptables，使用如下配置

</pre>
<div class="org-src-container">
<pre class="src src-shell" id="org542eec0">*filter
:INPUT ACCEPT [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:TEST - [0:0]
-A INPUT -j TEST
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -p icmp -j ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -p tcp -i eth1 -d 192.168.1.100 --syn -m recent --name suduip --rcheck --seconds 1 --hitcount 15 -j DROP
-A INPUT -p tcp -i eth1 -d 192.168.1.100 --syn -m recent --name suduip --set
-A INPUT -i eth1 -p tcp -m tcp -d 192.168.1.100 --syn -m connlimit --connlimit-above 50 --connlimit-mask 32 --connlimit-saddr -j DROP
<span style="color: #b22222;">#</span><span style="color: #b22222;">-A INPUT -p tcp -m tcp --tcp-flags FIN,SYN,RST,PSH,ACK,URG SYN -m length --length 0:128 -j ACCEPT</span>
-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT
-A INPUT -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT
... ...
-A INPUT -j DROP
-A INPUT -j REJECT --reject-with icmp-host-prohibited
-A FORWARD -j TEST
-A FORWARD -j REJECT --reject-with icmp-host-prohibited
-A OUTPUT -j TEST
-A TEST -j RETURN
COMMIT
</pre>
</div>
<pre class="example">


</pre>

<pre class="example">
4. 查看防火墙规则是否启用。
$ iptables -L

</pre>
</div>
</div>
</div>
