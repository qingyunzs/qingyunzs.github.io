---
layout: post
title: PHP 公共方法
author: zrg
comments: true
description: PHP 公共方法
categories:
- php
tags:
- PHP
photos:
---

<p>
如果你有任何问题或疑问，请发送Email至zrg1390556487@gmail.com！
</p>

<div id="outline-container-org10c6ba4" class="outline-2">
<h2 id="org10c6ba4"><span class="section-number-2">1</span> 写在前面</h2>
<div class="outline-text-2" id="text-1">
<pre class="example">
关于PHP的一些公共方法
</pre>
</div>
</div>
<div id="outline-container-orga1ed68f" class="outline-2">
<h2 id="orga1ed68f"><span class="section-number-2">2</span> 字符串(String)/数组(Array)</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orgae634cb" class="outline-3">
<h3 id="orgae634cb"><span class="section-number-3">2.1</span> 字符串(String)</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-org1dfab8c" class="outline-4">
<h4 id="org1dfab8c"><span class="section-number-4">2.1.1</span> 字符串长度</h4>
<div class="outline-text-4" id="text-2-1-1">
<pre class="example">
$strLength=strlen($str);
</pre>
</div>
</div>
<div id="outline-container-org2e37061" class="outline-4">
<h4 id="org2e37061"><span class="section-number-4">2.1.2</span> 大小写转换</h4>
<div class="outline-text-4" id="text-2-1-2">
<pre class="example">
//小写转换为大写
strtoupper($str);
//大写转换为小写
strtolower($str);
</pre>
</div>
</div>
<div id="outline-container-org6ba7902" class="outline-4">
<h4 id="org6ba7902"><span class="section-number-4">2.1.3</span> 字符串截取</h4>
<div class="outline-text-4" id="text-2-1-3">
<pre class="example">
//截取字符串，取出最有一个字符
substr($str,0,-1);
</pre>
</div>
</div>
</div>
<div id="outline-container-org587bd19" class="outline-3">
<h3 id="org587bd19"><span class="section-number-3">2.2</span> 数组(Array)</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-org3d50760" class="outline-4">
<h4 id="org3d50760"><span class="section-number-4">2.2.1</span> string⇌array</h4>
<div class="outline-text-4" id="text-2-2-1">
<pre class="example">
$array=explode(separator,$string);
$pizza = "piece1 piece2 piece3 piece4 piece5 piece6";
$pieces = explode(" ", $pizza);
echo $pieces[0]; // piece1
echo $pieces[1]; // piece2
</pre>


<pre class="example">
// 数组转化为字符串，implode()
$string=implode(glue,$array);
</pre>
</div>
</div>
<div id="outline-container-orgd25b56f" class="outline-4">
<h4 id="orgd25b56f"><span class="section-number-4">2.2.2</span> array 去除空元素</h4>
<div class="outline-text-4" id="text-2-2-2">
<pre class="example">
//去除空元素
array_filter()
</pre>
</div>
</div>
<div id="outline-container-org8557183" class="outline-4">
<h4 id="org8557183"><span class="section-number-4">2.2.3</span> array 去除重复元素</h4>
<div class="outline-text-4" id="text-2-2-3">
<pre class="example">
//去除重复元素
array_unique()
</pre>
</div>
</div>
<div id="outline-container-org955ef89" class="outline-4">
<h4 id="org955ef89"><span class="section-number-4">2.2.4</span> 判断二维数组是否为空</h4>
<div class="outline-text-4" id="text-2-2-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org6914b04">function array_is_null($arr = null){ 
        if(is_array($arr)){ 
                foreach($arr as $k=&gt;$v){ 
                        if($v&amp;&amp;!is_array($v)){ 
                                return false<span style="color: #727072;">; </span>
                        }
                        $t = self::array_is_null($v)<span style="color: #727072;">; </span>
                        if(!$t){ 
                                return false<span style="color: #727072;">; </span>
                        } 
                }
                return true<span style="color: #727072;">; </span>
        }elseif(!$arr){ 
                return true<span style="color: #727072;">; </span>
        }else{ 
                return false<span style="color: #727072;">; </span>
        }
}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb7a3c12" class="outline-2">
<h2 id="orgb7a3c12"><span class="section-number-2">3</span> 日期(Date)/时间(Time)</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org2b2cc7d" class="outline-3">
<h3 id="org2b2cc7d"><span class="section-number-3">3.1</span> 获取当月天数及当月第一天及最后一天、上月第一天及最后一天</h3>
<div class="outline-text-3" id="text-3-1">
</div>
<div id="outline-container-org552e67f" class="outline-4">
<h4 id="org552e67f"><span class="section-number-4">3.1.1</span> 获取上个月第一天及最后一天</h4>
<div class="outline-text-4" id="text-3-1-1">
<pre class="example">
echo date('Y-m-01', strtotime('-1 month'));
echo date('Y-m-t', strtotime('-1 month'));
</pre>


<pre class="example">
//上个月第一天:
echo date('Y-m-d', strtotime(date('Y-m-01') . ' -1 month')); // 计算出本月第一天再减一个月
//上个月最后一天:
echo date('Y-m-d', strtotime(date('Y-m-01') . ' -1 day')); // 计算出本月第一天再减一天
</pre>
</div>
</div>
<div id="outline-container-orge21c2ed" class="outline-4">
<h4 id="orge21c2ed"><span class="section-number-4">3.1.2</span> 获取当月第一天及最后一天</h4>
<div class="outline-text-4" id="text-3-1-2">
<pre class="example">
$BeginDate=date('Y-m-01', strtotime(date("Y-m-d")));
echo date('Y-m-d', strtotime("$BeginDate +1 month -1 day"));
</pre>
</div>
</div>
<div id="outline-container-org03ac3fe" class="outline-4">
<h4 id="org03ac3fe"><span class="section-number-4">3.1.3</span> 获取当前年份、月份、日、天数</h4>
<div class="outline-text-4" id="text-3-1-3">
<pre class="example">
echo " 本月共有:".date("t")."天";
echo " 当前年份".date('Y');
echo " 当前月份".date('m');
echo " 当前几号".date('d');
</pre>
</div>
</div>
</div>
<div id="outline-container-orgb84fa1c" class="outline-3">
<h3 id="orgb84fa1c"><span class="section-number-3">3.2</span> 日期转时间戳，时间戳转日期</h3>
<div class="outline-text-3" id="text-3-2">
<pre class="example">
strtotime('2010-03-24 08:15:42');
date('Y-m-d H:i:s', 1156219870);
</pre>
</div>
</div>




<div id="outline-container-org90145fc" class="outline-3">
<h3 id="org90145fc"><span class="section-number-3">3.3</span> 计算日期/时间差</h3>
<div class="outline-text-3" id="text-3-3">
</div>
<div id="outline-container-orgc05a4b7" class="outline-4">
<h4 id="orgc05a4b7"><span class="section-number-4">3.3.1</span> 计算已成为会员多少天或距离某活动还剩余多少天?</h4>
<div class="outline-text-4" id="text-3-3-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org367399b">function get_days_calc($calcTime, $currentTime, $differOrSurplus){
        switch ($differOrSurplus) {
        case 1:
                return round(($currentTime-$calcTime)/3600/24)<span style="color: #727072;">;</span>
                break<span style="color: #727072;">;</span>
        case 2:
                return round(($calcTime-$currentTime)/3600/24)<span style="color: #727072;">;</span>
                break<span style="color: #727072;">;</span>
        default:
                return round(($currentTime-$calcTime)/3600/24)<span style="color: #727072;">;</span>
                break<span style="color: #727072;">;</span>
        }
}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc6106f8" class="outline-2">
<h2 id="orgc6106f8"><span class="section-number-2">4</span> URL常用函数</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org49a1137" class="outline-3">
<h3 id="org49a1137"><span class="section-number-3">4.1</span> 获取当前URL</h3>
<div class="outline-text-3" id="text-4-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org30f275f">function getCurrentPageURL()
{
        $pageURL = 'http'<span style="color: #727072;">;</span>
        if (isset($_SERVER[<span style="color: #ffd866;">"HTTPS"</span>]) <span style="color: #78dce8;">&amp;&amp;</span> $_SERVER[<span style="color: #ffd866;">"HTTPS"</span>] == <span style="color: #ffd866;">"on"</span>)
        {
                $pageURL .= <span style="color: #ffd866;">"s"</span><span style="color: #727072;">;</span>
        }
        $pageURL .= <span style="color: #ffd866;">"://"</span><span style="color: #727072;">;</span>
        if ($_SERVER[<span style="color: #ffd866;">"SERVER_PORT"</span>] != <span style="color: #ffd866;">"80"</span>)
        {
                $pageURL .= $_SERVER[<span style="color: #ffd866;">"SERVER_NAME"</span>] . <span style="color: #ffd866;">":"</span> . $_SERVER[<span style="color: #ffd866;">"SERVER_PORT"</span>] . $_SERVER[<span style="color: #ffd866;">"REQUEST_URI"</span>]<span style="color: #727072;">;</span>
        }
        else
        {
                $pageURL .= $_SERVER[<span style="color: #ffd866;">"SERVER_NAME"</span>] . $_SERVER[<span style="color: #ffd866;">"REQUEST_URI"</span>]<span style="color: #727072;">;</span>
        }
        return $pageURL<span style="color: #727072;">;</span>
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org78c7da0" class="outline-3">
<h3 id="org78c7da0"><span class="section-number-3">4.2</span> 请求处理</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp" id="org6633e7c">function curl( $url = '',$method = 'GET',$req_data = false,$header = false,$response_header = false,$exec_time = 5,$connect_time = 5 )
{
        $method = strtoupper( $method )<span style="color: #727072;">;</span>
        $ch = curl_init()<span style="color: #727072;">;</span>
        // &#35774;&#32622;&#35831;&#27714;url
        curl_setopt( $ch,CURLOPT_URL,$url )<span style="color: #727072;">;</span>
        // &#35774;&#32622;&#35831;&#27714;&#26041;&#27861;,&#40664;&#35748;&#25191;&#34892;GET&#35831;&#27714;&#65292;&#26080;&#38656;&#35774;&#32622;
        if( 'POST' == $method ){
                curl_setopt( $ch, CURLOPT_POST,1 )<span style="color: #727072;">;</span>
        }elseif( 'GET' != $method ){
                curl_setopt( $ch, CURLOPT_CUSTOMREQUEST,$method )<span style="color: #727072;">;</span>
        }
        // &#35774;&#32622;&#35831;&#27714;&#22836;
        if( null != $header <span style="color: #78dce8;">&amp;&amp;</span> is_array($header) ){
                curl_setopt( $ch,CURLOPT_HTTPHEADER,array_map(<span style="color: #ff6188;">function</span>($field,$value){
                        return $field . ':' . $value<span style="color: #727072;">;</span>
                }, array_keys($header), $header) )<span style="color: #727072;">;</span>
        }
        // &#35774;&#32622;&#35831;&#35831;&#27714;&#25968;&#25454;
        if( null != $req_data <span style="color: #78dce8;">&amp;&amp;</span> 'GET' != $method ){
                if ( is_array($req_data) <span style="color: #78dce8;">&amp;&amp;</span> !isset($req_data['isfile']) ){
                        $req_data = http_build_query($req_data)<span style="color: #727072;">;</span>
                }
                curl_setopt( $ch,CURLOPT_POSTFIELDS,$req_data )<span style="color: #727072;">;</span>
        }
        //&#35774;&#32622;&#36755;&#20986;&#25968;&#25454;&#20013;&#21253;&#21547;http header
        curl_setopt( $ch, CURLOPT_HEADER,$response_header )<span style="color: #727072;">;</span>
        // &#23558;curl_exec()&#33719;&#21462;&#30340;&#20449;&#24687;&#20197;&#23383;&#31526;&#20018;&#36820;&#22238;&#65292;&#32780;&#19981;&#26159;&#30452;&#25509;&#36755;&#20986;
        curl_setopt( $ch,CURLOPT_RETURNTRANSFER,true )<span style="color: #727072;">;</span>
        // &#20801;&#35768; cURL &#20989;&#25968;&#25191;&#34892;&#30340;&#26368;&#38271;&#31186;&#25968;&#12290;
        curl_setopt( $ch,CURLOPT_TIMEOUT,$exec_time )<span style="color: #727072;">;</span>
        //&#22312;&#23581;&#35797;&#36830;&#25509;&#26102;&#31561;&#24453;&#30340;&#31186;&#25968;&#12290;&#35774;&#32622;&#20026;0&#65292;&#21017;&#26080;&#38480;&#31561;&#24453;
        curl_setopt( $ch,CURLOPT_CONNECTTIMEOUT,$connect_time )<span style="color: #727072;">;</span>
        // &#25191;&#34892;curl&#35831;&#27714;
        $response = curl_exec($ch)<span style="color: #727072;">;</span>
        //&#33719;&#21462;&#29366;&#24577;&#30721;
        $status = curl_getinfo($ch, CURLINFO_HTTP_CODE)<span style="color: #727072;">;</span>
        //&#20851;&#38381;curl&#22238;&#35805;&#24182;&#37322;&#25918;&#36164;&#28304;
        curl_close($ch)<span style="color: #727072;">;</span>
        //&#20998;&#31163;header&#19982;body
        if( $response_header ){
                $tmp         = explode(<span style="color: #ffd866;">"\r\n\r\n"</span>, $response)<span style="color: #727072;">;</span>
                $resp_header = $tmp[0]<span style="color: #727072;">;</span>
                $data        = $tmp[1]<span style="color: #727072;">;</span>
        } else {
                $resp_header = null<span style="color: #727072;">;</span>
                $data        = $response<span style="color: #727072;">;</span>
        }
        $result['errcode'] = $status<span style="color: #727072;">;</span>
        $result['header']  = $resp_header<span style="color: #727072;">;</span>
        $result['data']    = $data<span style="color: #727072;">;</span>
        return $result<span style="color: #727072;">;</span>
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-org3de13cc" class="outline-2">
<h2 id="org3de13cc"><span class="section-number-2">5</span> 文件(File)</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="outline-container-org6e094cc" class="outline-3">
<h3 id="org6e094cc"><span class="section-number-3">5.1</span> 下载文件</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">
<pre class="src src-shell" id="org75a3e5b"><span class="linenr"> 1: </span><span style="color: #a9dc76;">header</span>(<span style="color: #ffd866;">"Content-type:text/html;charset=utf-8"</span>);
<span class="linenr"> 2: </span>/**
<span class="linenr"> 3: </span>* &#25991;&#20214;&#19979;&#36733;
<span class="linenr"> 4: </span>* @param  [type] $<span style="color: #fcfcfa;">file_url</span> [&#32477;&#23545;&#36335;&#24452;&#65292;&#22914;:$<span style="color: #fcfcfa;">_SERVER</span>[<span style="color: #ffd866;">'DOCUMENT_ROOT'</span>].<span style="color: #ffd866;">'/upload/file/2019/01/18/test.png'</span>;]
<span class="linenr"> 5: </span>* @param  [type] $<span style="color: #fcfcfa;">new_name</span> [&#25351;&#23450;&#25991;&#20214;&#21517;&#31216;]
<span class="linenr"> 6: </span>* @return [type] [description]
<span class="linenr"> 7: </span>*/
<span class="linenr"> 8: </span><span style="color: #ff6188;">function</span> <span style="color: #a9dc76;">downloadFile</span>($<span style="color: #fcfcfa;">file_url</span>,$<span style="color: #fcfcfa;">new_name</span>=<span style="color: #ffd866;">''</span>){
<span class="linenr"> 9: </span>     <span style="color: #ff6188;">if</span>(!isset($<span style="color: #fcfcfa;">file_url</span>)||trim($<span style="color: #fcfcfa;">file_url</span>) == <span style="color: #ffd866;">''</span>){
<span class="linenr">10: </span>             <span style="color: #ab9df2;">echo</span> <span style="color: #ffd866;">'500'</span>;
<span class="linenr">11: </span>     }
<span class="linenr">12: </span>     //&#26816;&#26597;&#25991;&#20214;&#26159;&#21542;&#23384;&#22312;
<span class="linenr">13: </span>     <span style="color: #ff6188;">if</span>(!file_exists($<span style="color: #fcfcfa;">file_url</span>)){
<span class="linenr">14: </span>             <span style="color: #ab9df2;">echo</span> <span style="color: #ffd866;">'404'</span>;
<span class="linenr">15: </span>     }
<span class="linenr">16: </span>     $<span style="color: #fcfcfa;">file_name</span>=basename($<span style="color: #fcfcfa;">file_url</span>);
<span class="linenr">17: </span>     $<span style="color: #fcfcfa;">file_type</span>=explode(<span style="color: #ffd866;">'.'</span>,$<span style="color: #fcfcfa;">file_url</span>);
<span class="linenr">18: </span>     $<span style="color: #fcfcfa;">file_type</span>=$<span style="color: #fcfcfa;">file_type</span>[count($<span style="color: #fcfcfa;">file_type</span>)-1];
<span class="linenr">19: </span>     $<span style="color: #fcfcfa;">file_name</span>=trim($<span style="color: #fcfcfa;">new_name</span>==<span style="color: #ffd866;">''</span>)?$<span style="color: #fcfcfa;">file_name</span>:urlencode($<span style="color: #fcfcfa;">new_name</span>);
<span class="linenr">20: </span>     $<span style="color: #fcfcfa;">file_type</span>=fopen($<span style="color: #fcfcfa;">file_url</span>,<span style="color: #ffd866;">'r'</span>); //&#25171;&#24320;&#25991;&#20214;
<span class="linenr">21: </span>     //&#36755;&#20837;&#25991;&#20214;&#26631;&#31614;
<span class="linenr">22: </span>     header(<span style="color: #ffd866;">"Content-type: application/octet-stream"</span>);  
<span class="linenr">23: </span>     header(<span style="color: #ffd866;">"Accept-Ranges: bytes"</span>);  
<span class="linenr">24: </span>     header(<span style="color: #ffd866;">"Accept-Length: "</span>.filesize($<span style="color: #fcfcfa;">file_url</span>));  
<span class="linenr">25: </span>     header(<span style="color: #ffd866;">"Content-Disposition: attachment; filename="</span>.$<span style="color: #fcfcfa;">file_name</span>);  
<span class="linenr">26: </span>     //&#36755;&#20986;&#25991;&#20214;&#20869;&#23481;  
<span class="linenr">27: </span>     <span style="color: #ab9df2;">echo</span> fread($<span style="color: #fcfcfa;">file_type</span>,filesize($<span style="color: #fcfcfa;">file_url</span>));
<span class="linenr">28: </span>     fclose($<span style="color: #fcfcfa;">file_type</span>);
<span class="linenr">29: </span>}
</pre>
</div>
<pre class="example">
几点注意事项：
</pre>

<ol class="org-ol">
<li>header("Content-type:text/html;charset=utf-8")的作用：在服务器响应浏览器的请求时，告诉浏览器以编码格式为UTF-8的编码显示该内容。</li>
<li>关于file_exists()函数不支持中文路径的问题:因为php函数比较早，不支持中文，所以如果被下载的文件名是中文的话，需要对其进行字符编码转换，否则file_exists()函数不能识别，可以使用iconv()函数进行编码转换。</li>
<li>$file_sub_path() 我使用的是绝对路径，执行效率要比相对路径高。</li>
<li>Header("Content-type: application/octet-stream")的作用：通过这句代码客户端浏览器就能知道服务端返回的文件形式。</li>
<li>Header("Accept-Ranges: bytes")的作用：告诉客户端浏览器返回的文件大小是按照字节进行计算的。</li>
<li>Header("Accept-Length:".$file_size)的作用：告诉浏览器返回的文件大小。</li>
<li>Header("Content-Disposition: attachment; filename=".$file_name)的作用:告诉浏览器返回的文件的名称。</li>
<li>以上四个Header()是必需的。</li>
<li>fclose($fp)可以把缓冲区内最后剩余的数据输出到磁盘文件中，并释放文件指针和有关的缓冲区</li>
</ol>
</div>
</div>
<div id="outline-container-org827b25b" class="outline-3">
<h3 id="org827b25b"><span class="section-number-3">5.2</span> 参考资料</h3>
<div class="outline-text-3" id="text-5-2">
<ul class="org-ul">
<li><a href="http://www.cnblogs.com/hongfei/archive/2012/06/12/2546929.html">Php如何实现下载功能超详细流程分析</a></li>
<li><a href="https://blog.csdn.net/hj960511/article/details/51837990">php实现当前页面点击下载文件实例</a></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgb17637e" class="outline-2">
<h2 id="orgb17637e"><span class="section-number-2">6</span> 其他代码片段</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-orgbff3f44" class="outline-3">
<h3 id="orgbff3f44"><span class="section-number-3">6.1</span> PHP 生成UUID我唯一序列</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">
<pre class="src src-shell" id="org03d0857"><span class="linenr"> 1: </span><span style="color: #ff6188;">function</span> <span style="color: #a9dc76;">uuid</span>($<span style="color: #fcfcfa;">prefix</span> =<span style="color: #ffd866;">''</span>)                                                                                                                            
<span class="linenr"> 2: </span>{                                                                                                                                                     
<span class="linenr"> 3: </span>        $<span style="color: #fcfcfa;">chars</span> = md5(uniqid(mt_rand(), true));                                                                                                        
<span class="linenr"> 4: </span>        $<span style="color: #fcfcfa;">uuid</span> = substr($<span style="color: #fcfcfa;">chars</span>,0,8) <span style="color: #ab9df2;">.</span> <span style="color: #ffd866;">'-'</span>;                                                                                                             
<span class="linenr"> 5: </span>        $<span style="color: #fcfcfa;">uuid</span> .= substr($<span style="color: #fcfcfa;">chars</span>,8,4) <span style="color: #ab9df2;">.</span> <span style="color: #ffd866;">'-'</span>;                                                                                                            
<span class="linenr"> 6: </span>        $<span style="color: #fcfcfa;">uuid</span> .= substr($<span style="color: #fcfcfa;">chars</span>,12,4) <span style="color: #ab9df2;">.</span> <span style="color: #ffd866;">'-'</span>;                                                                                                           
<span class="linenr"> 7: </span>        $<span style="color: #fcfcfa;">uuid</span> .= substr($<span style="color: #fcfcfa;">chars</span>,16,4) <span style="color: #ab9df2;">.</span> <span style="color: #ffd866;">'-'</span>;                                                                                                           
<span class="linenr"> 8: </span>        $<span style="color: #fcfcfa;">uuid</span> .= substr($<span style="color: #fcfcfa;">chars</span>,20,12);                                                                                                                
<span class="linenr"> 9: </span>        <span style="color: #ff6188;">return</span> $<span style="color: #fcfcfa;">prefix</span> . $<span style="color: #fcfcfa;">uuid</span>;                                                                                                                       
<span class="linenr">10: </span>}                                                                                                                                                     
</pre>
</div>
<pre class="example">
也可以使用SQL语句生成：insert into Price( Name, UUID, Price) values('FEIFEI_TEST', uuid(), 32); 
</pre>
</div>
</div>
</div>
