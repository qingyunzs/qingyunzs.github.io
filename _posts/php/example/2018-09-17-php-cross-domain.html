<div id="outline-container-org91df3b6" class="outline-2">
<h2 id="org91df3b6">问题概述</h2>
<div class="outline-text-2" id="text-org91df3b6">
<pre class="example">
现代浏览器针对不同域名之间的ajax请求，一般情况下会阻止你获取到ajax返回内容（即使是1.a.com和2.a.com也算跨域）。这是浏览器的为安全性考虑实施的非常重要的安全策略。

</pre>
</div>
</div>
<div id="outline-container-orge4b542d" class="outline-2">
<h2 id="orge4b542d">请求跨域问题解决</h2>
<div class="outline-text-2" id="text-orge4b542d">
<pre class="example">
下面通过一个 Ajax 请求示例来说明：

</pre>
</div>
<div id="outline-container-orgf9f6c53" class="outline-3">
<h3 id="orgf9f6c53">Client</h3>
</div>

<div id="outline-container-org72bd47f" class="outline-3">
<h3 id="org72bd47f">Server</h3>
<div class="outline-text-3" id="text-org72bd47f">
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>服务端处理：粗糙解决方式</label><pre class="src src-php"><span style="color: #75715E;">// </span><span style="color: #75715E;">&#26381;&#21153;&#31471;&#22788;&#29702;&#65306;&#31895;&#31961;&#35299;&#20915;&#26041;&#24335;</span>
<span style="color: #75715E;">// </span><span style="color: #75715E;">&#20801;&#35768;&#25152;&#26377;&#36328;&#22495;&#35831;&#27714;</span>
header(<span style="color: #E6DB74;">'Access-Control-Allow-Origin: *'</span>);

<span style="color: #75715E;">// </span><span style="color: #75715E;">&#21482;&#20801;&#35768; http://www.baidu.com &#21457;&#26469;&#30340;&#36328;&#22495;&#35831;&#27714;</span>
<span style="color: #75715E;">// </span><span style="color: #75715E;">header('Access-Control-Allow-Origin: http://www.baidu.com');</span>

<span style="color: #75715E;">// </span><span style="color: #75715E;">&#35774;&#32622;&#25903;&#25345;&#30340; http &#35831;&#27714;&#26041;&#24335;</span>
header(<span style="color: #E6DB74;">'Access-Control-Allow-Methods:POST,GET,OPTIONS,PUT,DELETE'</span>);

<span style="color: #75715E;">// </span><span style="color: #75715E;">&#20801;&#35768;&#30340;&#21709;&#24212;&#22836;&#23383;&#27573;&#65292;&#35831;&#25353;&#29031;&#33258;&#24049;&#38656;&#27714;&#28155;&#21152;</span>
header(<span style="color: #E6DB74;">'Access-Control-Allow-Headers:access_token'</span>);
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 2: </span>服务端处理：动态判断处理跨域问题</label><pre class="src src-php"><span style="color: #F92672;">if</span>(<span style="color: #F92672;">isset</span>($<span style="color: #FD971F;">_SERVER</span>[<span style="color: #E6DB74;">'HTTP_ORIGIN'</span>])){
    <span style="color: #75715E;">// </span><span style="color: #75715E;">&#35831;&#27714;&#26041;&#27861;</span>
    $<span style="color: #FD971F;">request_method</span> = $<span style="color: #FD971F;">_SERVER</span>[<span style="color: #E6DB74;">'REQUEST_METHOD'</span>];
    <span style="color: #75715E;">// </span><span style="color: #75715E;">&#23450;&#20041;&#19968;&#20010;&#20801;&#35768;&#36328;&#22495;&#35831;&#27714;&#25509;&#21475;&#30340;&#22495;&#21517;&#21015;&#34920;&#65292;&#36825;&#37324;&#20320;&#21487;&#20197;&#29992;&#37197;&#32622;&#20063;&#21487;&#20197;&#29992;&#20854;&#23427;&#24418;&#24335;&#65292;&#25105;&#36825;&#37324;&#21482;&#26159;&#29992;$GLOBALS&#31616;&#21333;&#28436;&#31034;&#19968;&#19979;</span>
    $<span style="color: #FD971F;">allow_origin</span> = <span style="color: #F92672;">array</span>(
    <span style="color: #E6DB74;">'baidu.com'</span>,
    <span style="color: #E6DB74;">'bing.com'</span>
    );
    <span style="color: #75715E;">// </span><span style="color: #75715E;">&#21028;&#26029;&#26159;&#21542;&#26377;origin&#35831;&#27714;&#22836;</span>
    <span style="color: #F92672;">if</span>(in_array($<span style="color: #FD971F;">request_method</span>, $<span style="color: #FD971F;">allow_origin</span>)
    {
        header(<span style="color: #E6DB74;">'Access-Control-Allow-Origin: '</span> . $<span style="color: #FD971F;">_SERVER</span>[<span style="color: #E6DB74;">'HTTP_ORIGIN'</span>]);
        header(<span style="color: #E6DB74;">'Access-Control-Allow-Credentials: true'</span>); <span style="color: #75715E;">// </span><span style="color: #75715E;">&#23458;&#25143;&#31471;&#25658;&#24102;&#35777;&#20070;&#24335;&#35775;&#38382;&#12290;&#20986;&#20110;&#23433;&#20840;&#32771;&#34385;&#65292;&#35813;&#39033;&#35774;&#32622;&#20026;true&#26102;&#65292;Access-Control-Allow-Origin &#30340;&#20540;&#19981;&#20801;&#35768;&#20026;&#12300;*&#12301;</span>
        header(<span style="color: #E6DB74;">'Access-Control-Allow-Methods:POST,GET,OPTIONS,PUT,DELETE'</span>);
        header(<span style="color: #E6DB74;">'Access-Control-Allow-Headers:x-requested-with,content-type,access_token'</span>);
    }
    }
}
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgdc5e441" class="outline-2">
<h2 id="orgdc5e441">Session 跨域问题解决</h2>
<div class="outline-text-2" id="text-orgdc5e441">
<div class="org-src-container">
<pre class="src src-php">ini_set(<span style="color: #E6DB74;">'session.cookie_domain'</span>, <span style="color: #E6DB74;">'.a.com'</span>);
header(<span style="color: #E6DB74;">'Access-Control-Allow-Credentials: true'</span>);
</pre>
</div>
</div>
<div id="outline-container-org057fc48" class="outline-3">
<h3 id="org057fc48">参考资料</h3>
<div class="outline-text-3" id="text-org057fc48">
<ul class="org-ul">
<li><a href="https://blog.csdn.net/z69183787/article/details/78954325">跨域Ajax请求时是否带Cookie的设置</a></li>
</ul>
</div>
</div>
</div>
