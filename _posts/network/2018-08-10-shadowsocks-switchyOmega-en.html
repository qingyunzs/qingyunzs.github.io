---
layout: post
title: Over the wall with Shadowsocks+SwitchyOmega
author: zrg
comments: false
description: As we all know, the walls of the continent have been very high. As a developer, "prison Break"(or "Over the wall") is necessary skill, at least of now. This article focuses on how to cross the maninland of China through shadowsocks to visit the outside world.
categories:
- network
- software
tags:
- Shadowsocks
- SwitchyOmega
photos:
---

<p>
This article is for communication only, please do not use for business! The author of this article is not responsible for any consequences. thanks for your attention!
</p>

<div class="org-center">
<p>
If you have questions, please send email to zrg1390556487@gmail.com.
</p>

<p>
如果您有任何问题或建议，可以发送邮件到 zrg1390556487@gmail.com
</p>
</div>

<div id="outline-container-org326b4cd" class="outline-2">
<h2 id="org326b4cd"><span class="section-number-2">1</span> Server</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org28892ea" class="outline-3">
<h3 id="org28892ea"><span class="section-number-3">1.1</span> Buy a Cloud Host</h3>
<div class="outline-text-3" id="text-1-1">
<ul class="org-ul">
<li><a href="https://www.digitalocean.com">DigitalOcean</a></li>
<li>AWS</li>
</ul>
</div>
</div>
<div id="outline-container-orga759db5" class="outline-3">
<h3 id="orga759db5"><span class="section-number-3">1.2</span> Installing and Configuring Shadowsocks</h3>
<div class="outline-text-3" id="text-1-2">
<ol class="org-ol">
<li><p>
Installing pip
</p>
<pre class="example">
# yum install python-pip
or
# curl "https://bootstrap.pypa.io/get-pip.py" -o "get-pip.py"
# python get-pip.py
</pre>


<pre class="example">
// update
# pip install --upgrade pip
</pre></li>
<li><p>
Installing shadowsocks
</p>
<pre class="example">
# pip install shadowsocks
# vim /etc/shadowsocks.json
</pre>

<div class="org-src-container">
<pre class="src src-shell">{
  <span style="color: #ffd866;">"server"</span>: <span style="color: #ffd866;">"server_ip"</span>,//server ip address
  <span style="color: #ffd866;">"server_port"</span>: 8388,//server port
  <span style="color: #ffd866;">"local_address"</span>:<span style="color: #ffd866;">"127.0.0.1"</span>,//local address
  <span style="color: #ffd866;">"local_port"</span>:1080,//local port
  <span style="color: #ffd866;">"port_password"</span>:{ //multiple port
          <span style="color: #ffd866;">"9001"</span>:<span style="color: #ffd866;">"password9001"</span>,
          <span style="color: #ffd866;">"9002"</span>:<span style="color: #ffd866;">"password9002"</span>,
          <span style="color: #ffd866;">"9003"</span>:<span style="color: #ffd866;">"password9003"</span>,
     },
  <span style="color: #ffd866;">"password"</span>: <span style="color: #ffd866;">"password"</span>,//password
  <span style="color: #ffd866;">"method"</span>: <span style="color: #ffd866;">"aes-256-cfb"</span>,//encryption
  <span style="color: #ffd866;">"timeout"</span>:600 //timeout
  }
</pre>
</div>
<p>
explanation:
</p>
<dl class="org-dl">
<dt>"server": "123.123.123.123"</dt><dd>server ip address</dd>
<dt>"server_port": 8388</dt><dd>server port</dd>
<dt>"local_address":"127.0.0.1"</dt><dd>local ip address</dd>
<dt>"local_port":1080,</dt><dd>local port</dd>
<dt>"port_password"</dt><dd>port and password</dd>
<dt>"password": "password"</dt><dd>password</dd>
<dt>"method": "aes-256-cfb"</dt><dd>encrypt method, more detail:<a href="http://ucdok.com/project/generate_password.html">password tool</a></dd>
<dt>"timeout":600</dt><dd>over time</dd>
</dl></li>
<li><p>
Configuring auto-start script
</p>
<pre class="example">
#vim /etc/systemd/system/shadowsocks.service
</pre>

<div class="org-src-container">
<pre class="src src-emacs-lisp">[Unit]
Description=Shadowsocks

[Service]
TimeoutStartSec=0
ExecStart=/usr/bin/ssserver -c /etc/shadowsocks.json

[Install]
WantedBy=multi-user.target
</pre>
</div>
<pre class="example">
Start shadowsocks
#systemctl enable shadowsocks
#systemctl start shadowsocks
#systemctl status shadowsocks -l
</pre></li>
<li><p>
Auto install script
</p>
<pre class="example">
$ vim install-shadowsocks.sh, content of file from 
</pre>

<p>
<a href="https://github.com/zhaorengui/article/blob/master/network/install-shadowsocks.sh">install-shadowsocks.sh</a>
</p>
<pre class="example">
# chmod +x install-shadowsocks.sh
# ./install-shadowsocks.sh
</pre></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org689d343" class="outline-2">
<h2 id="org689d343"><span class="section-number-2">2</span> Client</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org887f97d" class="outline-3">
<h3 id="org887f97d"><span class="section-number-3">2.1</span> Linux</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-org5e9c215" class="outline-4">
<h4 id="org5e9c215"><span class="section-number-4">2.1.1</span> Install and Use Shadowsocks Command Line Client on Linux</h4>
<div class="outline-text-4" id="text-2-1-1">
<ol class="org-ol">
<li><p>
Linux series
</p>
<ul class="org-ul">
<li><p>
Debian/Ubuntu:
</p>
<pre class="example">
$ sudo apt-get install python-pip
$ sudo pip install shadowsocks
</pre></li>
<li><p>
Fedora/Centos:
</p>
<pre class="example">
$ sudo yum install python-setuptools   or   sudo dnf install python-setuptools
$ sudo easy_install pip
$ sudo pip install shadowsocks
</pre></li>
<li><p>
OpenSUSE:
</p>
<pre class="example">
$ sudo zypper install python-pip
$ sudo pip install shadowsocks
</pre></li>
<li><p>
Archlinux:
</p>
<pre class="example">
$ sudo pacman -S python-pip
$ sudo pip install shadowsocks
</pre></li>
</ul>
<p>
sslocal is the client software and ssserver is the server software. On some Linux distros such as ubuntu, the shadowsocks client sslocal is installed under <i>usr/local/bin. On Others such as Arch sslocal is installed under /usr/bin</i>. Your can use whereis command to find the exact location.
</p>
<pre class="example">
$ whereis sslocal
</pre>

<p>
sslocal: /usr/local/bin/sslocal
</p></li>
<li><p>
/etc/shadowsocks.json
</p>
<div class="org-src-container">
<pre class="src src-emacs-lisp">{
<span style="color: #ffd866;">"server"</span>:<span style="color: #ffd866;">"server-ip"</span>,
<span style="color: #ffd866;">"server_port"</span><span style="color: #ab9df2;">:8000</span>,
<span style="color: #ffd866;">"local_address"</span>: <span style="color: #ffd866;">"127.0.0.1"</span>,
<span style="color: #ffd866;">"local_port"</span><span style="color: #ab9df2;">:1080</span>,
<span style="color: #ffd866;">"password"</span>:<span style="color: #ffd866;">"your-password"</span>,
<span style="color: #ffd866;">"timeout"</span><span style="color: #ab9df2;">:600</span>,
<span style="color: #ffd866;">"method"</span>:<span style="color: #ffd866;">"aes-256-cfb"</span>
}
</pre>
</div>
<pre class="example">
// start
$ sudo sslocal -c /etc/shadowsocks.json
</pre>


<pre class="example">
// To run in the background
$ sudo sslocal -c /etc/shadowsocks.json -d start
</pre></li>
<li><p>
/etc/rc.local
</p>
<pre class="example">
$ sudo vim /etc/rc.local
</pre>

<div class="org-src-container">
<pre class="src src-emacs-lisp">sudo sslocal -c /etc/shadowsocks.json -d start
</pre>
</div>

<pre class="example">
// Check if It Works
# sudo systemctl status rc-local.service
</pre></li>
</ol>
</div>
</div>
<div id="outline-container-org2e28307" class="outline-4">
<h4 id="org2e28307"><span class="section-number-4">2.1.2</span> Global Proxy</h4>
<div class="outline-text-4" id="text-2-1-2">
<ol class="org-ol">
<li><p>
Install and Configure polipo
</p>
<pre class="example">
$ sudo apt install polipo
$ sudo vim /etc/polipo/config
</pre>

<div class="org-src-container">
<pre class="src src-shell" id="org78a20b8">logSyslog = true
logFile = /var/log/polipo/polipo.log
proxyAddress = <span style="color: #ffd866;">"0.0.0.0"</span>
socksParentProxy = <span style="color: #ffd866;">"127.0.0.1:1080"</span>
socksProxyType = socks5
chunkHighMark = 50331648
objectHighMark = 16384
serverMaxSlots = 64
serverSlots = 16
serverSlots1 = 32
</pre>
</div></li>
<li><p>
Restart polipo
</p>
<pre class="example">
$ sudo systemctl restart polipo
</pre></li>
<li><p>
Export http_proxy and https_proxy
</p>
<pre class="example">
$ export http_proxy="http://127.0.0.1:8123/"
$ export https_proxy="https://127.0.0.1:8123/"
</pre></li>
<li><p>
testing
</p>
<pre class="example">
$ curl www.google.com
</pre></li>
</ol>
</div>
</div>
<div id="outline-container-orgc74177f" class="outline-4">
<h4 id="orgc74177f"><span class="section-number-4">2.1.3</span> Solving Problem</h4>
<div class="outline-text-4" id="text-2-1-3">
<ol class="org-ol">
<li><p>
ShadowSocks start error: undefined symbol EVP_CIPHER_CTX_cleanup
[Reason]
</p>
<pre class="example">
openssl 1.1.0 "EVP_CIPHER_CTX_cleanup" is old.
</pre>

<p>
[Solving]
</p>
<pre class="example">
$ vim /usr/local/lib/python3.5/dist-packages/shadowsocks/crypto/openssl.py
</pre>

<div class="org-src-container">
<pre class="src src-python" id="orgd80d67b">VIM Command&#65306;
:%s/cleanup/reset/
:x
</pre>
</div></li>
<li><p>
not support "chacha20"
[Solving]
</p>
<pre class="example">
$ apt install m2crypto gcc -y
$ wget -N --no-check-certificate https://download.libsodium.org/libsodium/releases/libsodium-1.0.8.tar.gz
$ tar zxvf libsodium-1.0.8.tar.gz
$ cd libsodium-1.0.8
$ sudo ./configure
$ sudo make &amp;&amp; make install
$ sudo echo "include ld.so.conf.d/*.conf" &gt; /etc/ld.so.conf
$ sudo echo "/lib" &gt;&gt; /etc/ld.so.conf
$ sudo echo "/usr/lib64" &gt;&gt; /etc/ld.so.conf
$ sudo echo "/usr/local/lib" &gt;&gt; /etc/ld.so.conf
$ sudo ldconfig
</pre></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org86f1e86" class="outline-3">
<h3 id="org86f1e86"><span class="section-number-3">2.2</span> Windows</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-org1e5fd7f" class="outline-4">
<h4 id="org1e5fd7f"><span class="section-number-4">2.2.1</span> Download</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
Get shadowsocks client by sending email to zrg1390556487@gmail.com
</p>
</div>
</div>
<div id="outline-container-org93cf3ef" class="outline-4">
<h4 id="org93cf3ef"><span class="section-number-4">2.2.2</span> Configure</h4>
<div class="outline-text-4" id="text-2-2-2">
<ol class="org-ol">
<li>unzip
<img src="{{site.url}}/assets/images/shadowsocks-20170123111438.png" alt="shadowsocks-20170123111438.png" /></li>
<li>running
<img src="{{site.url}}/assets/images/shadowsocks-20170123111902.png" alt="shadowsocks-20170123111902.png" /></li>
<li>configuring
<img src="{{site.url}}/assets/images/shadowsocks-20170123111953.png" alt="shadowsocks-20170123111953.png" /></li>
<li>proxy
<img src="{{site.url}}/assets/images/shadowsocks-20170123112126.png" alt="shadowsocks-20170123112126.png" /></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org46ab7d2" class="outline-3">
<h3 id="org46ab7d2"><span class="section-number-3">2.3</span> Android</h3>
<div class="outline-text-3" id="text-2-3">
</div>
<div id="outline-container-org56a88b5" class="outline-4">
<h4 id="org56a88b5"><span class="section-number-4">2.3.1</span> Download</h4>
<div class="outline-text-4" id="text-2-3-1">
<p>
Get shadowsocks client by sending email to zrg1390556487@gmail.com
</p>
</div>
</div>
<div id="outline-container-org8b49220" class="outline-4">
<h4 id="org8b49220"><span class="section-number-4">2.3.2</span> Configure</h4>
<div class="outline-text-4" id="text-2-3-2">

<div class="figure">
<p><img src="{{site.url}}/assets/images/shadowsocks-20170123141118.png" alt="shadowsocks-20170123141118.png" />
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org55b9c55" class="outline-3">
<h3 id="org55b9c55"><span class="section-number-3">2.4</span> IOS</h3>
<div class="outline-text-3" id="text-2-4">
<ol class="org-ol">
<li>Open "App Store", To search "shadowrocket". Current price: ￥12</li>
<li>Add server configure. Okay.
<img src="{{site.url}}/assets/images/ios-shadowrocket-01.jpeg" alt="ios-shadowrocket-01.jpeg" />
<img src="{{site.url}}/assets/images/ios-shadowrocket-02.jpeg" alt="ios-shadowrocket-02.jpeg" /></li>
</ol>
</div>
</div>
<div id="outline-container-orgeae23af" class="outline-3">
<h3 id="orgeae23af"><span class="section-number-3">2.5</span> Mac OS X</h3>
<div class="outline-text-3" id="text-2-5">
<p>
Get shadowsocks client by sending email to zrg1390556487@gmail.com
</p>
</div>
</div>
</div>
<div id="outline-container-org7ba046a" class="outline-2">
<h2 id="org7ba046a"><span class="section-number-2">3</span> Browser Plugin: SwitchyOmega</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org065882a" class="outline-3">
<h3 id="org065882a"><span class="section-number-3">3.1</span> Download</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Get shadowsocks client by sending email to zrg1390556487@gmail.com
</p>
</div>
</div>
<div id="outline-container-org78ee738" class="outline-3">
<h3 id="org78ee738"><span class="section-number-3">3.2</span> Configure</h3>
<div class="outline-text-3" id="text-3-2">
<ol class="org-ol">
<li>set proxy
<img src="{{site.url}}/assets/images/switchyomega-01.png" alt="switchyomega-01.png" /></li>
<li><p>
set rule
<img src="{{site.url}}/assets/images/switchyomega-02.png" alt="switchyomega-02.png" />
</p>
<pre class="example">
rule:http://autoproxy-gfwlist.googlecode.com/svn/trunk/gfwlist.txt
or
https://raw.githubusercontent.com/gfwlist/gfwlist/master/gfwlist.txt
</pre></li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org9c8f513" class="outline-2">
<h2 id="org9c8f513"><span class="section-number-2">4</span> References</h2>
<div class="outline-text-2" id="text-4">
<ul class="org-ul">
<li><a href="https://zh.wikipedia.org/zh-hans/Shadowsocks">https://zh.wikipedia.org/zh-hans/Shadowsocks</a></li>
<li><a href="https://shadowsocks.com">https://shadowsocks.com</a></li>
<li><a href="http://shadowsocks.org/">http://shadowsocks.org/</a></li>
<li><a href="http://morning.work/page/2015-12/install-shadowsocks-on-centos-7.html">在 CentOS 7 下安装配置 shadowsocks</a></li>
<li><a href="https://www.linuxbabe.com/desktop-linux/how-to-install-and-use-shadowsocks-command-line-client">Install And Use Shadowsocks Command Line Client on Linux</a></li>
<li><a href="https://doub.io/ss-jc10/">ShadowsocksR 客户端 小白使用教程</a></li>
<li><a href="https://kionf.com/2016/12/15/errornote-ss/">ShadowSocks启动报错undefined symbol EVP_CIPHER_CTX_cleanup</a></li>
<li><a href="https://github.com/FelisCatus/SwitchyOmega/wiki/GFWList">SwitchyOmega</a></li>
<li><a href="https://doub.io/ss-jc25/">IOS系统推荐几款支持Shadowsocks的代理软件</a></li>
<li><a href="http://www.jeyzhang.com/how-to-install-and-setup-shadowsocks-client-in-different-os.html">各种系统下Shadowsocks客户端的安装与配置</a></li>
<li><a href="https://www.jianshu.com/p/41378f4e14bc">linux 配置shadowsocks代理全局代理</a></li>
<li><a href="https://blog.csdn.net/guizaijianchic/article/details/78422811">linux ubuntu下使用ss设置全局代理,命令行也走代理</a></li>
</ul>
</div>
</div>
